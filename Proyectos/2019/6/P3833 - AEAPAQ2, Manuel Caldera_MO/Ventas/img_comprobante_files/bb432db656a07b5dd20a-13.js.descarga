webpackJsonp([13],{201:function(t,e,n){Jane.module("noscript.js",(function(){window.yr=n(3165),window.vow=n(3166),vow.Promise.prototype.__vow_reject=vow.Promise.prototype._reject,vow.Promise.prototype._reject=function(t){t instanceof Error&&ns.log.exception("promise.exception",t),this.__vow_reject(t)},window.NS_IS_TOUCH=!1,n(3167),n(3168),n(3169),n(3170),ns.history.init=function(){window.addEventListener("hashchange",ns.history.onpopstate,!1)},n(3171),n(3172),no.True=no.true,no.False=no.false,n(3173),n(3174),n(3175),n(3176),n(3177),n(3178),n(3179),n(3180),n(3181),n(3182),n(3183),n(3184),n(3185),n(3186),n(3187),n(3188),n(3189),n(3190),ns.initMainView=function(){var t=ns.View.create("app");t._setNode(document.getElementById("js-mail-app")),t.invalidate(),ns.MAIN_VIEW=t},ns.request.URL=Daria.api.models,ns.request.FORMAT=Daria.api["models-format"],ns.V.DOM_EVENTS.push("onSave"),ns.V.DOM_EVENTS.push("b-mail-dropdown-open"),ns.V.DOM_EVENTS.push("message"),ns.V.DOM_EVENTS.push("dragndrop.drop"),ns.V.DOM_EVENTS.push("result"),ns.V.DOM_EVENTS.push("wheel"),ns.V.DOM_EVENTS.push("DOMNodeRemoved"),ns.V.DOM_EVENTS.push("DOMNodeInserted"),ns.V.DOM_EVENTS.push("DOMNodeInsertedIntoDocument"),ns.V.DOM_EVENTS.push("DOMNodeRemovedFromDocument"),ns.DEBUG=Daria.DEBUG,window.jpath=function(t,e){return no.jpath.raw(e,t).toArray()},ns.getViewMethods=function(t){if(!ns.View.isDefined(t))return void console.error("Вид `"+t+"` не определен");var e=ns.View.infoLite(t).methods;return _.isArray(e)&&(e=_.extend.apply(null,[{}].concat(e))),e},ns.getViewMethod=function(t,e){var n=ns.getViewMethods(t);if(n)return n[e]?n[e]:void console.error("В виде `"+t+"` не определен метод `"+e+"`")}}))},3165:function(t,e,n){var r={};!(function(){function t(t){return t.replace(/&/g,"&amp;")}function e(t,e){Array.isArray(t)&&(t={item:t}),this.root={data:t,parent:null,name:e||"",doc:this},this._vars={},this._keys={}}r.log=function(){};var n={},o=/&/g,i=/</g,s=/>/g,a=/"/g,u=/&amp;/g,c=/&lt;/g,l=/&gt;/g;r.text2xml=function(t){return null==t?"":(""+t).replace(o,"&amp;").replace(i,"&lt;").replace(s,"&gt;")},r.xml2text=function(t){return null==t?"":(""+t).replace(c,"<").replace(l,">").replace(u,"&")},r.text2attr=function(t){return null==t?"":(""+t).replace(o,"&amp;").replace(a,"&quot;").replace(i,"&lt;").replace(s,"&gt;")},r.xml2attr=function(t){return null==t?"":(""+t).replace(a,"&quot;").replace(i,"&lt;").replace(s,"&gt;")},r.register=function(t,e){if(r.isRegistered(t))throw Error('Module "'+t+'" already exists');for(var o=e.imports||[],i=[e],s=0,a=o.length;s<a;s++){var u=n[o[s]];if(!u)throw Error('Module "'+o[s]+"\" doesn't exist");i=i.concat(u.imports)}e.imports=i,n[t]=e},r.isRegistered=function(t){return!!n[t]},r.run=function(t,r,o,i,s){o=o||"";var a=n[t];if(!a)throw'Module "'+t+'" is undefined';var u=new e(r,s);return i?a.a.apply(a,[a,0,[u.root],o,{a:{}}].concat(i)):a.a(a,0,[u.root],o,{a:{}})},r.join=function(t,e){return t.concat(e)},r.nodeValue=function(t){var e=t.data;return"object"==typeof e?"":e},r.nodeName=function(t){var e=t[0];return e?e.name:""},r.simpleScalar=function(t,e){var n=e.data;if(!n)return"";if("*"===t){for(var o in n)return r.simpleScalar(o,e);return""}var i=n[t];return"object"==typeof i?"":void 0===i?"":i},r.simpleBoolean=function(t,e){var n=e.data;if(!n)return!1;if("*"===t){for(var o in n){var i=r.simpleBoolean(o,e);if(i)return!0}return!1}var i=n[t];return!!i&&(!Array.isArray(i)||i.length)},r.nodeset2scalar=function(t){if(!t.length)return"";var e=t[0].data;return"object"==typeof e?"":e},r.nodeset2boolean=function(t){return!!(t&&t.length>0)&&!!t[0].data},r.nodeset2xml=function(t){return r.scalar2xml(r.nodeset2scalar(t))},r.nodeset2attrvalue=function(t){return r.scalar2attrvalue(r.nodeset2scalar(t))},r.scalar2xml=r.text2xml,r.xml2scalar=r.xml2text,r.xml2attrvalue=r.xml2attr,r.scalar2attrvalue=r.text2attr,r.object2nodeset=function(t){return[new e(t).root]},r.array2nodeset=function(t){return[new e({item:t}).root]},r.cmpSN=function(t,e){for(var n=0,o=e.length;n<o;n++)if(t==r.nodeValue(e[n]))return!0;return!1},r.cmpNN=function(t,e){var n=e.length;if(0===n)return!1;if(1===n)return r.cmpSN(r.nodeValue(e[0]),t);for(var o=[],i=r.nodeValue(e[0]),s=0,a=t.length;s<a;s++){var u=r.nodeValue(t[s]);if(u==i)return!0;o[s]=u}for(var c=1;c<n;c++){i=r.nodeValue(e[c]);for(var s=0,a=t.length;s<a;s++)if(o[s]==i)return!0}return!1},r.shortTags={br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,wbr:!0},r.closeAttrs=function(t){var e=t.s;if(e){var n="",o=t.a;for(var i in o)n+=" "+i+'="'+o[i].quote()+'"';return n+=r.shortTags[e]?"/>":">",t.s=null,n}return""},r.copyAttrs=function(t,e){for(var n in e)t[n]=e[n]},r.scalarAttr=function(t){this.s=null==t?"":""+t},r.scalarAttr.prototype.quote=function(){return r.text2attr(this.s)},r.scalarAttr.prototype.addxml=function(e){return new r.xmlAttr(t(this.s)+e)},r.scalarAttr.prototype.addscalar=function(t){return new r.scalarAttr(this.s+t)},r.xmlAttr=function(t){this.s=null==t?"":""+t},r.xmlAttr.prototype.quote=function(){return r.xml2attr(this.s)},r.xmlAttr.prototype.addscalar=function(e){return new r.xmlAttr(this.s+t(e))},r.slice=function(t,e,n){return t=""+t,n?t.slice(e,n):t.slice(e)},r.exists=function(t){return t.length>0},r.grep=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r,o)&&n.push(i)}return n},r.byIndex=function(t,e){return t.slice(e,e+1)},r.sort=function(t,e,n){for(var r=[],o=0,i=t.length;o<i;o++){var s=t[o],a=e(s,o,i);r.push({node:s,value:a})}for(var u=n?-1:1,c=n?1:-1,l=r.sort((function(t,e){var n=t.value,r=e.value;return n<r?c:n>r?u:0})),f=[],o=0,i=l.length;o<i;o++)f.push(l[o].node);return f},r.nodeset2data=function(t){var e=t.length;if(0===e)return"";if(1===e)return t[0].data;for(var n=[],r=0;r<e;r++)n.push(t[r].data);return n},r.externals={};var f=function(){};f.prototype.a=function(t,e,n,r,o){var i,s="";arguments.length>5&&(i=Array.prototype.slice.call(arguments,5));for(var a=t.imports,u=0,c=n.length;u<c;u++){for(var l,f,p=n[u],h=!1,d=e,v=a.length;!h&&d<v;){l=a[d++];var y=l.matcher[r];if(y){var _=y[p.name]||y["*"];if(_)for(var g=0,m=_.length;!h&&g<m;){var w=_[g++];f=l[w];var b=f.j;if(b)l.matched(b,f.a,p,u,c)&&(h=w);else for(var x=f.s,V=f.a,M=0,E=x.length;M<E;M++)if(l.matched(x[M],V[M],p,u,c)){h=w;break}}}}h&&(s+=i?f.apply(t,[t,p,u,c,o].concat(i)):f(t,p,u,c,o))}return s},f.prototype.matched=function(t,e,n,r,o){if(1===t)return!n.parent;for(var i=t.length,s=i-2;s>=0;){if(!n)return!1;switch(t[s]){case 0:var a=t[s+1];if("*"!==a&&a!==n.name)return!1;n=n.parent;break;case 2:case 4:if(!(0,t[s+1])(this,n,r,o))return!1}s-=2}return!e||!n.parent},f.prototype.s=function(t,e){return this.n(t,[e])},f.prototype.n=function(t,e){for(var n,o=e,i=o.length,s=0,a=t.length;s<a;s+=2){n=[];var u=t[s],c=t[s+1];switch(u){case 0:for(var l=0;l<i;l++)r.selectNametest(c,o[l],n);break;case 1:for(var l=0;l<i;l++){for(var f=0,p=o[l];f<c&&p;)p=p.parent,f++;p&&n.push(p)}break;case 2:for(var l=0;l<i;l++){var p=o[l];c(this,p,l,i)&&n.push(p)}break;case 3:var p=o[c];n=p?[p]:[];break;case 4:if(i>0){var p=o[0];c(this,p.doc.root,0,1)&&(n=n.concat(o))}}if(o=n,!(i=o.length))return[]}return n},r.selectNametest=function(t,e,n){var o=e.data;if(!o||"object"!=typeof o)return n;if("*"===t){if(Array.isArray(o))for(var i=0,s=o.length;i<s;i++)r.selectNametest(i,e,n);else for(t in o)r.selectNametest(t,e,n);return n}if(void 0===(o=o[t]))return n;var a=e.doc;if(Array.isArray(o))for(var i=0,s=o.length;i<s;i++)n.push({data:o[i],parent:e,name:t,doc:a});else n.push({data:o,parent:e,name:t,doc:a});return n},r.document=function(t){var n;return n=new e(t.length?t[0].data:{}),[n.root]},r.subnode=function(t,e,n){var r=n.doc;if(Array.isArray(e)){for(var o=[],i=0,s=e.length;i<s;i++)o.push({data:e[i],name:t,parent:n,doc:r});return o}return[{data:e,name:t,parent:n,doc:r}]},f.prototype.v=function(t,e){var n=e.doc._vars,r=n[t];if(void 0===r){var o=this.findSymbol(t);r="function"==typeof o?o(this,e,0,1):o,n[t]=r}return r},f.prototype.f=function(t,e,n,r,o){var i=this.findSymbol(t);if(arguments.length>5){var s=Array.prototype.slice.call(arguments);return s[0]=this,i.apply(this,s)}return void 0!==o?i(this,e,n,r,o):i(this,e,n,r)},f.prototype.k=function(t,e,n,o){function i(t){var e,n=l[t];if(u.xml){if(e="",n)for(var r=0,o=n.length;r<o;r++){var i=n[r];e+=a.b(f,i.c,i.i,i.l,{})}}else if(e=[],n)for(var r=0,o=n.length;r<o;r++){var i=n[r];e=e.concat(a.b(f,i.c,i.i,i.l))}return c[t]=e,e}var s=n.doc._keys,a=this.findSymbol(t),u=s[t];u||(u=this._initKey(a,t,e,n));var c=u.values,l=u.nodes,f=this;if(o){var p;if(u.xml){p="";for(var h=0,d=e.length;h<d;h++){var n=e[h];p+=i(r.nodeValue(n))}}else{p=[];for(var h=0,d=e.length;h<d;h++){var n=e[h];p=p.concat(i(r.nodeValue(n)))}}return p}var v=c[e];return void 0===v&&(v=i(e)),v},f.prototype._initKey=function(t,e,n,o){function i(t,e){var n=c[t];n||(n=c[t]=[]),n.push(e)}var s=o.doc._keys,a=s[e]={};a.xml="xml"===t.bt;var u=t.n(this,o),c=a.nodes={};if("nodeset"===t.ut)for(var l=0,f=u.length;l<f;l++)for(var p=u[l],h=t.u(this,p,l,f),d=0,v=h.length;d<v;d++)i(r.nodeValue(h[d]),{c:p,i:l,l:f});else for(var l=0,f=u.length;l<f;l++){var p=u[l],h=t.u(this,p,l,f);i(h,{c:p,i:l,l:f})}return a.values={},a},f.prototype.findSymbol=function(t){for(var e=this.imports,n=0,r=e.length;n<r;n++){var o=e[n],i=o[t];if(void 0!==i)return i}},r.Module=f})(),t.exports=r},3166:function(t,e,n){var r;(function(){!(function(o){var i=(function(){var t=[],e=function(e){return t.push(e),1===t.length},n=function(){var e=t,n=0,r=t.length;for(t=[];n<r;)e[n++]()};if("function"==typeof setImmediate)return function(t){e(t)&&setImmediate(n)};if("object"==typeof process&&process.nextTick)return function(t){e(t)&&process.nextTick(n)};var r=o.MutationObserver||o.WebKitMutationObserver;if(r){var i=1,s=document.createTextNode("");return new r(n).observe(s,{characterData:!0}),function(t){e(t)&&(s.data=i*=-1)}}if(o.postMessage){var a=!0;if(o.attachEvent){var u=function(){a=!1};o.attachEvent("onmessage",u),o.postMessage("__checkAsync","*"),o.detachEvent("onmessage",u)}if(a){var c="__promise"+Math.random()+"_"+new Date,l=function(t){t.data===c&&(t.stopPropagation&&t.stopPropagation(),n())};return o.addEventListener?o.addEventListener("message",l,!0):o.attachEvent("onmessage",l),function(t){e(t)&&o.postMessage(c,"*")}}}var f=o.document;if("onreadystatechange"in f.createElement("script")){var p=function(){var t=f.createElement("script");t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,n()},(f.documentElement||f.body).appendChild(t)};return function(t){e(t)&&p()}}return function(t){e(t)&&setTimeout(n,0)}})(),s=function(t){i((function(){throw t}))},a=function(t){return"function"==typeof t},u=function(t){return null!==t&&"object"==typeof t},c=Object.prototype.toString,l=Array.isArray||function(t){return"[object Array]"===c.call(t)},f=function(t){for(var e=[],n=0,r=t.length;n<r;)e.push(n++);return e},p=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},h=function(t,e){return function(n){t.call(this,n,e)}},d=o.PromiseRejectionEvent?function(t,e){new o.PromiseRejectionEvent("unhandledrejection",{promise:e,reason:t})}:"object"==typeof process&&process.emit?function(t,e){process.emit("unhandledRejection",t,e)}:function(){},v=function(){this._promise=new _};v.prototype={promise:function(){return this._promise},resolve:function(t){this._promise.isResolved()||this._promise._resolve(t)},reject:function(t){this._promise.isResolved()||(w.isPromise(t)?(t=t.then((function(t){var e=w.defer();return e.reject(t),e.promise()})),this._promise._resolve(t)):this._promise._reject(t))},notify:function(t){this._promise.isResolved()||this._promise._notify(t)}};var y={PENDING:0,RESOLVED:1,FULFILLED:2,REJECTED:3},_=function(t){if(this._value=void 0,this._status=y.PENDING,this._shouldEmitUnhandledRejection=!0,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[],t){var e=this,n=t.length;try{t((function(t){e.isResolved()||e._resolve(t)}),n>1?function(t){e.isResolved()||e._reject(t)}:void 0,n>2?function(t){e.isResolved()||e._notify(t)}:void 0)}catch(t){this._reject(t)}}};_.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==y.PENDING},isFulfilled:function(){return this._status===y.FULFILLED},isRejected:function(){return this._status===y.REJECTED},then:function(t,e,n,r){this._shouldEmitUnhandledRejection=!1;var o=new v;return this._addCallbacks(o,t,e,n,r),o.promise()},catch:function(t,e){return this.then(void 0,t,e)},fail:function(t,e){return this.then(void 0,t,e)},always:function(t,e){var n=this,r=function(){return t.call(this,n)};return this.then(r,r,e)},progress:function(t,e){return this.then(void 0,void 0,t,e)},spread:function(t,e,n){return this.then((function(e){return t.apply(this,e)}),e,n)},done:function(t,e,n,r){this.then(t,e,n,r).fail(s)},delay:function(t){var e,n=this.then((function(n){var r=new v;return e=setTimeout((function(){r.resolve(n)}),t),r.promise()}));return n.always((function(){clearTimeout(e)})),n},timeout:function(t){var e=new v,n=setTimeout((function(){e.reject(new w.TimedOutError("timed out"))}),t);return this.then((function(t){e.resolve(t)}),(function(t){e.reject(t)})),e.promise().always((function(){clearTimeout(n)})),e.promise()},_vow:!0,_resolve:function(t){if(!(this._status>y.RESOLVED)){if(t===this)return void this._reject(TypeError("Can't resolve promise with itself"));if(this._status=y.RESOLVED,t&&t._vow)return void(t.isFulfilled()?this._fulfill(t.valueOf()):t.isRejected()?(t._shouldEmitUnhandledRejection=!1,this._reject(t.valueOf())):t.then(this._fulfill,this._reject,this._notify,this));if(u(t)||a(t)){var e;try{e=t.then}catch(t){return void this._reject(t)}if(a(e)){var n=this,r=!1;try{e.call(t,(function(t){r||(r=!0,n._resolve(t))}),(function(t){r||(r=!0,n._reject(t))}),(function(t){n._notify(t)}))}catch(t){r||this._reject(t)}return}}this._fulfill(t)}},_fulfill:function(t){this._status>y.RESOLVED||(this._status=y.FULFILLED,this._value=t,this._callCallbacks(this._fulfilledCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=void 0)},_reject:function(t){if(!(this._status>y.RESOLVED)){if(this._status=y.REJECTED,this._value=t,this._callCallbacks(this._rejectedCallbacks,t),!this._rejectedCallbacks.length){var e=this;i((function(){e._shouldEmitUnhandledRejection&&d(t,e)}))}this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=void 0}},_notify:function(t){this._callCallbacks(this._progressCallbacks,t)},_addCallbacks:function(t,e,n,r,o){n&&!a(n)?(o=n,n=void 0):r&&!a(r)&&(o=r,r=void 0),n&&(this._shouldEmitUnhandledRejection=!1);var i;this.isRejected()||(i={defer:t,fn:a(e)?e:void 0,ctx:o},this.isFulfilled()?this._callCallbacks([i],this._value):this._fulfilledCallbacks.push(i)),this.isFulfilled()||(i={defer:t,fn:n,ctx:o},this.isRejected()?this._callCallbacks([i],this._value):this._rejectedCallbacks.push(i)),this._status<=y.RESOLVED&&this._progressCallbacks.push({defer:t,fn:r,ctx:o})},_callCallbacks:function(t,e){var n=t.length;if(n){var r=(this.isResolved(),this.isFulfilled()),o=this.isRejected();i((function(){for(var i,s,a,u=0;u<n;)if(i=t[u++],s=i.defer,a=i.fn){var c,l=i.ctx;try{c=l?a.call(l,e):a(e)}catch(t){s.reject(t);continue}r||o?s.resolve(c):s.notify(c)}else r?s.resolve(e):o?s.reject(e):s.notify(e)}))}}};var g={cast:function(t){return w.cast(t)},all:function(t){return w.all(t)},race:function(t){return w.anyResolved(t)},resolve:function(t){return w.resolve(t)},reject:function(t){return w.reject(t)}};for(var m in g)g.hasOwnProperty(m)&&(_[m]=g[m]);var w={Deferred:v,Promise:_,defer:function(){return new v},when:function(t,e,n,r,o){return w.cast(t).then(e,n,r,o)},fail:function(t,e,n){return w.when(t,void 0,e,n)},always:function(t,e,n){return w.when(t).always(e,n)},progress:function(t,e,n){return w.when(t).progress(e,n)},spread:function(t,e,n,r){return w.when(t).spread(e,n,r)},done:function(t,e,n,r,o){w.when(t).done(e,n,r,o)},isPromise:function(t){return u(t)&&a(t.then)},cast:function(t){return t&&t._vow?t:w.resolve(t)},valueOf:function(t){return t&&a(t.valueOf)?t.valueOf():t},isFulfilled:function(t){return!t||!a(t.isFulfilled)||t.isFulfilled()},isRejected:function(t){return!(!t||!a(t.isRejected))&&t.isRejected()},isResolved:function(t){return!t||!a(t.isResolved)||t.isResolved()},resolve:function(t){var e=w.defer();return e.resolve(t),e.promise()},fulfill:function(t){var e=w.defer(),n=e.promise();return e.resolve(t),n.isFulfilled()?n:n.then(null,(function(t){return t}))},reject:function(t){var e=w.defer();return e.reject(t),e.promise()},invoke:function(t,e){var n,r=Math.max(arguments.length-1,0);if(r){n=Array(r);for(var i=0;i<r;)n[i++]=arguments[i]}try{return w.resolve(n?t.apply(o,n):t.call(o))}catch(t){return w.reject(t)}},all:function(t){var e=new v,n=l(t),r=n?f(t):p(t),o=r.length,i=n?[]:{};if(!o)return e.resolve(i),e.promise();var s=o;return w._forEach(t,(function(t,n){i[r[n]]=t,--s||e.resolve(i)}),e.reject,e.notify,e,r),e.promise()},allResolved:function(t){var e=new v,n=l(t),r=n?f(t):p(t),o=r.length,i=n?[]:{};if(!o)return e.resolve(i),e.promise();var s=function(){--o||e.resolve(t)};return w._forEach(t,s,s,e.notify,e,r),e.promise()},allPatiently:function(t){return w.allResolved(t).then((function(){var e,n,r,o,i=l(t),s=i?f(t):p(t),a=s.length,u=0;if(!a)return i?[]:{};for(;u<a;)r=s[u++],o=t[r],w.isRejected(o)?(e||(e=i?[]:{}),i?e.push(o.valueOf()):e[r]=o.valueOf()):e||((n||(n=i?[]:{}))[r]=w.valueOf(o));if(e)throw e;return n}))},any:function(t){var e=new v,n=t.length;if(!n)return e.reject(Error()),e.promise();var r,o=0;return w._forEach(t,e.resolve,(function(t){o||(r=t),++o===n&&e.reject(r)}),e.notify,e),e.promise()},anyResolved:function(t){var e=new v;return t.length?(w._forEach(t,e.resolve,e.reject,e.notify,e),e.promise()):(e.reject(Error()),e.promise())},delay:function(t,e){return w.resolve(t).delay(e)},timeout:function(t,e){return w.resolve(t).timeout(e)},_forEach:function(t,e,n,r,o,i){for(var s=i?i.length:t.length,a=0;a<s;)w.when(t[i?i[a]:a],h(e,a),n,r,o),++a},TimedOutError:(function(t){var e=function(e){this.name=t,this.message=e};return e.prototype=new Error,e})("TimedOut")},b=!0;"object"==typeof t&&"object"==typeof t.exports&&(t.exports=w,b=!1),"object"==typeof modules&&a(modules.define)&&(modules.define("vow",(function(t){t(w)})),b=!1),void 0!==(r=function(t,e,n){n.exports=w}.call(e,n,e,t))&&(t.exports=r),b=!1,b&&(o.vow=w)})("undefined"!=typeof window?window:global)}).call(window)},3167:function(t,e){(function(){!(function(t){var e=function(t){this._res=t,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]};e.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(t){this.isResolved()||(this._isFulfilled=!0,this._res=t,this._callCallbacks(this._fulfilledCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=n)},reject:function(t){this.isResolved()||(this._isRejected=!0,this._res=t,this._callCallbacks(this._rejectedCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=n)},notify:function(t){this.isResolved()||this._callCallbacks(this._progressCallbacks,t)},then:function(t,r,o,i){r&&!s(r)?(i=r,r=n):o&&!s(o)&&(i=o,o=n);var a,u=new e;return this._isRejected||(a={promise:u,fn:s(t)?t:n,ctx:i},this._isFulfilled?this._callCallbacks([a],this._res):this._fulfilledCallbacks.push(a)),this._isFulfilled||(a={promise:u,fn:r,ctx:i},this._isRejected?this._callCallbacks([a],this._res):this._rejectedCallbacks.push(a)),this.isResolved()||this._progressCallbacks.push({promise:u,fn:o,ctx:i}),u},fail:function(t,e){return this.then(n,t,e)},always:function(t,e){var n=this,r=function(){return t.call(this,n)};return this.then(r,r,e)},progress:function(t,e){return this.then(n,n,t,e)},spread:function(t,e,n){return this.then((function(e){return t.apply(this,e)}),e,n)},done:function(t,e,n,r){this.then(t,e,n,r).fail(i)},delay:function(t){var n,r=this.then((function(r){var o=new e;return n=setTimeout((function(){o.fulfill(r)}),t),o}));return r.always((function(){clearTimeout(n)})),r},timeout:function(t){var n=new e,r=setTimeout((function(){n.reject(Error("timed out"))}),t);return n.sync(this),n.always((function(){clearTimeout(r)})),n},sync:function(t){t.then(this.fulfill,this.reject,this.notify,this)},_callCallbacks:function(t,e){var n=t.length;if(n){var i=this.isResolved(),s=this.isFulfilled();o((function(){for(var o,a,u,c=0;c<n;)if(o=t[c++],a=o.promise,u=o.fn){var l,f=o.ctx;try{l=f?u.call(f,e):u(e)}catch(t){a.reject(t);continue}i?r.isPromise(l)?(function(t){l.then((function(e){t.fulfill(e)}),(function(e){t.reject(e)}),(function(e){t.notify(e)}))})(a):a.fulfill(l):a.notify(l)}else i?s?a.fulfill(e):a.reject(e):a.notify(e)}))}}};var n,r={Promise:e,promise:function(t){return arguments.length?r.isPromise(t)?t:new e(t):new e},when:function(t,e,n,o,i){return r.promise(t).then(e,n,o,i)},fail:function(t,e,o){return r.when(t,n,e,o)},always:function(t,e,n){return r.promise(t).always(e,n)},progress:function(t,e,n){return r.promise(t).progress(e,n)},spread:function(t,e,n,o){return r.promise(t).spread(e,n,o)},done:function(t,e,n,o,i){r.promise(t).done(e,n,o,i)},isPromise:function(t){return t&&s(t.then)},valueOf:function(t){return r.isPromise(t)?t.valueOf():t},isFulfilled:function(t){return!r.isPromise(t)||t.isFulfilled()},isRejected:function(t){return!!r.isPromise(t)&&t.isRejected()},isResolved:function(t){return!r.isPromise(t)||t.isResolved()},fulfill:function(t){return r.when(t,n,(function(t){return t}))},reject:function(t){return r.when(t,(function(t){var n=new e;return n.reject(t),n}))},resolve:function(t){return r.isPromise(t)?t:r.when(t)},invoke:function(e){try{return r.promise(e.apply(t,a.call(arguments,1)))}catch(t){return r.reject(t)}},forEach:function(t,e,n,o){for(var i=o?o.length:t.length,s=0;s<i;)r.when(t[o?o[s]:s],e,n),++s},all:function(t){var n=new e,o=c(t),i=o?l(t):f(t),s=i.length,a=o?[]:{};if(!s)return n.fulfill(a),n;var u=s,p=function(){if(!--u){for(var e=0;e<s;)a[i[e]]=r.valueOf(t[i[e++]]);n.fulfill(a)}},h=function(t){n.reject(t)};return r.forEach(t,p,h,i),n},allResolved:function(t){var n=new e,o=c(t),i=o?l(t):f(t),s=i.length,a=o?[]:{};if(!s)return n.fulfill(a),n;var u=function(){--s||n.fulfill(t)};return r.forEach(t,u,u,i),n},allPatiently:function(t){return r.allResolved(t).then((function(){var e,n,o,i,s=c(t),a=s?l(t):f(t),u=a.length,p=0;if(!u)return s?[]:{};for(;p<u;)o=a[p++],i=t[o],r.isRejected(i)?(e||(e=s?[]:{}),s?e.push(i.valueOf()):e[o]=i.valueOf()):e||((n||(n=s?[]:{}))[o]=r.valueOf(i));if(e)throw e;return n}))},any:function(t){var n=new e,o=t.length;if(!o)return n.reject(Error()),n;var i,s=0,a=function(t){n.fulfill(t)},u=function(t){s||(i=t),++s===o&&n.reject(i)};return r.forEach(t,a,u),n},delay:function(t,e){return r.promise(t).delay(e)},timeout:function(t,e){return r.promise(t).timeout(e)}},o=(function(){var e=[],n=function(t){return 1===e.push(t)},r=function(){var t=e,n=0,r=e.length;for(e=[];n<r;)t[n++]()};if("function"==typeof setImmediate)return function(t){n(t)&&setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(t){n(t)&&process.nextTick(r)};if(t.postMessage){var o=!0;if(t.attachEvent){var i=function(){o=!1};t.attachEvent("onmessage",i),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",i)}if(o){var s="__promise"+ +new Date,a=function(t){t.data===s&&(t.stopPropagation&&t.stopPropagation(),r())};return t.addEventListener?t.addEventListener("message",a,!0):t.attachEvent("onmessage",a),function(e){n(e)&&t.postMessage(s,"*")}}}var u=t.document;if("onreadystatechange"in u.createElement("script")){var c=function(){var t=u.createElement("script");t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,r()},(u.documentElement||u.body).appendChild(t)};return function(t){n(t)&&c()}}return function(t){n(t)&&setTimeout(r,0)}})(),i=function(t){o((function(){throw t}))},s=function(t){return"function"==typeof t},a=Array.prototype.slice,u=Object.prototype.toString,c=Array.isArray||function(t){return"[object Array]"===u.call(t)},l=function(t){for(var e=[],n=0,r=t.length;n<r;)e.push(n++);return e},f=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},p=!0;"object"==typeof modules&&(modules.define("vow",(function(t){t(r)})),p=!1),"function"==typeof define&&(define((function(t,e,n){n.exports=r})),p=!1),p&&(t.Vow=r)})(this),Vow.Promise.prototype.__reject=Vow.Promise.prototype.reject,Vow.Promise.prototype.reject=function(t){t instanceof Error&&ns.log.exception("promise.exception",t),this.__reject(t)},(function(e,n){"use strict";var r={};r.de=void 0===e,r.inherit=function(t,e,n){var o=function(){};o.prototype=e.prototype;var i=t.prototype=new o;if(n)if(Array.isArray(n))for(var s=0,a=n.length;s<a;s++)r.extend(i,n[s]);else r.extend(i,n);return i.super_=e.prototype,i.constructor=t,t},r.extend=function(t){for(var e=1,n=arguments.length;e<n;e++){var r=arguments[e];for(var o in r)t[o]=r[o]}return t},r.nop=function(){},r.true=function(){return!0},r.false=function(){return!1},r.value=function(t){return function(){return t}},r.logger=function(t){return t?function(){var e=[].slice.call(arguments);console.log.apply(null,[t].concat(e))}:console.log},r.de?r.next=function(t){process.nextTick(t)}:r.next=function(t){setTimeout(t,0)},r.de&&(t.exports=r);var r=r||require("./no.base.js");r.Parser=function(t,e){this._rules=t,this._tokens=e||{}},r.Parser.prototype.start=function(t,e){this.input=t,this.p=0,this.s=t;var n=this.parse(e);return this.s&&this.error("End of string expected"),n},r.Parser.prototype.parse=function(t,e){var n=this._rules[t],r=this.p,o=n.call(this,e);return o._start=r,o._end=this.p,o._input=this.input,o},r.Parser.prototype.test=function(t){var e=this._tokens[t];if(e){var n=e.exec(this.s);return n&&n[0]}if(this.la(t.length)===t)return t},r.Parser.prototype.match=function(t){var e=this.test(t);return e||this.error("Token "+t+" expected"),this.move(e.length),e},r.Parser.prototype.la=function(t){return this.s.substr(0,t||1)},r.Parser.prototype.move=function(t){t||(t=1),this.s=this.s.substr(t),this.p+=t},r.Parser.prototype.skip=function(){var t=/^\s+/.exec(this.s);t&&this.move(t[0].length)},r.Parser.prototype.error=function(t){throw Error(t+" at "+this.p+": "+this.s)};var r=r||require("./no.base.js");r.de&&(require("./no.parser.js"),t.exports=r),(function(){function t(t){this.data=t}function e(e,r){if(r instanceof t)return n(r,e.scalar());for(var o=r.nodes,i=e.scalar(),s=0;s<o.length;s++)if(i==o[s].scalar())return!0;return!1}function n(e,n){var r=e.data;if(Array.isArray(r)){for(var o=0;o<r.length;o++)if(new t(r[o]).scalar()==n)return!0;return!1}return e.scalar()==n}function o(){this.nodes=[]}function i(t,e){var n=t+"::"+e,r=b[n];return r||(r=b[n]=u(w.start(t,e))),r}function s(t){var e={};for(var n in t)e[n]=r.jpath.expr(t[n]);return function(t,n,o){var i={};for(var s in e)i[s]=r.jpath.toScalar(e[s](t,n,o));return i}}function a(t){for(var e=[],n=t.length,o=0;o<n;o++)e.push(r.jpath.expr(t[o]));return function(t,o,i){for(var s=[],a=0;a<n;a++)s.push(r.jpath.toScalar(e[a](t,o,i)));return s}}function u(t){for(var e=[],n="jpath"===t._id?l(t,e):c(t,e),o="",i=0;i<=n;i++)o+="function t"+i+"(node, root, vars, funcs) {\n"+e[i]+"\n}\n\n";return o+="return function(data, vars, funcs) {\nvar node = new no.JNode(data);\nreturn t"+n+"(node, node, vars, funcs);\n}\n",Function("no",o)(r)}function c(t,e){var n="return ("+f(t,e)+");";return e.push(n)-1}function l(t,e){var n="";t.abs&&(n+="node = root;\n");for(var r=t.steps,o=0,i=r.length;o<i;o++){var s=r[o],a=s._id;switch(a){case"nametest":n+='node = node.nametest("'+s.nametest+'");\n';break;case"star":n+="node = node.startest();\n";break;case"pred":case"index":s.expr._as="pred"===a?v:h;n+="node = node."+a+"(t"+c(s.expr,e)+", root, vars, funcs);\n";break;case"guard":n+="if (!("+f(s.expr,e)+")) { return node.empty; }\n"}"guard"!==a&&(n+="if (node.isEmpty()) { return node.empty; }\n")}return n+="return node;",e.push(n)-1}function f(t,e){var n;switch(t._id){case"root":n="root";break;case"self":n="node";break;case"number":n=t.value;break;case"string_literal":n=JSON.stringify(t.value);break;case"string":n="("+t.value.map((function(t){return t._as=h,f(t,e)})).join(" + ")+")";break;case"var":n='(new no.JNode(vars["'+t.name+'"]))';break;case"func":n='funcs["'+t.name+'"](';for(var r=0,o=t.args.length;r<o;r++){var i=t.args[r];i._as=h,n+=r?",":"",n+=f(i,e)}n+=")";break;case"unop":t.expr._as="!"===t.op?v:h,n=t.op+"("+f(t.expr,e)+")";break;case"binop":var s,o=t.left,a=t.right,u=o._type,c=a._type,p=t.op;switch(p){case"&&":case"||":s=u===v&&c===v?v:h;break;case"==":case"!=":u===c||u!==v&&c!==v||(s=v);break;default:s=h}s&&(o._as=a._as=s);var y=f(o,e),_=f(a,e);if("=="===p||"!="===p){if(u===d||c===d){if(u===h){var g=_;_=y,y=g}n="("+y+").cmp"+(u===c?"N":"S")+"("+_+")"}n&&"!="===p&&(n="!("+n+")")}void 0===n&&(n="("+y+" "+t.op+" "+_+")");break;case"subexpr":n="("+f(t.expr,e)+")";break;case"jpath":var m=l(t,e);n="t"+m+"(node, root, vars, funcs)";break;case"filter":var m=l(t.jpath,e);n="t"+m+'(new no.JNode(vars["'+t.name+'"]), root, vars, funcs)'}return t._as&&t._as!==t._type&&(t._type===d?n="("+n+")."+t._as+"()":t._type===h&&(n="!!("+n+")")),n}function p(t){for(var e=t.split("."),n=1,r=e.length-1,o="var r = data; var t;";n<r;n++)o+='t = r["'+e[n]+'"];',o+='if (t == null) { t = r["'+e[n]+'"] = {}; }',o+="r = t;";return o+='r["'+e[n]+'"] = value;',o+="return data;",new Function("data","value",o)}t.prototype.empty=new o,t.prototype.isEmpty=function(){return!1},t.prototype.nametest=function(e,n){var r=this.data;if(!r)return this.empty;if(Array.isArray(r)){n||(n=new o);for(var i=0;i<r.length;i++)new t(r[i]).nametest(e,n);return n}var s=r[e];if(void 0===s)return this.empty;var a=new t(s);return n?n.push(a):a},t.prototype.startest=function(e){e||(e=new o);var n=this.data;if(Array.isArray(n))for(var r=0;r<n.length;r++)new t(n[r]).startest(e);else for(var i in n)this.nametest(i,e);return e},t.prototype.pred=function(e,n,r,i){var s=this.data;if(Array.isArray(s)){for(var a=new o,u=0;u<s.length;u++){var c=new t(s[u]);e(c,n,r,i)&&a.push(c)}return a}return e(this,n,r,i)?this:this.empty},t.prototype.index=function(e,n,r,o){var i=this.data;if(Array.isArray(i)){var s=i[e(this,n,r,o)];return void 0!==s?new t(s).toNodeset():this.empty}return 0===e?this:this.empty},t.prototype.toArray=function(){return[this.data]},t.prototype.toNodeset=function(){return(new o).push(this)},t.prototype.scalar=function(){var t=this.data;return"object"==typeof t?"":t},t.prototype.boolean=function(){var t=this.data;return Array.isArray(t)?t.length>0:!!t},t.prototype.cmpN=function(n){var r=this.data;if(Array.isArray(r)){for(var o=0;o<r.length;o++)if(e(new t(r[o]),n))return!0;return!1}return e(this,n)},t.prototype.cmpS=function(t){return n(this,t)},o.prototype.empty=t.prototype.empty,o.prototype.isEmpty=function(){return!this.nodes.length},o.prototype.push=function(t){return this.nodes.push(t),this},o.prototype.nametest=function(t,e){var n=this.nodes;e||(e=new o);for(var r=0;r<n.length;r++)n[r].nametest(t,e);return e},o.prototype.startest=function(t){var e=this.nodes;t||(t=new o);for(var n=0;n<e.length;n++)e[n].startest(t);return t},o.prototype.pred=function(t,e,n,r){for(var i=this.nodes,s=new o,a=0;a<i.length;a++){var u=i[a];t(u,e,n,r)&&s.push(u)}return s},o.prototype.index=function(t){var e=this.nodes[t];return void 0!==e?(new o).push(e):this.empty},o.prototype.toArray=function(){for(var t=[],e=this.nodes,n=0;n<e.length;n++)t.push(e[n].data);return t},o.prototype.scalar=function(){var t=this.nodes;return t.length?t[0].scalar():""},o.prototype.boolean=function(){var t=this.nodes;return!!t.length&&t[0].boolean()},o.prototype.cmpN=function(t){for(var e=this.nodes,n=0,r=e.length;n<r;n++)if(e[n].cmpN(t))return!0;return!1},o.prototype.cmpS=function(t){for(var e=this.nodes,n=0,r=e.length;n<r;n++)if(e[n].cmpS(t))return!0;return!1},r.JNode=t,r.JNodeset=o;var h="scalar",d="nodeset",v="boolean",y={"*":6,"/":6,"%":6,"+":5,"-":5,"<=":4,">=":4,"<":4,">":4,"==":3,"!=":3,"&&":2,"||":1},_={};_.SELF=/^\.(?![a-zA-Z_*.[])/,_.ROOT=/^\/(?![.[])/,_.BINOP=/^(?:\+|-|\*|\/|%|==|!=|<=|>=|<|>|&&|\|\|)/,_.UNOP=/^(?:\+|-|!)/,_.DIGIT=/^[0-9]/,_.ID=/^[a-zA-Z_][a-zA-Z0-9-_]*/,_.NUMBER=/^[0-9]+(?:\.[0-9]+)?/,_.CHARS=/^[^"{}\\]+/;var g={};g.expr=function(){function t(t){for(var r,o,i;(r=e[0])&&y[r]>=t;)i=n.shift(),o=n.shift(),n.unshift({_id:"binop",_type:"+-*/%".indexOf(r)>-1?h:v,_local:o._local||i._local,op:e.shift(),left:o,right:i})}var e=[],n=[this.parse("unary")];this.skip();for(var r,o=0;r=this.test("BINOP");){this.move(r.length),this.skip();var i=y[r];i<=o&&t(i),e.unshift(r),n.unshift(this.parse("unary")),this.skip(),o=i}return t(0),n[0]},g.unary=function(){var t;if(t=this.test("UNOP")){this.move();var e=this.parse("unary");return{_id:"unop",_type:"!"===t?v:h,_local:e._local,op:t,expr:e}}return this.parse("primary")},g.primary=function(){switch(this.la()){case'"':return this.parse("string");case".":case"/":return this.parse("jpath");case"(":return this.parse("subexpr")}if(this.test("DIGIT"))return{_id:"number",_type:h,value:this.match("NUMBER")};var t=this.match("ID");if(this.test("."))return{_id:"filter",_type:d,name:t,jpath:this.parse("jpath")};if(this.test("(")){this.move(),this.skip();var e=[];if(!this.test(")"))for(e.push(this.parse("expr")),this.skip();this.test(",");)this.move(),this.skip(),e.push(this.parse("expr")),this.skip();return this.match(")"),{_id:"func",_type:h,name:t,args:e}}return{_id:"var",_type:d,name:t}},g.subexpr=function(){this.move(),this.skip();var t=this.parse("expr");return this.skip(),this.match(")"),{_id:"subexpr",_type:t._type,_local:t._local,expr:t}},g.jpath=function(){if(this.test("SELF"))return this.move(),{_id:"self",_type:d,_local:!0};if(this.test("ROOT"))return this.move(),{_id:"root",_type:d};var t;this.test("/")&&(this.move(),t=!0);for(var e=[];;){var n=this.la();if("."===n)e.push(this.parse("step"));else{if("["!==n)break;var r=this.parse("pred");"guard"===r._id?e.unshift(r):e.push(r)}}return{_id:"jpath",_type:d,_local:!t,abs:t,steps:e}},g.step=function(){this.move();var t=this.la();return"["===t?this.parse("pred"):"*"===t?(this.move(),{_id:"star"}):{_id:"nametest",nametest:this.match("ID")}},g.pred=function(){this.move(),this.skip();var t=this.parse("expr");this.skip(),this.match("]");var e="index";return t._local?e="pred":t._type===v&&(e="guard"),{_id:e,expr:t}},g.string=function(){this.match('"');var t=this.parse("string_content");return this.match('"'),t};var m={"{{":"{","}}":"}",'\\"':'"',"\\\\":"\\"};g.string_content=function(){function t(){o&&(r.push(e(o)),o="")}function e(t){return{_id:"string_literal",_type:h,value:t}}for(var n,r=[],o="";this.s;)if(n=m[this.la(2)])o+=n,this.move(2);else{if('"'===(n=this.la()))break;"\\"===n?(o+=n,this.move()):"{"===n?(t(),this.move(),this.skip(),r.push(this.parse("expr")),this.skip(),this.match("}")):o+=this.match("CHARS")}return t(),r.length||r.push(e("")),{_id:"string",_type:h,value:r}};var w=new r.Parser(g,_),b={};r.jpath=function(t,e,n,o){return r.jpath.toScalar(r.jpath.expr(t)(e,n,o))},r.jpath.raw=function(t,e,n,o){return r.jpath.expr(t)(e,n,o)},r.jpath.scalar=function(t){var e=r.jpath.expr(t);return function(t,n,o){return r.jpath.toScalar(e(t,n,o))}},r.jpath.boolean=function(t){var e=r.jpath.expr(t);return function(t,n,o){return r.jpath.toBoolean(e(t,n,o))}},r.jpath.string=function(t){return i(t,"string_content")},r.jpath.expr=function(t){var e=typeof t;return"string"===e?i(t,"expr"):t&&"object"===e?Array.isArray(t)?a(t):s(t):function(){return t}},r.jpath.toScalar=function(e){return e instanceof t?e.data:e instanceof o?e.isEmpty()?void 0:e.toArray():e},r.jpath.toBoolean=function(e){return e instanceof t||e instanceof o?e.boolean():e};var x={};r.jpath.set=function(t,e,n){return(x[t]||(x[t]=p(t)))(e,n)}})();var o={};o.todo=function(){throw new Error("Unimplemented")},o.parseQuery=function(t){var e={};return t.split("&").forEach((function(n){var r=n.split("="),i=r.shift();if(i){var s=r.join("=");if(void 0===s)s="";else try{s=decodeURIComponent(s)}catch(e){s="",o.log.info("ns.parseQuery.invalid-param",{query:t,chunk:n})}i in e?(Array.isArray(e[i])||(e[i]=[e[i]]),e[i].push(s)):e[i]=s}})),e},o.renderString=function(t,e,n){return yr.run(n||"main",t,e)},o.renderNode=function(t,e,n){var r=o.html2node(o.renderString(t,e,n));return r?r.firstChild:null},o.init=function(){o.action.init(),o.router.init(),o.history.init(),o.initMainView()},o.initMainView=function(){var t=o.View.create("app");t._setNode(n.getElementById("app")),t.invalidate(),o.MAIN_VIEW=t},o.assert=function(t,e,n){t||o.assert.fail.apply(this,Array.prototype.slice.call(arguments,1))},o.assert.fail=function(t,e){for(var n=Array.prototype.slice.call(arguments,2),r=0;r<n.length;r++)e=e.replace("%s",n[r]);throw new Error("["+t+"] "+e)},o.key=function(t,e){var n=t;e=e||{};for(var r in e)n+="&"+r+"="+encodeURIComponent(e[r]);return n},o.params2query=function(t){var e,n,r=[];for(e in t)if(n=t[e],Array.isArray(n))for(var o=0;o<n.length;o++)r.push(encodeURIComponent(e)+"="+encodeURIComponent(n[o]));else r.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return r.join("&")},o.reset=function(){o.action&&o.action._reset(),o.router._reset(),o.layout._reset(),o.Model._reset(),o.View._reset(),o.request._reset(),o.page._reset(),o.page.history.reset(),o.MAIN_VIEW=null},o.VERSION="0.8.15-fix-660",o.L={},o.L.VIEW="view",o.L.ASYNC="async",o.L.BOX="box",o.V={},o.V.STATUS={NONE:"none",LOADING:"loading",OK:"ok",INVALID:"invalid"},o.M={},o.M.STATUS={ERROR:"error",INITED:"inited",NONE:"none",OK:"ok",INVALID:"invalid"},o.R={NOT_APP_URL:"ns-router-not-app",NOT_FOUND:"not-found",REDIRECT:"ns-router-redirect"},o.U={},o.U.STATUS={MODELS:"models",EXPIRED:"expired"},o.U.EXEC={GLOBAL:"global",ASYNC:"async",PARALLEL:"parallel"},o.DEBUG=!1,o.H={DEFAULTS:{dataType:"json",type:"POST"}},o.V.EVENTS={click:"click",dblclick:"dblclick",mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"},o.V.DOM_EVENTS=["blur","change","input","click","dblclick","dragstart","dragenter","dragover","dragleave","drag","drop","dragend","focus","focusin","focusout","keydown","keypress","keyup","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","resize","scroll","submit"],o.V.NS_EVENTS=["ns-view-async","ns-view-destroyed","ns-view-init","ns-view-htmlinit","ns-view-show","ns-view-touch","ns-view-hide","ns-view-htmldestroy"],o.IS_TOUCH=(function(){return"boolean"==typeof e.NS_IS_TOUCH?e.NS_IS_TOUCH:Boolean("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)})(),o.IS_TOUCH&&(o.V.DOM_EVENTS.push("swipe","swipeleft","swiperight","tap","touchstart","touchmove","touchend"),o.V.EVENTS={click:"tap",dblclick:"doubletap",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"}),(function(t){t.replaceNode=function(t,e){return t===e||!!t.parentNode&&(t.parentNode.replaceChild(e,t),!0)},t.removeNode=function(t){var e=t.parentNode;e&&e.removeChild(t)},t.html2node=function(t){if(!t)return null;var e=n.createElement("div");return e.innerHTML=t,e},t.childrenIterator=function(t){return (function(t){var e=-1;return{getNext:function(){return e++,t[e]||null}}})(t.children)};var e=/[\t\r\n]/g;void 0!==n&&n.createElement("div").classList?t.hasClass=function(t,e){return t.classList.contains(e)}:t.hasClass=function(t,n){return n=" "+n+" ",1===t.nodeType&&(" "+t.className+" ").replace(e," ").indexOf(n)>=0},void 0!==n&&n.getElementsByClassName?t.byClass=function(t,e){return e=e||n,e.getElementsByClassName(t)}:t.byClass=function(t,e){return e=e||n,$(e).find("."+t)}})(o),(function(t){var e=/[&<>"'\/]/g,n=(function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return function(e){return t[e]}})();t.entityify=function(t){return String(t).replace(e,n)};var r=/&([^&;]+);/g,o=(function(){var t={amp:"&",lt:"<",gt:">",quot:'"',"#x27":"'","#x2F":"/"};return function(e,n){return t[n]||e}})();t.deentityify=function(t){return String(t).replace(r,o)}})(o),o.Events={},o.Events.on=function(t,e){var n=this._nsevents_handlers||(this._nsevents_handlers={});return o.assert("function"==typeof e,"ns.Events",'Handler for event "%s" in not a function.',t),(n[t]||(n[t]=[])).push(e),this},o.Events.once=function(t,e){var n=this,r=function(){n.off(t,r),e.apply(this,arguments)};return r.__original=e,this.on(t,r),this},o.Events.off=function(t,e){var n;if(e){if(n=this._nsevents_handlers&&this._nsevents_handlers[t])for(var r=0,o=n.length;r<o;r++)if(n[r]===e||n[r].__original===e){n.splice(r,1);break}}else(n=this._nsevents_handlers)&&(n[t]=null);return this},o.Events.trigger=function(t,e){var n=this._nsevents_handlers&&this._nsevents_handlers[t];if(n){n=n.slice();for(var r=0,i=n.length;r<i;r++)try{n[r].apply(this,arguments)}catch(e){o.log.exception("ns.events",e,{name:t})}}return this},o.Events.atrigger=function(t,e){var n=this,o=arguments;r.next((function(){n.trigger.apply(n,o)}))},o.Events.forward=function(t,e){return this.on(t,(function(t,n){e.trigger(t,n)}))},o.events=r.extend({},o.Events),(function(){function t(t){return"function"==typeof t}o.history={},o.history.init=function(){$(e).on("popstate",(function(t){t.preventDefault(),t.stopPropagation(),o.history.onpopstate(t)})),$(n).on(o.V.EVENTS.click,"a",o.history._onAnchorClick)},o.history.pushState=function(n,r){t(e.history.pushState)&&e.history.pushState(null,r||o.page.title(n),n)},o.history.replaceState=function(n,r){t(e.history.replaceState)&&e.history.replaceState(null,r||o.page.title(n),n)},o.history.onpopstate=function(){o.page.go("",!0)},o.history.followAnchorHref=function(t,e){return o.page.go(t)},o.history._onAnchorClick=function(t){var n=t.currentTarget;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return!0;if(n.protocol&&!/^https?:/.test(n.protocol))return!0;if(n.hostname&&n.hostname!==e.location.hostname)return!0;if(o.router.baseDir){var r=n.pathname,i=o.router.baseDir;if(r.substr(0,i.length)!==i)return!0}var s=n.getAttribute("href");if(!s||n.getAttribute("target"))return!0;var a=o.history.followAnchorHref(s,n);return Vow.isPromise(a)?(t.preventDefault(),!0):void 0}})(),o.http=function(t,e,n){n=r.extend({},o.H.DEFAULTS,n),n.url=t,n.data=e;var i=new Vow.Promise;return $.ajax(n).done((function(t){i.fulfill(t)})).fail((function(t,e,n){var r=n||e||"unknown error";i.reject({error:r,xhr:t})})),i},o.object={},o.object.clone=function(t){if(t&&"object"==typeof t){var e;if(Array.isArray(t)){e=[];for(var n=0;n<t.length;n++)e.push(o.object.clone(t[n]))}else{e={};for(var r in t)e[r]=o.object.clone(t[r])}return e}return t},o.object.isEmpty=function(t){for(var e in t)return!1;return!0},(function(){o.profile={},o.profile.startTimer=function(t){this._profileTimes||(this._profileTimes={}),o.assert(!this._profileTimes[t],"ns.profile","Timer '%s' is in use",t),this._profileTimes[t]=Date.now()},o.profile.stopTimer=function(t){return this._profileTimes||(this._profileTimes={}),o.assert(this._profileTimes[t],"ns.profile","Timer '%s' haven't been started",t),this._profileTimes[t]=Date.now()-this._profileTimes[t],this._profileTimes[t]},o.profile.switchTimer=function(t,e){this.stopTimer(t),this.startTimer(e)},o.profile.getTimer=function(t){this._profileTimes||(this._profileTimes={});var e=this._profileTimes[t];return"number"==typeof e?e:NaN},o.profile.getTimers=function(){return r.extend({},this._profileTimes)}})(),(function(t,e){t.action={};var n={},r=!1;t.action.define=function(t,e){if(t in n)throw new Error("[ns.action] Can't redefine '"+t+"'");n[t]=e},t.action.copy=function(t,e){if(e in n)throw new Error("[ns.action] Can't redefine '"+e+"'");if(!(t in n))throw new Error("[ns.action] '"+t+"' is not defined");n[e]=n[t]},t.action.run=function(e,r,o,i){var s=n[e];t.assert(s,"ns.action","%s is not defined",e);try{return s(e,r,o,i)}catch(e){t.log.exception("ns.action",e)}},t.action.getParams=function(t){var e=t.getAttribute("data-params");if(e&&"{"===e.charAt(0))try{return JSON.parse(e)}catch(t){}return{}},t.action.init=function(){if(!r){r=!0;var e=$("body"),n=[t.V.EVENTS.click,t.V.EVENTS.dblclick].join(" ");e.on(n,".ns-action",this._process)}},t.action._process=function(e){var n=e.currentTarget,r="dblclick"===e.type?n.getAttribute("data-dblclick-action"):n.getAttribute("data-click-action"),o=!0;return r&&(o=t.action.run(r,t.action.getParams(n),n,e)),void 0!==o&&!Vow.isPromise(o)&&o},t.action._reset=function(){n={}}})(o),(function(){o.Model=function(){},r.extend(o.Model.prototype,o.Events);var t={},e={},n={},i=0;o.Model.prototype.STATUS=o.M.STATUS,o.Model.prototype.RETRY_LIMIT=3,o.Model.prototype.status=o.M.STATUS.NONE,o.Model.prototype.key=null,o.Model.prototype.params=null,o.Model.prototype._errorFixingPromise=null,o.Model.prototype._init=function(t,e){this.id=t,this._reset(),this.info=o.Model.info(t),r.extend(this,o.Model.getKeyAndParams(t,e,this.info)),this._reinit()},o.Model.prototype._reinit=function(){this.status===this.STATUS.NONE&&(this._bindEvents(),this.status=this.STATUS.INITED,this.trigger("ns-model-init"))},o.Model.prototype._reset=function(t){this.data=null,this.error=null,this._softReset(t),this._version=0},o.Model.prototype._softReset=function(t){this.status=t||this.STATUS.NONE,this.retries=0},o.Model.prototype._bindEvents=function(){for(var t in this.info.events){var e=this.info.events[t];Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;n<r;n++)this.on(t,this._prepareCallback(e[n]))}},o.Model.prototype._unbindEvents=function(){for(var t in this.info.events){var e=this.info.events[t];Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;n<r;n++)this.off(t,this._prepareCallback(e[n]))}},o.Model.prototype._prepareCallback=function(t){return"string"==typeof t&&(t=this[t]),o.assert("function"==typeof t,"ns.Model","Can't find method '%s' in '%s' to bind event",t,this.id),t},o.Model.prototype.invalidate=function(){this._softReset(this.STATUS.INVALID)},o.Model.prototype.destroy=function(){this.trigger("ns-model-before-destroyed"),this._reset(this.STATUS.NONE),this.trigger("ns-model-destroyed"),this._unbindEvents()},o.Model.prototype.isValid=function(){return this.status===this.STATUS.OK},o.Model.prototype.getData=function(){return this.data},o.Model.prototype.get=function(t){var e=this.data;if(e)return r.jpath(t,e)},o.Model.prototype.select=function(t){var e=this.data;return e?r.jpath.raw(t,e).toArray():[]},o.Model.prototype.set=function(t,e,n){var o=this.data;if(this.isValid()&&o&&(r.jpath.set(t,o,e),n=n||{},n.jpath=t,this.touch(n),!n.silent))for(var i=t.split("."),s=i.length;s>1;){var a=i.slice(0,s).join(".");this.trigger("ns-model-changed"+a,a,t),s--}},o.Model.prototype.setData=function(t,e){return this._reinit(),!t||this.isValid()&&!this.hasDataChanged(t)||(this.data=this._beforeSetData(this.preprocessData(t),e),this.status=this.STATUS.OK,this.error=null,this.touch(e)),this},o.Model.prototype.hasDataChanged=function(t){return!!t},o.Model.prototype.getError=function(){return this.error},o.Model.prototype.setError=function(t){this.isErrorCanBeFixed(t)?this._errorFixingPromise=this.fixError(t):(this.data=null,this.error=t,this.status=this.STATUS.ERROR)},o.Model.prototype.isErrorCanBeFixed=function(t){return!1},o.Model.prototype.fixError=function(t){return Vow.resolve()},o.Model.prototype._beforeSetData=function(t,e){return t},o.Model.prototype.preprocessData=function(t){return t},o.Model.prototype.getRequestParams=function(){return o.Model._getKeyParams(this.id,this.params,this.info)},o.Model.prototype._canRequest=function(){return this.canRequest()&&(!this.retries||!this.isDo())&&this.retries<this.RETRY_LIMIT},o.Model.prototype.canRequest=r.true,o.Model.prototype.extractData=function(t){if(t)return t.data},o.Model.prototype.extractError=function(t){if(t)return t.error},o.Model.prototype.isDo=function(){return this.info.isDo},o.Model.prototype.getVersion=function(){return this._version},o.Model.prototype._incVersion=function(){this._version++},o.Model.prototype.touch=function(t){if(t=t||{},!t.silent){this._incVersion(),this.trigger("ns-model-touched");var e=t.jpath||"";this.trigger("ns-model-changed",e)}},o.Model.prototype.prepareRequest=function(t){return this.requestID=t,this.retries++,this.promise=new Vow.Promise,this},o.Model.prototype.finishRequest=function(){this._errorFixingPromise?this._errorFixingPromise.then(this.__finishRequest,this.__finishRequest,this):this.__finishRequest()},o.Model.prototype.__finishRequest=function(){this._errorFixingPromise&&(this._errorFixingPromise=null,this.retries=0),this.promise.fulfill()},o.Model.prototype.destroyWith=function(t){o.Model.destroyWith(this,t)},o.Model.get=function(e,r){var o=this._find(e,r);if(!o){o=new(0,t[e]),o._init(e,r),o.isDo()||(n[e][o.key]=o)}return o._reinit(),o},o.Model.getValid=function(t,e){var n=this._find(t,e);return n&&n.isValid()?n:null},o.Model._find=function(t,r){o.assert(t in e,"ns.Model","'%s' is not defined",t);var i=o.Model.key(t,r);return n[t][i]||null},o.Model.destroy=function(t){if(!t.isDo()){var e=t.id,r=t.key;n[e][r]&&t.destroy()}},o.Model.isValid=function(t,e){return!!o.Model.getValid(t,e)},o.Model.define=function(i,s,a){o.assert(!(i in e),"ns.Model","Can't redefine '%s'",i),s=s||{},void 0===s.isCollection&&(s.isCollection=!!s.split);var u=a;"string"==typeof a?(u=t[a],o.assert(u,"ns.Model","Can't find '%s' to extend '%s'",a,i)):a||(u=s.uniq?o.ModelUniq:s.isCollection?o.ModelCollection:o.Model);var c=s.ctor||function(){};return c=r.inherit(c,u,s.methods),s.ready=!1,e[i]=s,t[i]=c,n[i]={},c},o.Model._reset=function(){n={},t={},e={}},o.Model._clear=function(){for(var t in e)n[t]={}},o.Model.info=function(t){var e=o.Model.infoLite(t);return e.ready||(e.params=e.params||{},e.events=e.events||{},e.isDo=/^do-/.test(t),e.ready=!0),e},o.Model.infoLite=function(t){var n=e[t];return o.assert(n,"ns.Model","'%s' is not defined",t),n},o.Model.key=function(t,e,n){return o.Model.getKeyAndParams(t,e,n).key},o.Model.getKeyAndParams=function(t,e,n){if(n=n||o.Model.info(t),n.isDo)return{key:"do-"+t+"-"+i++,params:e};var r="model="+t,s=o.Model._getKeyParams(t,e,n);return{key:o.key(r,s),params:s}},o.Model._getKeyParams=function(t,e,n){if(e=e||{},n=n||o.Model.info(t),"function"==typeof n.params)return n.params(e);for(var r=n.params,i=n.pNames||(n.pNames=Object.keys(n.params)),s={},a=0,u=i.length;a<u;a++){var c=i[a],l=e[c],f=r[c];(n.isStrictParams?void 0!==l:null!=l)?s[c]=l:null!=f&&(s[c]=f)}return"function"==typeof n.paramsRewrite&&(s=n.paramsRewrite(s)),s},o.Model.invalidate=function(t,e){e=e||function(){return!0};var r=n[t];for(var o in r){var i=r[o];e(i)&&i.invalidate()}},o.Model.destroyWith=function(t,e){Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;n<r;n++){var i=e[n];o.assert(i instanceof o.Model,"ns.Model","destroyWith called for '%s' while one of the withModels is not instance of ns.Model",t.id),i.on("ns-model-destroyed",(function(){o.Model.destroy(t)}))}},o.Model.isCollection=function(t){return(t.info||o.Model.infoLite(t.id)).isCollection},o.Model.traverse=function(t,e){o.Model.infoLite(t),o.assert("function"==typeof e,"ns.Model.traverse","callback must be a function");var r=n[t];for(var i in r)e(r[i])},o.ModelUniq=function(){},r.inherit(o.ModelUniq,o.Model),o.ModelUniq.prototype.__superInit=o.ModelUniq.prototype._init,o.ModelUniq.prototype._init=function(t){var e=o.Model.info(t);e.events.changed=e.events.changed||[];var n=e.events.changed,r=function(){var t=this,e=this.params[this.uniqName];this.uniqCached||(this.uniqCached={}),e.forEach((function(e,n){t.uniqCached[n]=!0}))};Array.isArray(n)?n.unshift(r):e.events.changed=[r,e.events.changed],this.__superInit.apply(this,arguments)},o.ModelUniq.prototype._superIsValid=o.Model.prototype.isValid,o.ModelUniq.prototype.isValid=function(){return-1===this.key.indexOf("&"+this.uniqName+"=")||this._superIsValid()},o.ModelUniq.prototype.uniqName="",o.ModelUniq.prototype.uniqPath="",o.ModelUniq.prototype.uniqCached=null,o.ModelUniq.prototype.uniq=function(t,e){var n=this,o=this.uniqName,i=r.extend({},t);if(this.uniqCached||(this.uniqCached={}),e)for(var s in t)e[s]=s===o?[]:t[s];return i[o]=[].concat(i[o]).map((function(t){return n.uniqCached[t]?(e&&e[o].push(t),null):t})),i[o].length||delete i[o],e&&!e[o].length&&delete e[o],i},o.ModelUniq.prototype.uniqFromKey=function(t){return((t.split(this.uniqName+"=")[1]||"").split("&")[0]||"").split(",")},o.ModelUniq.prototype.uniqFromJSON=o.todo,o.ModelUniq.prototype.getData=function(t){var e=this,r=this.uniqPath,o=[].concat(t[this.uniqName]),i={};i[r]=[];var s=n[this.id];for(var a in s)for(var u=s[a],c=e.uniqFromKey(a),l=0,f=o.length;l<f;l++)if(c.indexOf(o[l])>-1){var p=e.uniqFromJSON(u.data,o[l]);p&&i[r].push(p),o.splice(l,1),l--}return i}})(),(function(){o.ModelCollection=function(){},r.inherit(o.ModelCollection,o.Model),o.ModelCollection.prototype.DEFAULT_ITEMS_SPLIT=".items",o.ModelCollection.prototype._init=function(){this._modelsEvents={},this.models=[],o.Model.prototype._init.apply(this,arguments)},o.ModelCollection.prototype.getData=function(){if(this.isValid()){var t;t=this.info.split?this.info.split.items:this.info.jpathItems?this.info.jpathItems:this.DEFAULT_ITEMS_SPLIT,this.data||(this.data={}),"/"===t?this.data=[]:r.jpath.set(t,this.data,[]);var e=r.jpath(t,this.data);this.models.forEach((function(t){e.push(t.getData())}))}return this.data},o.ModelCollection.prototype._reset=function(){o.Model.prototype._reset.apply(this,arguments),this.clear()},o.ModelCollection.prototype._beforeSetData=function(t,e){var n=this.info.split;if(n){var o=r.jpath(n.items||this.DEFAULT_ITEMS_SPLIT,t),i=this._splitModels(o,e),s=this.__filterExistsModels(this.models,i),a=this.__filterExistsModels(i,this.models);this.__removeModels(a),this.__insertModels(s,0),this.models=i}else this.clear();return t},o.ModelCollection.prototype._splitModels=function(t,e){for(var n=this.info.split,i=[],s=0,a=t.length;s<a;s++){var u=t[s],c={};for(var l in n.params)c[l]=r.jpath(n.params[l],u);var f;f="function"==typeof n.model_id?n.model_id(u,c):n.model_id,f&&i.push(o.Model.get(f,c).setData(u,e))}return i},o.ModelCollection.prototype._subscribeSplit=function(t){var e=this;this.bindModel(t,"ns-model-changed",(function(n,r){e.onItemChanged(n,t,r)})),this.bindModel(t,"ns-model-touched",(function(n){e.onItemTouched(n,t)})),this.bindModel(t,"ns-model-before-destroyed",(function(n){e.onItemDestroyed(n,t)}))},o.ModelCollection.prototype.__filterExistsModels=function(t,e){for(var n=this.__buildModelsHash(t),r=[],o=0,i=e.length;o<i;o++){var s=e[o];n.hasOwnProperty(s.key)||r.push(s)}return r},o.ModelCollection.prototype.__buildModelsHash=function(t){for(var e={},n=0,r=t.length;n<r;n++)e[t[n].key]=0;return e},o.ModelCollection.prototype.bindModel=function(t,e,n){var r=this._modelsEvents[t.key]||(this._modelsEvents[t.key]={});t.on(e,n),r[e]=n},o.ModelCollection.prototype.unbindModel=function(t,e){var n=this._modelsEvents[t.key];n&&n[e]&&(t.off(e,n[e]),delete n[e])},o.ModelCollection.prototype.onItemChanged=function(t,e,n){this.trigger("ns-model-changed",{model:e,jpath:n})},o.ModelCollection.prototype.onItemTouched=function(t,e){this._version++},o.ModelCollection.prototype.onItemDestroyed=function(t,e){this.remove(e)},o.ModelCollection.prototype.getSelfVersion=function(){return this._versionSelf},o.ModelCollection.prototype._incVersion=function(){o.Model.prototype._incVersion.apply(this,arguments),this._versionSelf=this._version},o.ModelCollection.prototype._unsubscribeSplit=function(t){if(t.key in this._modelsEvents){var e=this._modelsEvents[t.key];for(var n in e)t.off(n,e[n]);delete this._modelsEvents[t.key]}},o.ModelCollection.prototype.clear=function(){var t=this.models;if(this.models=[],t&&t.length){var e=this;t.forEach((function(t){e._unsubscribeSplit(t)})),this.trigger("ns-model-remove",t)}},o.ModelCollection.prototype.insert=function(t,e){this._reinit(),isNaN(e)&&(e=this.models.length),Array.isArray(t)||(t=[t]);for(var n=[],r=this.__buildModelsHash(t),o=0,i=t.length;o<i;o++){var s=t[o];0===r[s.key]&&(n.push(s),r[s.key]++)}var a=this.__filterExistsModels(this.models,n);return this.__insertModels(a,e)},o.ModelCollection.prototype.__insertModels=function(t,e){for(var n=0,r=t.length;n<r;n++)this.models.splice(e+n,0,t[n]),this._subscribeSplit(t[n]);return t.length>0&&(this.status=this.STATUS.OK,this.trigger("ns-model-insert",t),!0)},o.ModelCollection.prototype.remove=function(t){Array.isArray(t)||(t=[t]);for(var e=this._modelsIndexToInstance(t),n=[],r=0,o=e.length;r<o;r++){var i=e[r],s=this.models.indexOf(i);s>-1&&(i._itemToRemoveIndex=s,n.push(i))}return this.__removeModels(n)},o.ModelCollection.prototype.__removeModels=function(t){t=t.sort((function(t,e){return e._itemToRemoveIndex-t._itemToRemoveIndex}));for(var e=0,n=t.length;e<n;e++)this._unsubscribeSplit(t[e]),this.models.splice(t[e]._itemToRemoveIndex,1);return!!t.length&&(this.trigger("ns-model-remove",t),!0)},o.ModelCollection.prototype._modelsIndexToInstance=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];if("number"==typeof o){var i=this.models[o];this.models[o]&&e.push(i)}else e.push(o)}return e}})(),(function(){function t(e,o){var s={};if("string"==typeof e)s[e]=!0,e=s;else if(Array.isArray(e)){for(var a=0,u=e.length;a<u;a++)s[e[a]]=!0;e=s}var c={};for(var l in e){var f=l;l.indexOf("{")>-1&&(f=r.jpath.string(l)(o));var p,h=e[l];switch(typeof h){case"function":p=t(h(o),o);break;case"object":case"string":p=t(h,o);break;default:p={}}c[i(f)]={type:n(f),views:p}}return c}function e(t,e){var r=o.object.clone(e);for(var s in t){var u=s.split(a),c=u.length;if(n(u[c-1])!==o.L.BOX)throw new Error("[ns.layout] Can't overwrite view layout '"+u[c-1]+"'");for(var l=r,f=0;f<c-1;f++)if(!(l=l[i(u[f])].views))throw new Error('[no.layout] Path "'+u.slice(0,f).join(" ")+'" is undefined in this layout and cannot be extended');l[i(u[c-1])]=t[s]}return r}function n(t){var e=t.substr(-1);return"@"===e?o.L.BOX:"&"===e?o.L.ASYNC:o.L.VIEW}function i(t){if(a.test(t))return t;var e=t.slice(-1);return"@"!==e&&"&"!==e||(t=t.slice(0,-1)),t}o.layout={};var s={},a=/\s+/;o.layout.define=function(t,e,n){if(s[t])throw new Error("[ns.layout] Can't redefine '"+t+"'");s[t]={layout:e,parent_id:n}},o.layout.undefine=function(t){delete s[t]},o.layout._reset=function(){s={}},o.layout.page=function(n,r){var i=s[n];if(!i)throw new Error("[ns.layout] '"+n+"' is not defined");var a=t(i.layout,r);if(i.parent_id){a=e(a,o.layout.page(i.parent_id,r))}return a},o.layout.generateSimple=function(t,e){e=e||"ns-auto-layout-";var n=e+t;if(n in s)return n;var r={};return r[t]={},o.layout.define(n,r),n}})(),(function(t){t.log={},t.log.debug=function(t){console.log.apply(console,arguments)},t.log.info=function(t,e,n){},t.log.error=function(t,e,n){},t.log.exception=function(t,e,n){}})(o),(function(){function t(t){return o.events.trigger("ns-page-after-load",t),t}function r(t){return o.events.trigger("ns-page-error-load",t),Vow.reject(t)}o.page={},o.page.current={},o.page.currentUrl=null,o.page._lastTransition={url:null,count:0},o.page._lastTransition.set=function(t,e){!e&&t&&(this.url===t?++this.count:(this.url=t,this.count=1))},o.page._lastTransition.unset=function(t,e){if(!e&&this.url&&this.url===t){var n=Math.max(this.count-1,0);this.count=n,this.url=n?this.url:null}},o.page._lastTransition.shouldBlockByTransition=function(t,e){return e&&this.url&&this.url!==t},o.page.DEFAULT_HISTORY_ACTION="push",o.page.go=function(t,n){n?!0===n&&(n="replace"):n=o.page.DEFAULT_HISTORY_ACTION;var i=!1;if(t||(t=o.page.getCurrentUrl(),i=!0),!o.page.block.check(t))return t!==o.page.currentUrl&&o.history.replaceState(o.page.currentUrl),Vow.reject("block");var s=o.router(t);return s.page===o.R.NOT_APP_URL?("replace"===n?e.location.replace(s.redirect):e.location=s.redirect,new Vow.Promise):(o.events.trigger("ns-page-before-load",[o.page.current,s],t),o.page._lastTransition.set(t,i),"push"===n&&t===o.page.currentUrl&&(n="preserve"),o.page.followRoute(s).then((function(){return o.page._lastTransition.shouldBlockByTransition(t,i)?(o.log.debug("[ns.page.go] refresh "+t+" blocked by transition to "+o.page._lastTransition.url),Vow.reject("block by transition")):(o.page._setCurrent(s,t),o.page._fillHistory(t,n),s.page===o.R.REDIRECT?o.page.redirect(s.redirect):(o.page.title(),o.page.startUpdate(s)))}),r).then((function(e){return o.page._lastTransition.unset(t,i),e}),(function(e){return o.page._lastTransition.unset(t,i),Vow.reject(e)})))},o.page.followRoute=function(t){return Vow.fulfill()},o.page.startUpdate=function(e){var n=o.layout.page(e.page,e.params);return new o.Update(o.MAIN_VIEW,n,e.params).start().then(t,r)},o.page._setCurrent=function(t,e){o.page.current=t,o.page.currentUrl=e},o.page._fillHistory=function(t,e){switch(e){case"init":o.page.history.push(t);break;case"push":o.history.pushState(t),o.page.history.push(t);break;case"replace":o.history.replaceState(t),o.page.history.replace(t);break;case"redirect":o.history.replaceState(t),o.page.history.redirect(t)}},o.page.redirect=function(t){return o.history.replaceState(t),o.page.go(t,"redirect")},o.page.title=function(){n.title="NoScript app "+o.page.currentUrl.url},o.page._reset=function(){this.current={},this.currentUrl=""},o.page.getDefaultUrl=function(){return o.router.url("/")},o.page.getCurrentUrl=function(){return e.location.pathname+e.location.search}})(),(function(){o.page.block={},o.page.block._checkers=[],o.page.block.add=function(t){return o.page.block._checkers.push(t),this},o.page.block.remove=function(t){var e=o.page.block._checkers,n=e.indexOf(t);return n>-1&&e.splice(n,1),this},o.page.block.clear=function(){return o.page.block._checkers=[],this},o.page.block.check=function(t){for(var e=o.page.block._checkers,n=0,r=e.length;n<r;n++)if(!1===e[n](t))return!1;return!0}})(),(function(){o.page.history={},o.page.history._current=null,o.page.history._history=[],o.page.history.push=function(t){var e=o.page.history;if(e._current&&e._current!==t){o.page.history.getPrevious()===t?e._history.pop():e._history.push(e._current)}e._current=t},o.page.history.replace=function(t){var e=o.page.history,n=e._history.pop(),r=e._current;n&&n!==t&&r!==t&&e._history.push(n),e._current=t},o.page.history.redirect=function(t){var e=o.page.history;e._current=t,e._previous=e.getPrevious()},o.page.history.back=function(){var t=o.page.history,e=t.getPrevious();return e?t._history.pop():e=o.page.getDefaultUrl(),t._current=e,o.page.go(e)},o.page.history.getPrevious=function(t){t=t||0;var e=o.page.history._history;return e[e.length-t-1]},o.page.history.reset=function(){o.page.history._current=null,o.page.history._history=[]}})(),(function(){function t(t){if("json"===o.request.FORMAT)return{models:t.map((function(t){var e=t.getRequestParams();return{name:s(t),params:t.info.isStrictParams?e:o.parseQuery(o.params2query(e))}}))};for(var e={},n=0,r=t.length;n<r;n++){var i="."+n,a=t[n];e["_model"+i]=s(a);var u=a.getRequestParams();for(var c in u)e[c+i]=u[c]}return e}function e(t,e){for(var n=[],r=0,o=t.length;r<o;r++)n.push({id:t[r],params:e});return n}function n(t){return t.promise}function i(t,n){"string"==typeof t&&(t=[t]),"string"==typeof t[0]&&(n=n||{},t=e(t,n));for(var r=[],i=0,s=t.length;i<s;i++){var a=t[i];a instanceof o.Model?r.push(a):a.model&&a.model instanceof o.Model?r.push(a.model):r.push(o.Model.get(a.id,a.params))}return r}function s(t){return t.info.serverId||t.id}o.request=function(t,e,n){return o.request.models(i(t,e),n)},o.forcedRequest=function(t,e,n){return n=n||{},n.forced=!0,o.request.models(i(t,e),n)},o.request.models=function(t,e){return t=t.map((function(t){return t.getRequest?t.getRequest():t})),new u(t,e).start()},o.request.requestParams={},o.request.addRequestParams=function(t){r.extend(t,o.request.requestParams)},o.request.URL="/models/",o.request.fetchModels=function(e){var n=e.map(s),r=o.request.URL+"?_m="+n.join(","),i=t(e),a={};return o.request.addRequestParams(i),"json"===o.request.FORMAT&&(i=JSON.stringify(i),a.contentType="application/json; encoding=utf-8"),o.http(r,i,a)},o.request.canProcessResponse=function(){return!0},o.request._reset=function(){o.request.manager._keys={}},o.request.extractModel=function(t,e){var n,r;e?(n=t.extractData(e))||(r=t.extractError(e))||(r={id:"INVALID_FORMAT",reason:"response should contain result or error"}):r={id:"NO_DATA",reason:"Server returned no data"},n?t.setData(n):t.setError(r)};var a=0,u=function(t,e){this.id=a++,this.models=t,this.options=e||{},this.promise=new Vow.Promise};u.prototype.start=function(){for(var t=[],e=[],n=this.models,r=0,i=n.length;r<i;r++){var s=n[r],a=o.request.manager.add(s,this.id,this.options.forced);!0===a?e.push(s):a instanceof o.Model&&t.push(s)}return this.request(t,e),this.promise},u.prototype.request=function(t,e){var r,i=[];if(e.length){var s=[],a=[];e.forEach((function(t){if("function"==typeof t.request){var e=t.request().then((function(){o.request.manager.done(t)}),(function(){o.request.manager.done(t)}));t.promise=e,a.push(e)}else s.push(t)})),i=i.concat(a),s.length&&(r=o.request.fetchModels(s),i=i.concat(s.map(n)))}if(t.length&&(i=i.concat(t.map(n))),i.length){var u=this;r&&r.then((function(t){!1===o.request.canProcessResponse(t)?(o.request.manager.clean(u.models),u.promise.reject({error:"CANT_PROCESS",invalid:u.models,valid:[]})):u.extract(s,t)}),(function(t){o.log.error("ns.request.http",t),u.extract(s,{})})),Vow.all(i).then(this.start.bind(this))}else{o.request.manager.clean(this.models);for(var c=[],l=[],f=0,p=this.models.length;f<p;f++){var h=this.models[f];h.isValid()?c.push(h):l.push(h)}l.length?this.promise.reject({invalid:l,valid:c}):this.promise.fulfill(this.models)}},u.prototype.extract=function(t,e){for(var n=e&&e.models||[],r=0,i=t.length;r<i;r++){var s=t[r],a=n[r];s.requestID>this.id||(o.request.extractModel(s,a),o.request.manager.done(s),s.finishRequest())}}})(),o.request.manager={STATUS:{LOADING:0,FAILED:1,DONE:2},_keys:{},add:function(t,e,n){var r=this.STATUS,o=t.key,i=this._keys[o];return i?!(t.isValid()&&!n)&&(i.status===r.LOADING?t.isDo()?i.model:n?(i.model.requestID=e,!0):i.model:i.status===r.FAILED?i.model._canRequest()?(this._createRequest(t,e),!0):(t.status=t.STATUS.ERROR,this.done(t,!0),!1):!t.isValid()&&(!!t._canRequest()&&(this._createRequest(t,e),!0))):t.isValid()?!(!n||t.requestID===e)&&(this._createRequest(t,e),!0):!!t.canRequest()&&(this._createRequest(t,e),!0)},done:function(t,e){var n=this._keys[t.key];n&&(t.isValid()||e?n.status=this.STATUS.DONE:n.status=this.STATUS.FAILED)},clean:function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];r.retries=0,delete this._keys[r.key]}},_createRequest:function(t,e){this._keys[t.key]={status:this.STATUS.LOADING,model:t},t.prepareRequest(e)}},o.router=function(t){var e=o.router.baseDir,n=o.router._routes;if(0!==t.indexOf(e))return{page:o.R.NOT_APP_URL,params:{},redirect:t};(t=t.substring(e.length))||(t="/");var r=o.router._processRedirect(n.redirect,t);if(r)return{page:o.R.REDIRECT,params:{},redirect:e+r};var i=t.split("?"),s=i.shift();if(s in n.rewriteUrl){var a=i.join("?");t=n.rewriteUrl[s]+(a?"?"+a:"")}for(var u=n.route,c=0,l=u.length;c<l;c++){var f=u[c],p=o.router._parseUrl(f,t);if(p)return f.page in n.rewriteParams&&(p=n.rewriteParams[f.page](p)),{page:f.page,params:p}}return{page:o.R.NOT_FOUND,params:{}}},o.router.encodeParamValue=encodeURIComponent,o.router.decodeParamValue=decodeURIComponent,o.router.URL_FIRST_SYMBOL="/",o.router._getParamsRouteFromUrl=function(t,e){for(var n,r=t.params,i={},s=r.length,a=0;a<s;a++){n=r[a];var u=e[a+1];if(u)try{u=o.router.decodeParamValue(u,n.name)}catch(t){u=""}u||(u=n.default_value),i[n.name]=u}return i},o.router._parseUrl=function(t,e){var n=t.regexp.exec(e);if(n){var i=o.router._getParamsRouteFromUrl(t,n),s=n[t.params.length+1];return s&&r.extend(i,o.parseQuery(s)),i}return null},o.router._processRedirect=function(t,e){for(var n,r=0,i=t.length;r<i;r++){var s=t[r];if("function"==typeof s.path){var a=o.router._parseUrl(s,e);a&&(n=s.path(a,e))}else s.regexp.test(e)&&(n=s.path);if(n)return n}return null},o.router.init=function(){var t=o.router.routes;o.router._regexps={};for(var e in o.router.regexps)o.router._regexps[e]=new RegExp("^"+o.router.regexps[e]+"$");var n={};n.redirect=t.redirect||{},n.rewriteUrl=t.rewriteUrl||{},n.rewriteParams=t.rewriteParams||{};var r=t.route||{},i=[],s={};for(var a in r){var u=r[a],c=o.router.compile(a);c.page=u,i.push(c),s[u]=s[u]||[],s[u].push(c)}n.route=i,n.routeHash=s;var l=t.redirect||{},f=[];for(var p in l){var c=o.router.compile(p);f.push({regexp:c.regexp,path:l[p],params:c.params})}n.redirect=f,o.router._routes=n},o.router.url=function(t){return o.router.baseDir+t||"/"},o.router.generateUrl=function(t,e){var n,r=o.router._routes.routeHash[t];e=e||{},o.assert(r&&r.length,"ns.router","Could not find route with id '%s'!",t);for(var i=0;i<r.length&&null===(n=o.router._generateUrl(r[i],e));i++);return o.assert(null!==n,"ns.router","Could not generate url for layout id '%s'!",t),o.router.url(n)},o.router._generateUrl=function(t,e){for(var n,i,s,a,u,c=[],l=r.extend({},e),f=o.router._routes.rewriteUrl,p=0;p<t.sections.length;p++){i=t.sections[p],s="";for(var h=0;h<i.items.length;h++)if(u=i.items[h],u.name){a=e[u.name];var d=u.name in e;if(u.is_optional&&!d&&(a=u.default_value),u.is_filter&&a!==u.filter_value)return null;if(!u.is_optional&&!d)return null;if(u.is_optional&&!d)continue;if(a=o.router.encodeParamValue(a,u.name),!o.router._isParamValid(a,u.type))return null;s+=a,delete l[u.name]}else s+=u.default_value;!s&&i.is_optional||c.push(s)}n=c.join("/"),n=n?o.router.URL_FIRST_SYMBOL+n:"";for(var v=!0;v;){v=!1;for(var y in f){var _=f[y],g=_.length;if(n.substr(0,g)===_){var m=n.charAt(g);"/"!==m&&"?"!==m&&m||(n=y+n.substr(_.length),v=!0)}}}var w=o.params2query(l);return w?n+"?"+w:n},o.router.compile=function(t){t=t.replace(/\/$/,""),t[0]===o.router.URL_FIRST_SYMBOL&&(t=t.substr(1));var e=t.split("/"),n=e.map(o.router._parseSection),r=n.map(o.router._generateSectionRegexp);"/"===r[0][0]&&(r[0]=o.router.URL_FIRST_SYMBOL+r[0].substr(1));var i=r.join(""),s=[];return n.forEach((function(t){s=s.concat(t.items.filter((function(t){return!!t.name})))})),i="^"+i+"/?(?:\\?(.*))?$",{regexp:new RegExp(i),params:s,sections:n}},o.router._parseSection=function(t){for(var e=0,n=-1,r=-1,i=[];;){if((n=t.indexOf("{",e))<0)break;r=t.indexOf("}",n),o.assert(r>0,"ns.router","could not parse parameter in url section: %s",t),n>e&&i.push({default_value:t.substr(e,n-e)}),i.push(o.router._parseParam(t.substr(n+1,r-n-1))),e=r+1}return e<t.length&&i.push({default_value:t.substr(e)}),{is_optional:i.length&&i.filter((function(t){return t.is_optional})).length===i.length,items:i}},o.router._parseParam=function(t){var e,n,r,i,s,a,u=!1;e=t.split("=");var c=e[0].split(":");return a=c[0],n=c[1]||"id",3===e.length?(i=!1,u=!0,s=e[2],o.assert(s,"ns.router","Parameter '%s' value must be specified",a),o.assert(o.router._isParamValid(s,n),"ns.router","Wrong value for '%s' parameter",a)):(i=2===e.length,r=e[1]),{name:a,type:n,default_value:r,is_optional:i,is_filter:u,filter_value:s}},o.router._generateSectionRegexp=function(t){var e="";return t.items.forEach((function(t){e+=o.router._generateParamRegexp(t)})),e=t.is_optional?"(?:/(?!/)"+e+")?":"/"+e},o.router._generateParamRegexp=function(t){var e,n=o.router.regexps;return t.default_value&&!t.name?t.default_value:(t.type&&o.assert(t.type in n,"ns.router","Could not find regexp for type '%s'!",t.type),t.is_filter&&t.filter_value?e="("+t.filter_value+")":(e=n[t.type],e="("+e+")",t.is_optional&&(e="(?:"+e+")?")),e)},o.router._isParamValid=function(t,e){var n=o.router._regexps[e];return o.assert(n,"ns.router","Could not find regexp for type '%s'!",e),n.test(t)},o.router._reset=function(){this.baseDir="",this._routes=null,this.routes={},this.regexps={id:"[A-Za-z_][A-Za-z0-9_-]*",int:"[0-9]+"}},o.router._reset(),(function(){function t(t){for(var e={},n=[],r=0,o=t.length;r<o;r++){var i=t[r].models;for(var s in i){var a=i[s],u=a.key;e[u]||(n.push(a),e[u]=!0)}}return n}function e(t){return t.parentUpdate?e(t.parentUpdate):t.EXEC_FLAG===o.U.EXEC.PARALLEL}o.Update=function(t,e,n,r){if(this.view=t,!(this.view.id in e))throw new Error("[ns.Update] Can't find view layout");this.layout=e[this.view.id],this.params=n,this.id=++i,this.promise=new Vow.Promise,r=r||{},this.EXEC_FLAG=r.execFlag||o.U.EXEC.GLOBAL,this.parentUpdate=r.parentUpdate,this.log("created instance",this,"with layout",this.layout,"and params",this.params),this.startTimer("full"),r.timers&&(this._profileTimes.__parent=r.timers),o.Update._addToQueue(this)||this.abort()},r.extend(o.Update.prototype,o.profile);var n=[],i=-1;o.Update.prototype.STATUS=o.U.STATUS,o.Update.prototype._EVENTS_ORDER=["ns-view-hide","ns-view-htmldestroy","ns-view-htmlinit","ns-view-async","ns-view-show","ns-view-touch"],o.Update.prototype._requestCount=0,o.Update.prototype.log=function(){if(o.DEBUG){var t=Array.prototype.slice.apply(arguments);"generated html"===t[0]&&(t[1]=o.html2node(t[1])),o.log.debug.apply(o.log,["[ns.Update]",this.id].concat(t))}},o.Update.prototype._requestModels=function(t){var e="requestModels."+this._requestCount;if(this.startTimer(e),this.log("started models request",t),!this._checkModelsInvalid(t))return this.stopTimer(e),this.log("received models",t),Vow.fulfill(t);var n=o.request.models(t);return n.always((function(){this.stopTimer(e)}),this),n.then(this._onRequestModelsOK,this._onRequestModelsError,this)},o.Update.prototype._onRequestModelsOK=function(t){return this.log("received models",t),t},o.Update.prototype._onRequestModelsError=function(t){this.log("failed to receive models",t);var e={error:this.STATUS.MODELS,expired:this._expired(),invalidModels:t.invalid,validModels:t.valid};return o.Update.handleError(e,this)?[].concat(t.invalid,t.valid):Vow.reject(e)},o.Update.prototype._checkModelsInvalid=function(t){return(t||[]).some((function(t){return!t.isValid()}))},o.Update.prototype._getActiveViews=function(){var t="collectModels."+this._requestCount;this.startTimer(t);var e={sync:[],async:[],hasPatchLayout:!1};return this.view.destroyed||this.view._getRequestViews(e,this.layout,this.params),this.stopTimer(t),this.log("collected incomplete views",e),e},o.Update.prototype._requestSyncModels=function(){var e=this._getActiveViews(),n=t(e.sync);return this.log("collected needed models",n),this._requestModels(n).then((function(t){if(e.hasPatchLayout&&!this._checkModelsInvalid(t))return this._requestCount++,this._requestSyncModels()}),null,this)},o.Update.prototype._requestAllModels=function(){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);var e=new Vow.Promise,n=this._getActiveViews(),r=t(n.sync);this.log("collected needed models",r);var o=this._requestModels(r),i=n.async.map((function(t){return t.updateAfter(this.promise,this.params,this)}),this);return o.then((function(t){if(n.hasPatchLayout&&!this._checkModelsInvalid(t))return this._requestCount++,void e.sync(this._requestAllModels());e.fulfill({async:i})}),(function(t){e.reject(t)}),this),e},o.Update.prototype._applyLayout=function(){this._getActiveViews()},o.Update.prototype._generateHTML=function(){return this._expired()?this._rejectWithStatus(this.STATUS.EXPIRED):Vow.fulfill(this._renderUpdateTree())},o.Update.prototype._renderUpdateTree=function(){this.startTimer("collectViews");var t={views:{}};this.view.destroyed||this.view._getUpdateTree(t),this.log("created render tree",t),this.stopTimer("collectViews");var e;return o.object.isEmpty(t.views)||(this.startTimer("generateHTML"),e=this.applyTemplate(t,this.params,this.layout),this.log("generated html",e),this.stopTimer("generateHTML")),e},o.Update.prototype._insertNodes=function(t){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);this.startTimer("triggerHideEvents");var e={"ns-view-hide":[],"ns-view-htmldestroy":[]};this.view.destroyed||this.view.beforeUpdateHTML(e,!1),this._triggerViewEvents(e);var n={"ns-view-async":[],"ns-view-htmlinit":[],"ns-view-show":[],"ns-view-touch":[]};return this.switchTimer("triggerHideEvents","insertNodes"),this.view.destroyed||this.view._updateHTML(t,{toplevel:!0},n),this.switchTimer("insertNodes","triggerEvents"),this._triggerViewEvents(n),this.stopTimer("triggerEvents"),Vow.fulfill()},o.Update.prototype._triggerViewEvents=function(t){for(var e=this.getTimers(),n=0,r=this._EVENTS_ORDER.length;n<r;n++)for(var o=this._EVENTS_ORDER[n],i=t[o]||[],s=i.length-1;s>=0;s--)i[s].trigger(o,this.params,e)},o.Update.prototype._updateDOM=function(){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);var t=this._renderUpdateTree();this.startTimer("html2node");var e=o.html2node(t||"");this.stopTimer("html2node"),this._insertNodes(e)},o.Update.prototype.prefetch=function(){return this.log("started `prefetch` scenario"),this._requestSyncModels().then(this._fulfill,this._reject,this),this.promise},o.Update.prototype.generateHTML=function(){return this.log("started `generateHTML` scenario"),Vow.invoke(this._requestSyncModels.bind(this)).then(this._generateHTML,null,this).then(this._fulfill,this._reject,this),this.promise},o.Update.prototype.prerender=function(){return this.log("started `prerender` scenario"),o.todo(),this.promise},o.Update.prototype.render=function(){return this._expired()?(this._reject({error:this.STATUS.EXPIRED}),this.promise):(this.log("started `render` scenario"),Vow.invoke(this._requestAllModels.bind(this)).then((function(t){this._updateDOM(),this._fulfill(t)}),this._reject,this).then(null,this._reject,this),this.promise)},o.Update.prototype.start=o.Update.prototype.render,o.Update.prototype.reconstruct=function(t){return this.log("started `reconstruct` scenario"),this._applyLayout(),Vow.invoke(this._insertNodes.bind(this),t).then((function(){this._fulfill({async:[]})}),this._reject,this),this.promise},o.Update.prototype.applyTemplate=function(t,e,n){return o.renderString(t,null,"")},o.Update.prototype._expired=function(){return this.promise.isResolved()||-1===n.indexOf(this)},o.Update.prototype.abort=function(){this._reject({error:o.U.STATUS.EXPIRED})},o.Update.prototype._fulfill=function(t){this.promise.isResolved()||(o.Update._removeFromQueue(this),this.stopTimer("full"),this.promise.fulfill(t),this.perf(this.getTimers()),this.log("successfully finished scenario"))},o.Update.prototype._reject=function(t){this.promise.isResolved()||(o.Update._removeFromQueue(this),this.stopTimer("full"),this.promise.reject(t),this.log("scenario was rejected with reason",t))},o.Update.prototype._rejectWithStatus=function(t){return Vow.reject({error:t})},o.Update.prototype.isGlobal=function(){return this.EXEC_FLAG===o.U.EXEC.GLOBAL},o.Update.prototype.perf=function(t){},o.Update.handleError=function(t,e){return!1},o.Update._removeFromQueue=function(t){var e=n.indexOf(t);e>-1&&n.splice(e,1)},o.Update._addToQueue=function(t){var r,i,s=n,a=o.U.EXEC,u=a.GLOBAL,c=a.ASYNC,l=t.EXEC_FLAG;if(l===u){var f=[];for(r=s.length-1;r>=0;r--){var p=s[r];e(p)?f.push(p):p.abort()}n=f}else if(l===c&&!e(t))for(r=0,i=s.length;r<i;r++)if(s[r].EXEC_FLAG===u)return!1;return n.push(t),!0}})(),(function(){var t=0,i=/ns-view-id-\d+/;o.View=function(){},r.extend(o.View.prototype,o.Events),o.View.prototype.STATUS=o.V.STATUS,o.View.prototype._$document=void 0===n?null:$(n),o.View.prototype._$window=void 0===e?null:$(e),o.View.prototype.key=null,o.View.prototype.params=null,o.View.prototype.node=null,o.View.prototype.$node=null,o.View.prototype.views=null,o.View.prototype.id=null,o.View.prototype._visible=!1,o.View.prototype.__uniqueId=null,o.View.prototype.__modelsEventsBinded=!1,o.View.prototype._init=function(t,e,n){this.id=t,this.__setUniqueId(),this.async=n,this.info=o.View.info(t),r.extend(this,o.View.getKeyAndParams(this.id,e||{},this.info)),this._initModels(),this._modelsVersions={},this.views={},this.status=this.STATUS.NONE,this.destroyed=!1,this.__customInit(),this._bindCreateEvents(),this.trigger("ns-view-init")},o.View.prototype.__setUniqueId=function(){this.__uniqueId||(this.__uniqueId="ns-view-id-"+ ++t)},o.View.prototype.__customInit=r.nop,o.View.prototype._initModels=function(){this.models={},this._modelsHandlers={};for(var t in this.info.models)if(!this.models[t]){var e=o.Model.get(t,this.params);this.models[t]=e,this._modelsHandlers[e.key]={}}},o.View.prototype._getView=function(t){return this.views[t]},o.View.prototype._addView=function(t,e,n){var r=this._getView(t);return r||(r=n===o.L.BOX?new o.Box(t,e):o.View.create(t,e,n===o.L.ASYNC),this.views[r.id]=r),r},o.View.prototype.__onHtmldestroy=function(){this._unbindEvents("init")},o.View.prototype._htmlinit=function(t){this._bindEvents("init"),t.push(this)},o.View.prototype.hideAndUnbindEvents=function(){this.__onHide()},o.View.prototype.__onHide=function(){!this.isLoading()&&!0===this._visible&&this._unbindEvents("show"),this._visible=!1},o.View.prototype._show=function(t){return!this.isLoading()&&!this._visible&&(this.__modelsEventsBinded||this.__bindModelsEvents(),this._bindEvents("show"),this._visible=!0,t&&t.push(this),!0)},o.View.prototype.__bindModelsEvents=function(){this.__modelsEventsBinded=!0;var t=this.models;for(var e in t){var n=t[e];this.__bindModelEvents(n)}},o.View.prototype.__bindModelEvents=function(t){var e=this.info.models[t.id];for(var n in e){var i=e[n],s=this[i]||e[n];o.View.assert("function"==typeof s,4,[this.id,i,t.id]),s===this.keepValid&&(s=r.nop),this.__bindModelEvent(t,n,this._invokeModelHandler.bind(this,s,t))}},o.View.prototype._invokeModelHandler=function(t,e){return this._saveModelVersion(e.id),t.apply(this,Array.prototype.slice.call(arguments,2))},o.View.prototype.__bindModelEvent=function(t,e,n){t.on(e,n),this._modelsHandlers[t.key][e]=n},o.View.prototype.__unbindModelsEvents=function(){var t=this.models;for(var e in t){var n=t[e];this.__unbindModelEvent(n)}},o.View.prototype.__unbindModelEvent=function(t){var e=this._modelsHandlers[t.key];for(var n in e)t.off(n,e[n]),delete e[n]},o.View.prototype._prepareCallback=function(t){if("string"==typeof t){var e=this[t];return o.View.assert(!!e,5,[t,this.id]),e}return t},o.View.prototype._bindEventHandlers=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r],s=[].concat(i);s[e]=this._prepareCallback(i[e]).bind(this),n.push(s)}return n},o.View.prototype._getEvents=function(t){var e="_"+t+"Events";if(!this[e]){var n=this.info[t+"Events"],r=this.info[t+"Nsevents"];this[e]={bind:this._bindEventHandlers(n.bind,2),delegate:this._bindEventHandlers(n.delegate,2),nsevents:this._bindEventHandlers(r,1)}}return this[e]},o.View.prototype._bindEvents=function(t){var e,n,r,i=this.$node,s=this._getEvents(t),a=s.delegate;for(e=0,n=a.length;e<n;e++)r=a[e],"window"===r[1]||"document"===r[1]?this["_$"+r[1]].on(r[0],r[2]):r[1]?i.on(r[0],r[1],r[2]):i.on(r[0],r[2]);var u=s.bind;for(e=0,n=u.length;e<n;e++)r=u[e],i.find(r[1]).on(r[0],r[2]);var c=s.nsevents;for(e=0,n=c.length;e<n;e++)r=c[e],o.events.on(r[0],r[1])},o.View.prototype._bindCreateEvents=function(){for(var t=0,e=this.info.createEvents.length;t<e;t++){var n=this.info.createEvents[t];this.on(n[0],this._prepareCallback(n[1]))}},o.View.prototype._unbindEvents=function(t){var e,n,r,i=this.$node,s=this._getEvents(t),a=s.delegate;for(e=0,n=a.length;e<n;e++)r=a[e],"window"===r[1]||"document"===r[1]?this["_$"+r[1]].off(r[0],r[2]):r[1]?i.off(r[0],r[1],r[2]):i.off(r[0],r[2]);var u=s.bind;for(e=0,n=u.length;e<n;e++)r=u[e],i.find(r[1]).off(r[0],r[2]);var c=s.nsevents;for(e=0,n=c.length;e<n;e++)r=c[e],o.events.off(r[0],r[1])},o.View.prototype.invalidate=function(){for(var t=this._getDescendantsAndSelf(),e=0,n=t.length;e<n;e++){var r=t[e];r.status===this.STATUS.OK&&(r.status=this.STATUS.INVALID)}},o.View.prototype.isOk=function(){return this.status===this.STATUS.OK},o.View.prototype.isLoading=function(){return this.status===this.STATUS.LOADING},o.View.prototype.isNone=function(){return this.status===this.STATUS.NONE},o.View.prototype.isValid=function(){return this.isOk()&&this.isModelsValidWithVersions()},o.View.prototype.isValidSelf=o.View.prototype.isValid,o.View.prototype.isValidWithDesc=function(){if(!this.isValid())return!1;for(var t in this.views)if(!this.views[t].isValidWithDesc())return!1;return!0},o.View.prototype.isModelsValidWithVersions=function(){return this.isModelsValid(this._modelsVersions)},o.View.prototype.isModelsValid=function(t){var e=this.models;for(var n in e){if(!e[n].isValid()||t&&this._getModelVersion(n)>t[n])return!1}return!0},o.View.prototype.isVisible=function(){return this._visible},o.View.prototype._apply=function(t){var e=this.views;for(var n in e)t(e[n],n)},o.View.prototype._saveLayout=function(t){this.layout={},this.layout[this.id]={views:t}},o.View.prototype._getRequestViews=function(t,e,n){var r=this.__evaluateState();this.__registerInUpdate(r,t);var i=!1;r&&(i=!0,"function"==typeof this.patchLayout&&(this.isModelsValid()?this.__patchLayout(e,n):(i=!1,t.hasPatchLayout=!0)));var s=e.views;if(this._saveLayout(s),i){for(var a in s)this._addView(a,n,s[a].type);var u=this.id;this._apply((function(e,r){var i=s[r];o.View.assert(!!i,13,[u]),e._getRequestViews(t,i,n)}))}return t},o.View.prototype.__patchLayout=function(t,e){t.views={};var n=this.patchLayout(e);o.View.assert(!!n,11);var i=o.layout.page(n,e);this.__checkPatchLayout(i),r.extend(t.views,i)},o.View.prototype.__checkPatchLayout=function(t){for(var e in t)o.View.assert(t[e].type===o.L.BOX,12)},o.View.prototype.__evaluateState=function(){this.asyncState=!1;var t=!0;return this.async?this.shouldBeSync||this.isModelsValid()?t=!0:(this.asyncState=!0,t=!1):(this.isValidSelf()||this.invalidate(),t=!0),this.shouldBeSync=!1,t},o.View.prototype.__registerInUpdate=function(t,e){t?e.sync.push(this):e.async.push(this)},o.View.prototype._getUpdateTree=function(t){return this.isValid()?this._apply((function(e){e._getUpdateTree(t)})):t.views[this.id]=this._getViewTree(),t},o.View.prototype._getCommonTree=function(){var t={box:this.info.isBox,collection:this.info.isCollection,id:this.id,key:this.key,models:{},params:this.params,state:this.asyncState?"loading":"ok",tree:{},uniqueId:this.__uniqueId,views:{}};return t.tree[this.id]=!0,t},o.View.prototype._getTree=function(){var t=this._getCommonTree(),e=this.patchTree(t);return e&&"object"==typeof e&&!Array.isArray(e)&&(t=r.extend(e,t)),t},o.View.prototype._getViewTree=function(){var t=this._getTree();return t.models=this._getModelsForTree(),"loading"===t.state?t:(this.isModelsValid()?t.views=this._getDescViewTree():t.state="error",t)},o.View.prototype.patchTree=r.nop,o.View.prototype._getDescViewTree=function(){var t={};return this._apply((function(e,n){t[n]=e._getViewTree()})),t},o.View.prototype._getPlaceholderTree=function(){var t=this._getTree();return t.state="placeholder",this.info.isCollection?t.views=this._getDescViewTree():this._apply((function(e){e._getUpdateTree(t)})),t},o.View.prototype._getModelsForTree=function(){var t={},e=this.models;for(var n in e){var r=e[n];t[n]={},r.isValid()?(t[n].status="ok",t[n][n]=r.getData()):(t[n].status="error",t[n][n]=r.getError())}return t},o.View.prototype.getModel=function(t){return this.models[t]},o.View.prototype.getModelData=function(t,e){var n=this.getModel(t);return e?n.get(e):n.getData()},o.View.prototype._getDescendantsAndSelf=function(t){return t=t||[],t.push(this),this._apply((function(e){e._getDescendantsAndSelf(t)})),t},o.View.prototype._setNode=function(t){var e=this.STATUS;t?(this.node=t,this.$node=$(t),this.status=this.asyncState?e.LOADING:e.OK):this.status=e.NONE},o.View.prototype._extractNodeByKey=function(t){var e=t.querySelector('[data-key="'+this.key+'"]');if(!e)return null;var n=e.className;return-1===n.indexOf(this.__uniqueId)&&(e.className=n.replace(i,this.__uniqueId)),e},o.View.prototype._extractNode=function(t){var e=o.byClass(this.__uniqueId,t)[0];return e&&e.getAttribute("data-key")===this.key||(e=this._extractNodeByKey(t)),e},o.View.prototype._selfBeforeUpdateHTML=function(t,e){if(e){return void(!0===this._visible&&!this.isLoading()&&t["ns-view-hide"].push(this))}!this.isValidSelf()&&this.node&&!this.isLoading()&&(!0===this._visible&&t["ns-view-hide"].push(this),t["ns-view-htmldestroy"].push(this))},o.View.prototype.beforeUpdateHTML=function(t,e){this._selfBeforeUpdateHTML(t,e),this.asyncState||this._apply((function(n){n.beforeUpdateHTML(t,e)}))},o.View.prototype._updateHTML=function(t,e,n){var i;i=e.toplevel?r.extend({},e):e;var s,a=t?this._extractNode(t):null,u=!this.isValid(),c=this.isValid()&&this.node&&a&&a!==this.node&&e.parent_added&&!e.toplevel;(u||c)&&(s=a,o.View.assert(!!s,6,[this.id]),e.toplevel&&(this.node&&(o.replaceNode(this.node,s),i.parent_added=!0),i.toplevel=!1),this.node&&!this.isLoading()&&(this.__onHide(),this.__onHtmldestroy()),!this.node||e.parent_added||i.parent_added||o.replaceNode(this.node,s),this._setNode(s),this.isOk()?this._htmlinit(n["ns-view-htmlinit"]):this.isLoading()&&n["ns-view-async"].push(this),this._saveModelsVersions()),this.isOk()&&(this._show(n["ns-view-show"]),n["ns-view-touch"].push(this)),s=s||t,this.asyncState||this._apply((function(t){t._updateHTML(s,i,n)}))},o.View.prototype._saveModelsVersions=function(){for(var t in this.models)this._saveModelVersion(t)},o.View.prototype._getModelVersion=function(t){return this.models[t].getVersion()},o.View.prototype._saveModelVersion=function(t){this._modelsVersions[t]=this._getModelVersion(t)},o.View.prototype.keepValid=o.View.prototype._saveModelsVersions,o.View.prototype.updateAfter=function(t,e,n){this._asyncPromise=new Vow.Promise;var r=this;return t.then((function(){r.update(e,{parentUpdate:n,timers:n.getTimers()})})),this._asyncPromise},o.View.prototype.update=function(t,e){this.shouldBeSync=!0;var n=this.params;if(t&&(n=r.extend({},this.params,t)),!this.layout){var i="ns-temp-layout-for-"+this.id,s={};s[this.id]={},o.layout.define(i,s),this.layout=o.layout.page(i,n),o.layout.undefine(i)}e=e||{},e.execFlag=e.execFlag||o.U.EXEC.ASYNC;var a=new o.Update(this,this.layout,n,e).render();return this._asyncPromise&&this._asyncPromise.sync(a),a},o.View.prototype.destroy=function(){this._apply((function(t){t.destroy()})),this.trigger("ns-view-destroyed"),this.views={},this.node&&!this.isLoading()&&(this.isVisible()&&(this.trigger("ns-view-hide"),this.hideAndUnbindEvents()),this.trigger("ns-view-htmldestroy"),this.__onHtmldestroy()),this.__unbindModelsEvents(),this.node&&(this.$node.off().removeData().remove(),this.node=null,this.$node=null),this.info=null,this.layout=null,this.models=null,this.params=null,this.status=this.STATUS.NONE,this.destroyed=!0,this._modelsHandlers=null};var s={},a={};o.View.define=function(t,e,n){o.View.assert(!(t in s),1,[t]),e=e||{};var i=this;"string"==typeof n?(i=a[n],o.View.assert(!!i,2,[n,t])):"function"==typeof n&&(i=n);var u=e.ctor||function(){};return u=r.inherit(u,i,e.methods),e.models=this._formatModelsDecl(e.models||{}),e.events=e.events||{},e.isBox=!1,e.isCollection=!1,e.ready=!1,s[t]=e,a[t]=u,u},o.View._reset=function(){a={},s={}},o.View.infoLite=function(t){var e=s[t];return o.View.assert(!!e,3,[t]),e},o.View.info=function(t){var e=o.View.infoLite(t);return e.ready||(o.View._initInfoParams(e),o.View._initInfoEvents(e),e.ready=!0),e},o.View._initInfoParams=function(t){if(t.params){if(o.View.assert(!t["params+"],7),o.View.assert(!t["params-"],8),"function"==typeof t.params)return void(t.pGroups=[]);var e,n=[];e=Array.isArray(t.params)?t.params:[t.params];for(var i=0;i<e.length;i++){var s=e[i];n.push({pNames:Object.keys(s),pFilters:s,pDefaults:{}})}t.pGroups=n}else{var a={};for(var u in t.models){var c=o.Model.info(u);o.View.assert(!!c,9,[u]),"object"==typeof c.params&&r.extend(a,c.params)}var l=t["params-"];if(l){for(var i=0;i<l.length;i++)delete a[l[i]];delete t["params-"]}t["params+"]&&(r.extend(a,t["params+"]),delete t["params+"]);var f=Object.keys(a);f.length?t.pGroups=[{pNames:f,pFilters:{},pDefaults:a}]:t.pGroups=[]}},o.View._initInfoEvents=function(t){t.createEvents=[],t.initEvents={bind:[],delegate:[]},t.showEvents={bind:[],delegate:[]},t.initNsevents=[],t.showNsevents=[];for(var e in t.events){var n=e.split(" "),r=n.shift().split("@"),i=r.length>1?r.pop():"";i=!i||"init"!==i&&"show"!==i?"":i;var s=r.join("@"),a=n.join(" ");if(s){var u=t.events[e];if(o.V.DOM_EVENTS.indexOf(s)>-1){var c=[s,a,t.events[e]],l="window"===a||"document"===a,f=l||!("scroll"===s&&a);i||(i=l?"show":"init"),t[i+"Events"][f?"delegate":"bind"].push(c)}else o.V.NS_EVENTS.indexOf(s)>-1?t.createEvents.push([s,u]):(i=i||"show",t[i+"Nsevents"].push([s,u]))}}},o.View.getKey=function(t,e,n){return this.getKeyAndParams(t,e,n).key},o.View.getKeyAndParams=function(t,e,n){n=n||o.View.info(t)||{};var i;return i="function"==typeof n.params?n.params(r.extend({},e)):o.View._getKeyParams(t,e,n),"function"==typeof n.paramsRewrite&&(i=n.paramsRewrite(i)),o.View.assert(!!i,10,[t]),{params:i,key:o.key("view="+t,i)}},o.View._getKeyParams=function(t,e,n){var i={},s=!1;for(var a in n.models){var u=o.Model.info(a);"function"==typeof u.params&&(s=!0,r.extend(i,u.params(e)))}s&&(r.extend(i,e),e=i);var c=n.pGroups||[];if(!c.length)return s?e:{};for(var l=0;l<c.length;l++){for(var f=c[l],p=f.pNames||[],h=f.pFilters||{},d=f.pDefaults||{},v={},y=0,_=p.length;y<_;y++){var g=p[y],m=e[g],w=h[g],b=g in d;if(null!=(m=void 0===m?d[g]:m)||!b){if(null==m||w&&m!==w){v=null;break}v[g]=m}}if(v)return v}return null},o.View.create=function(t,e,n){var r=a[t];o.View.assert(!!r,3,[t]);var i=new r;return i._init(t,e,n),i},o.View.assert=function(t,e,n){if(!t){n=Array.isArray(n)?n:[];var r=["ns.View",o.View.ERROR_CODES[e]].concat(n);o.assert.fail.apply(o,r)}},o.View.ERROR_CODES={1:"Can't redefine '%s'",2:"Can't find '%s' to extend '%s'",3:"'%s' is not defined",4:"'%s' can't find handler '%s' for model '%s'",5:"Can't find method '%s' in '%s'",6:"Can't find node for '%s'",7:"you cannot specify params and params+ at the same time",8:"you cannot specify params and params- at the same time",9:"Model %s is not defined!",10:"Could not generate key for view %s",11:"#patchLayout MUST returns valid layout ID",12:"#patchLayout MUST returns layout with ns.Box at top",13:'You cannot change children inside of a regular view. Maybe "%s" should be ns.Box.'},o.View.defaultModelEvents={"ns-model-insert":"invalidate","ns-model-remove":"invalidate","ns-model-changed":"invalidate","ns-model-destroyed":"invalidate"},o.View._expandModelsDecl=function(t){if(!Array.isArray(t))return t;for(var e={},n=0,o=t.length;n<o;n++)e[t[n]]=r.extend({},this.defaultModelEvents);return e},o.View._formatModelsDecl=function(t){var e=this._expandModelsDecl(t);for(var n in e){var r=u(e[n]),o=null;"string"==typeof r&&(o=r,r={});for(var i in this.defaultModelEvents){var s=this.defaultModelEvents[i];void 0===r[i]?r[i]=o||s:r[i]=u(r[i])}e[n]=r}return e};var u=function(t){return!0===t?"invalidate":!1===t?"keepValid":t}})(),o.ViewCollection=function(){},r.extend(o.ViewCollection,o.View),r.inherit(o.ViewCollection,o.View),o.ViewCollection.define=function(t,e,n){e=e||{},n=n||this;var r=o.View.define.call(this,t,e,n);if(o.assert(e.split,"ns.ViewCollection","'%s'  must define 'split' section",t),o.assert(!(e.split.intoViews&&e.split.intoLayouts),"ns.ViewCollection","'%s' can't define 'split.intoViews' and 'split.intoLayouts' sections at same time",t),"string"==typeof e.split.intoViews){var i=o.layout.generateSimple(e.split.intoViews,"ns-auto-layout-"+t);delete e.split.intoViews,e.split.intoLayouts=new Function("",'return "'+i+'"')}else"function"==typeof e.split.intoViews&&(e.split.intoLayouts=function(n,r){var i=e.split.intoViews.call(this,n,r);return i?o.layout.generateSimple(i,"ns-auto-layout-"+t):null});o.assert(e.split.intoLayouts,"ns.ViewCollection","'%s'  must define 'split.intoLayouts' section",t),o.assert(e.split.byModel,"ns.ViewCollection","'%s'  must define 'split.byModel' section",t);var s=e.split.byModel in e.models&&o.Model.infoLite(e.split.byModel).isCollection;return o.assert(s,"ns.ViewCollection","'%s'  must depend on ns.ModelCollection",t),e.isCollection=!0,e.modelCollectionId=e.split.byModel,r},o.ViewCollection.prototype.__customInit=function(){this.__itemsToRemove=[],this.__model2View={},this.__view2ModelKey={}},o.ViewCollection.eventsModelCollectionDefault={"ns-model-insert":"keepValid","ns-model-remove":"keepValid","ns-model-changed":"invalidate","ns-model-destroyed":"invalidate"},o.ViewCollection._expandModelsDecl=function(t){if(!Array.isArray(t))return t;for(var e={},n=0,i=t.length;n<i;n++){var s=t[n];o.Model.infoLite(s).isCollection?e[s]=r.extend({},this.eventsModelCollectionDefault):e[s]=r.extend({},this.defaultModelEvents)}return e},o.ViewCollection.prototype._invokeModelHandler=function(t,e,n,r){if(!r||!r.model)return this._saveModelVersion(e.id),t.apply(this,Array.prototype.slice.call(arguments,2))},o.ViewCollection.prototype._getModelVersion=function(t){var e=this.models[t];return t===this.info.modelCollectionId?e.getSelfVersion():e.getVersion()},o.ViewCollection.prototype.forEachItem=function(t){var e=this.models[this.info.modelCollectionId];if(e.isValid())for(var n=e.models,r=0,o=n.length;r<o;r++){var i=this.getItemByModel(n[r]);i&&t(i)}},o.ViewCollection.prototype.getItemByModel=function(t){var e=t.key;return this.__model2View[e]},o.ViewCollection.prototype.isValid=function(){return this.isValidSelf()&&this.isValidDesc()},o.ViewCollection.prototype.isValidDesc=function(){for(var t in this.views)if(!this.views[t].isValid())return!1;return!0},o.ViewCollection.prototype.invalidate=function(){this.status===this.STATUS.OK&&(this.status=this.STATUS.INVALID)},o.ViewCollection.prototype.invalidateAll=o.View.prototype.invalidate,o.ViewCollection.prototype._getView=function(t,e){var n=o.View.getKey(t,e);return this._getViewByKey(n)},o.ViewCollection.prototype._getViewByKey=function(t){return this.views&&this.views[t]||null},o.ViewCollection.prototype._addView=function(t,e,n){var r=this._getView(t,e);if(!r){r=o.View.create(t,e);var i=r.key,s=n.key;this.views[i]=r,this.__model2View[s]=r,this.__view2ModelKey[i]=s}return r},o.ViewCollection.prototype._deleteView=function(t){var e=t.key,n=this.__view2ModelKey[e];delete this.views[e],delete this.__model2View[n],delete this.__view2ModelKey[e]},o.ViewCollection.prototype._apply=function(t){var e=this.views;for(var n in e)t(e[n],e[n].id)},o.ViewCollection.prototype._getRequestViews=function(t,e,n){var i=e.views,s=this.__evaluateState();if(this.__registerInUpdate(s,t),s){var a=this.models[this.info.modelCollectionId],u={};if(a.isValid()){for(var c=a.models,l=this.info.split.intoLayouts,f=[],p=0,h=c.length;p<h;p++){var d=c[p],v=r.extend({},n,d.params),y=l.call(this,d,v);if(y){var _=o.layout.page(y,v);f.push(_);for(var g in _){var m=this._addView(g,v,d);m._getRequestViews(t,_[g],v),u[m.key]=null}}}i["ns-view-container"]=f,this.__collectInactiveViews(u)}else t.hasPatchLayout=!0}return this._saveLayout(i),t},o.ViewCollection.prototype.__collectInactiveViews=function(t){var e=this;this._apply((function(n){n.key in t||(e._deleteView(n),e.__itemsToRemove.push(n))}))},o.ViewCollection.prototype.__destroyInactiveViews=function(){for(var t=this.__itemsToRemove,e=0,n=t.length;e<n;e++)t[e].destroy();this.__itemsToRemove=[]},o.ViewCollection.prototype._getUpdateTree=function(t){var e;return e=this.isValidSelf()?this._getPlaceholderTree():this._getViewTree(),t.views[this.id]=e,t},o.ViewCollection.prototype._getDescViewTree=function(){var t={};t["ns-view-collection-container"]=[];var e=this.isValidSelf();return this.forEachItem((function(n){var r=null;if(e)if(n.info.isCollection&&n.isValidSelf())r=n._getPlaceholderTree();else if(n.isValid()){if(!n.isValidWithDesc()){var o={views:{}};return n._getUpdateTree(o),void t["ns-view-collection-container"].push(o.views)}}else r=n._getViewTree();else r=n.isValidSelf()?n._getPlaceholderTree():n._getViewTree();if(r){var i={};i[n.id]=r,t["ns-view-collection-container"].push(i)}})),t},o.ViewCollection.prototype._updateHTML=function(t,e,n){var i,s=this._extractNode(t),a=$(s).hasClass("ns-view-placeholder");if(i=e.toplevel?r.extend({},e):e,this.isValidSelf())!e.toplevel&&a&&(o.replaceNode(s,this.node),i=r.extend({},e),i.toplevel=!0,i.parent_added=!0);else{var u=!!this.node;if(!s)throw new Error("[ns.ViewCollection] Can't find node for '"+this.id+"'");e.toplevel?a?i.toplevel=!0:(this.node&&o.replaceNode(this.node,s),i.toplevel=!1,i.parent_added=!0,this._setNode(s)):a?(o.replaceNode(s,this.node),i.toplevel=!1,i.parent_added=!0):this._setNode(s),u&&!this.isLoading()&&(this.__onHide(),this.__onHtmldestroy()),this.isOk()?this._htmlinit(n["ns-view-htmlinit"]):this.isLoading()&&n["ns-view-async"].push(this)}if(this.isOk()&&(this._show(n["ns-view-show"]),n["ns-view-touch"].push(this),this._saveModelsVersions()),!this.isLoading()){var c={},l=this.__getContainer();s=s||this.node;var f;this.forEachItem((function(t){if(a){var e=!t.isValid();t._updateHTML(s,i,n),e&&(f?$(f.node).after(t.node):$(l).prepend(t.node))}else{var u=t.isValid(),p=i;u&&(p=r.extend({},i),p.toplevel=!0),t._updateHTML(s,p,n),u&&o.replaceNode(t._extractNode(s),t.node)}c[t.key]=t,f=t}))}this.__destroyInactiveViews(),this.isLoading()||this.__sortViewItems()},o.ViewCollection.prototype.__getContainer=function(){var t;return t=o.hasClass(this.node,"ns-view-container-desc")?this.node:o.byClass("ns-view-container-desc",this.node)[0],o.assert(t,"ns.ViewCollection","Can't find descendants container (.ns-view-container-desc element) for '"+this.id+"'"),t},o.ViewCollection.prototype.__sortViewItems=function(){var t=this.__getContainer(),e=o.childrenIterator(t);this.forEachItem((function(n){var r=e.getNext();r!==n.node&&(r?t.insertBefore(n.node,r):t.appendChild(n.node))}))},o.Box=function(t,e){this.id=t,this.__setUniqueId(),this.params=e,this.views={},this.key=o.Box.getKey(t),this.node=null,this.active={},this._visible=!1,this.destroyed=!1,this.info={isBox:!0,isCollection:!1}},o.Box.prototype._getViewKey=function(t,e,n){return n===o.L.BOX?o.Box.getKey(t):o.View.getKey(t,e)},o.Box.prototype._getView=function(t,e,n){var r=this._getViewKey(t,e,n);return this.views[r]},o.Box.prototype._addView=function(t,e,n){var r=this._getView(t,e,n);return r||(r=n===o.L.BOX?new o.Box(t,e):o.View.create(t,e,n===o.L.ASYNC),this.views[r.key]=r),r},o.Box.prototype._getDescendantsAndSelf=function(t){var e=this.views;t.push(this);for(var n in e){e[n]._getDescendantsAndSelf(t)}return t},o.Box.prototype._getRequestViews=function(t,e,n){var r=e.views,o={};for(var i in r){var s=r[i],a=this._addView(i,n,s.type);a._getRequestViews(t,s,n),o[i]=a.key}this.active=o},o.Box.prototype._getUpdateTree=function(t){if(this.isNone())t.views[this.id]=this._getViewTree();else for(var e in this.active){var n=this.active[e];this.views[n]._getUpdateTree(t)}},o.Box.prototype._getViewTree=function(){var t=this._getCommonTree();for(var e in this.active){var n=this.active[e];t.views[e]=this.views[n]._getViewTree()}return t},o.Box.prototype.beforeUpdateHTML=function(t,e){for(var n in this.views){var r=this.views[n],o=e||this.active[r.id]!==r.key;r.beforeUpdateHTML(t,o)}},o.Box.prototype._hideInactiveViews=function(){for(var t in this.views){var e=this.views[t];if(this.active[e.id]!==e.key){e.node&&o.removeNode(e.node);for(var n=e._getDescendantsAndSelf([]),r=0,i=n.length;r<i;r++)n[r].hideAndUnbindEvents()}}},o.Box.prototype._updateHTML=function(t,e,n){var r;if(!this.node||!e.toplevel){var i=o.byClass("ns-view-"+this.id,t)[0];i&&(r=this.node,this.node=i,this._visible=!1)}if(!this.node)throw new Error("[ns.Box] Can't find node for '"+this.id+"'");this._hideInactiveViews();var s=this.views,a=this.active;for(var u in a){s[a[u]]._updateHTML(t,e,n)}this._transferViewsToNewNode(r),this._sortViewNodes(),this._show()},o.Box.prototype._sortViewNodes=function(){var t=this.active,e=this.views,n=o.childrenIterator(this.node);for(var r in t){var i=t[r],s=e[i],a=n.getNext();a!==s.node&&(a?this.node.insertBefore(s.node,a):this.node.appendChild(s.node))}},o.Box.prototype._transferViewsToNewNode=function(t){if(t){var e=this.views;for(var n in e){var r=e[n];if(this.active[r.id]!==r.key){var o=r.node;t.contains(o)&&this.node.appendChild(o)}}}},o.Box.prototype._show=function(){return!1===this._visible&&(this._visible=!0),!1},o.Box.prototype.hideAndUnbindEvents=function(){!0===this._visible&&(this._visible=!1)},o.Box.prototype.isNone=function(){return!this.node},o.Box.prototype.isValid=function(){return!!this.node},o.Box.prototype.destroy=function(){var t=this.views;for(var e in t)t[e].destroy();this.node&&($(this.node).off().removeData().remove(),this.node=null,this.$node=null),this.active=null,this.key=null,this.params=null,this.views=null,this._visible=!1,this.destroyed=!0},o.Box.prototype.__setUniqueId=o.View.prototype.__setUniqueId,o.Box.prototype._getCommonTree=o.View.prototype._getCommonTree,o.Box.prototype.isValidWithDesc=o.View.prototype.isValidWithDesc,o.Box.prototype.isOk=r.true,o.Box.prototype.isLoading=r.false,o.Box.getKey=function(t){return"box="+t},e.no=r,e.ns=o})(window,document)}).call(window)},3168:function(t,e){yr.externals["ns-url"]=function(t){return ns.router.url(t)},yr.externals["ns-generate-url"]=function(t,e){return ns.router.generateUrl(t,e)}},3169:function(t,e){!(function(){function t(t,e,r,o,i,s,a){var u=yr.nodeset2data(t),c=u.bosphorus,l=n(c,e,r,o,i,s,a);return Array.isArray(l)?yr.array2nodeset(l):yr.object2nodeset(l)}function e(t,e,n,o,i,s,a,u){var c=yr.nodeset2data(t),l=c.bosphorus,f=l.getModel(e);ns.assert(f,"noscript-bosphorus","Model is undefined");var p=r(l,f,n,o,i,s,a,u);return Array.isArray(p)?yr.array2nodeset(p):yr.object2nodeset(p)}function n(t,e,n,r,o,i,s){try{return t[e](n,r,o,i,s)}catch(n){return ns.log.exception("ns-view-call",n,{id:t.id,key:t.key,method:e}),[]}}function r(t,e,n,r,o,i,s,a){try{return e[n](r,o,i,s,a)}catch(r){return ns.log.exception("ns-model-call",r,{id:t.id,key:t.key,method:n,model:e.id}),[]}}ns.View.prototype.patchTree=function(){return{bosphorus:this}},yr.externals["_ns-view-call"]=t,yr.externals["_ns-view-call-scalar"]=t,yr.externals["_ns-model-call"]=e,yr.externals["_ns-model-call-scalar"]=e})()},3170:function(t,e){ns.page.forceReload=function(t){var e=window.location;window.removeEventListener("hashchange",ns.history.onpopstate,!1),e.replace(t||e.hash),e.reload()},ns.page.hashReplace=function(t){if(!t)return!1;ns.page._forceHashChange=t;var e=window.location.href.toString().replace(/#.+$/,"")+t;return window.location.replace(e),!0},ns.page._forceHashChange=null,ns.router.URL_FIRST_SYMBOL="#",ns.history.init=function(){window.addEventListener("hashchange",ns.history.onpopstate,!1),$(document).on("click","a",ns.history._onAnchorClick)},ns.history.pushState=function(t,e){ns.page._forceHashChange=t,window.location.href=t},ns.history.replaceState=function(t,e){ns.page._forceHashChange=t,window.location.replace(t)},ns.history.onpopstate=function(){var t,e=ns.page.getCurrentUrl(),n=ns.page._forceHashChange;try{t=decodeURIComponent(n)}catch(t){}if(n&&n==e||t&&t==e)return!1;ns.page.go(e)}},3171:function(t,e){!(function(){function t(t,e){return e.forEach((function(e){if("string"==typeof e){var n=ns.View.info(e);t.events=no.extend({},n.events,t.events)}})),e.slice(0,e.length-1).forEach((function(e){if("string"==typeof e){var n=ns.View.info(e);t.methods=no.extend({},n.methods,t.methods)}})),t}[ns.View,ns.ViewCollection].forEach((function(e){e.edefine=function(n,r){return r=r||{},r=t(r,Array.prototype.slice.call(arguments,2)),e.define(n,r,arguments[arguments.length-1])}}))})()},3172:function(t,e){!(function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};e.m=t,e.c=n,e.p="",e(0)})([(function(t,e,n){"use strict";function r(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=t&&(_(t)?t.apply(this,r):y.apply(void 0,[this,t].concat(r))),s=e&&(_(e)?e.apply(this,r):y.apply(void 0,[this,e].concat(r)));!j.DEBUG||m(i)&&m(s)||C("Обработчик события не должен возвращать результат")}function o(t,e,n){return c(t,e)?e:(("invalidate"===t&&"keepValid"===e||"keepValid"===t&&"invalidate"===e)&&j.assert.fail("ns.View.define","Попытка определить подписки с противоположными действиями. Событие: %s",n),M(t,M(e,r)))}function i(t,e){return c(t,e)?e:b(t,e,o)}function s(t,e){return c(t,e)?e:t}function a(t,e,n){return c(t,e)?e:"methods"===n?b(t,e,s):"events"===n?i(t,e):"models"===n?b(this._formatModelsDecl(t),this._formatModelsDecl(e),i):"ctor"===n?function(){e&&e.call(this),t&&t.call(this)}:void 0}function u(t){return g(t)&&j.View.info(t)||t}function c(t,e){return m(t)||t===e}function l(t,e,n){n=f(n);var r=u(n.pop()),o=a.bind(t),i=v(e,"mixins",[]);return i=p(i,n),i=h(i),i.unshift(e),i=E(i,(function(t){return x(u(t),S)})),i.push(o),i=T(i,k),i=b(i,x(r,A),o),i=d(i,e)}var f=n(1),p=n(98),h=n(101),d=n(102),v=n(112),y=n(122),_=n(20),g=n(127),m=n(128),w=n(124),b=n(129),x=n(139),V=n(143),M=n(148),E=n(189),T=n(218),j=n(219),S=["methods","ctor","events","models"],A=["ctor","events","models"],k=V(b),C=M(y,(function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=n.shift();t.apply(void 0,[window,"console.warn","[ns.View.define] "+o].concat(n))})),U=M(y,(function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=n.shift();t.apply(void 0,[window,"console.log","[ns.View.define] "+o].concat(n))}));[j.View,j.ViewCollection].forEach((function(t){t.defineNg=function(e,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];return j.DEBUG&&U("Определение вида %s, mixins: %o, %o",e,o,v(n,"mixins",[])),t.define(e,l(t,n,o),w(o))},t.defineModelEvents=function(e){var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return d({},e,v(t._formatModelsDecl({test:n}),"test"))}}))}),(function(t,e,n){function r(t){return o(t,!1,!0)}var o=n(2);t.exports=r}),(function(t,e,n){function r(t,e,n,T,j,S,A){var k;if(T&&(k=S?T(t,j,S,A):T(t)),void 0!==k)return k;if(!m(t))return t;var C=y(t);if(C){if(k=h(t),!e)return c(t,k)}else{var U=p(t),O=U==x||U==V;if(_(t))return u(t,e);if(U==M||U==b||O&&!S){if(g(t))return S?t:{};if(k=v(O?{}:t),!e)return l(t,a(k,t))}else{if(!E[U])return S?t:{};k=d(t,U,r,e)}}A||(A=new o);var R=A.get(t);if(R)return R;if(A.set(t,k),!C)var D=n?f(t):w(t);return i(D||t,(function(o,i){D&&(i=o,o=t[i]),s(k,i,r(o,e,n,T,i,t,A))})),k}var o=n(3),i=n(44),s=n(45),a=n(46),u=n(62),c=n(63),l=n(64),f=n(67),p=n(70),h=n(76),d=n(77),v=n(92),y=n(56),_=n(95),g=n(22),m=n(21),w=n(48),b="[object Arguments]",x="[object Function]",V="[object GeneratorFunction]",M="[object Object]",E={};E[b]=E["[object Array]"]=E["[object ArrayBuffer]"]=E["[object DataView]"]=E["[object Boolean]"]=E["[object Date]"]=E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Map]"]=E["[object Number]"]=E[M]=E["[object RegExp]"]=E["[object Set]"]=E["[object String]"]=E["[object Symbol]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E["[object Error]"]=E[x]=E["[object WeakMap]"]=!1,t.exports=r}),(function(t,e,n){function r(t){this.__data__=new o(t)}var o=n(4),i=n(12),s=n(13),a=n(14),u=n(15),c=n(16);r.prototype.clear=i,r.prototype.delete=s,r.prototype.get=a,r.prototype.has=u,r.prototype.set=c,t.exports=r}),(function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(5),i=n(6),s=n(9),a=n(10),u=n(11);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r}),(function(t,e){function n(){this.__data__=[]}t.exports=n}),(function(t,e,n){function r(t){var e=this.__data__,n=o(e,t);return!(n<0)&&(n==e.length-1?e.pop():s.call(e,n,1),!0)}var o=n(7),i=Array.prototype,s=i.splice;t.exports=r}),(function(t,e,n){function r(t,e){for(var n=t.length;n--;)if(o(t[n][0],e))return n;return-1}var o=n(8);t.exports=r}),(function(t,e){function n(t,e){return t===e||t!==t&&e!==e}t.exports=n}),(function(t,e,n){function r(t){var e=this.__data__,n=o(e,t);return n<0?void 0:e[n][1]}var o=n(7);t.exports=r}),(function(t,e,n){function r(t){return o(this.__data__,t)>-1}var o=n(7);t.exports=r}),(function(t,e,n){function r(t,e){var n=this.__data__,r=o(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}var o=n(7);t.exports=r}),(function(t,e,n){function r(){this.__data__=new o}var o=n(4);t.exports=r}),(function(t,e){function n(t){return this.__data__.delete(t)}t.exports=n}),(function(t,e){function n(t){return this.__data__.get(t)}t.exports=n}),(function(t,e){function n(t){return this.__data__.has(t)}t.exports=n}),(function(t,e,n){function r(t,e){var n=this.__data__;if(n instanceof o){var r=n.__data__;if(!i||r.length<a-1)return r.push([t,e]),this;n=this.__data__=new s(r)}return n.set(t,e),this}var o=n(4),i=n(17),s=n(29),a=200;t.exports=r}),(function(t,e,n){var r=n(18),o=n(25),i=r(o,"Map");t.exports=i}),(function(t,e,n){function r(t,e){var n=i(t,e);return o(n)?n:void 0}var o=n(19),i=n(28);t.exports=r}),(function(t,e,n){function r(t){return!(!a(t)||s(t))&&(o(t)||i(t)?v:l).test(u(t))}var o=n(20),i=n(22),s=n(23),a=n(21),u=n(27),c=/[\\^$.*+?()[\]{}|]/g,l=/^\[object .+?Constructor\]$/,f=Function.prototype,p=Object.prototype,h=f.toString,d=p.hasOwnProperty,v=RegExp("^"+h.call(d).replace(c,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r}),(function(t,e,n){function r(t){var e=o(t)?u.call(t):"";return e==i||e==s}var o=n(21),i="[object Function]",s="[object GeneratorFunction]",a=Object.prototype,u=a.toString;t.exports=r}),(function(t,e){function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=n}),(function(t,e){function n(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}t.exports=n}),(function(t,e,n){function r(t){return!!i&&i in t}var o=n(24),i=(function(){var t=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();t.exports=r}),(function(t,e,n){var r=n(25),o=r["__core-js_shared__"];t.exports=o}),(function(t,e,n){var r=n(26),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i}),(function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,(function(){return this})())}),(function(t,e){function n(t){if(null!=t){try{return o.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var r=Function.prototype,o=r.toString;t.exports=n}),(function(t,e){function n(t,e){return null==t?void 0:t[e]}t.exports=n}),(function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(30),i=n(38),s=n(41),a=n(42),u=n(43);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r}),(function(t,e,n){function r(){this.__data__={hash:new o,map:new(s||i),string:new o}}var o=n(31),i=n(4),s=n(17);t.exports=r}),(function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(32),i=n(34),s=n(35),a=n(36),u=n(37);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r}),(function(t,e,n){function r(){this.__data__=o?o(null):{}}var o=n(33);t.exports=r}),(function(t,e,n){var r=n(18),o=r(Object,"create");t.exports=o}),(function(t,e){function n(t){return this.has(t)&&delete this.__data__[t]}t.exports=n}),(function(t,e,n){function r(t){var e=this.__data__;if(o){var n=e[t];return n===i?void 0:n}return a.call(e,t)?e[t]:void 0}var o=n(33),i="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;t.exports=r}),(function(t,e,n){function r(t){var e=this.__data__;return o?void 0!==e[t]:s.call(e,t)}var o=n(33),i=Object.prototype,s=i.hasOwnProperty;t.exports=r}),(function(t,e,n){function r(t,e){return this.__data__[t]=o&&void 0===e?i:e,this}var o=n(33),i="__lodash_hash_undefined__";t.exports=r}),(function(t,e,n){function r(t){return o(this,t).delete(t)}var o=n(39);t.exports=r}),(function(t,e,n){function r(t,e){var n=t.__data__;return o(e)?n["string"==typeof e?"string":"hash"]:n.map}var o=n(40);t.exports=r}),(function(t,e){function n(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=n}),(function(t,e,n){function r(t){return o(this,t).get(t)}var o=n(39);t.exports=r}),(function(t,e,n){function r(t){return o(this,t).has(t)}var o=n(39);t.exports=r}),(function(t,e,n){function r(t,e){return o(this,t).set(t,e),this}var o=n(39);t.exports=r}),(function(t,e){function n(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););return t}t.exports=n}),(function(t,e,n){function r(t,e,n){var r=t[e];s.call(t,e)&&o(r,n)&&(void 0!==n||e in t)||(t[e]=n)}var o=n(8),i=Object.prototype,s=i.hasOwnProperty;t.exports=r}),(function(t,e,n){function r(t,e){return t&&o(e,i(e),t)}var o=n(47),i=n(48);t.exports=r}),(function(t,e,n){function r(t,e,n,r){n||(n={});for(var i=-1,s=e.length;++i<s;){var a=e[i],u=r?r(n[a],t[a],a,n,t):void 0;o(n,a,void 0===u?t[a]:u)}return n}var o=n(45);t.exports=r}),(function(t,e,n){function r(t){return s(t)?o(t):i(t)}var o=n(49),i=n(58),s=n(53);t.exports=r}),(function(t,e,n){function r(t,e){var n=s(t)||i(t)?o(t.length,String):[],r=n.length,u=!!r;for(var l in t)!e&&!c.call(t,l)||u&&("length"==l||a(l,r))||n.push(l);return n}var o=n(50),i=n(51),s=n(56),a=n(57),u=Object.prototype,c=u.hasOwnProperty;t.exports=r}),(function(t,e){function n(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}t.exports=n}),(function(t,e,n){function r(t){return o(t)&&a.call(t,"callee")&&(!c.call(t,"callee")||u.call(t)==i)}var o=n(52),i="[object Arguments]",s=Object.prototype,a=s.hasOwnProperty,u=s.toString,c=s.propertyIsEnumerable;t.exports=r}),(function(t,e,n){function r(t){return i(t)&&o(t)}var o=n(53),i=n(55);t.exports=r}),(function(t,e,n){function r(t){return null!=t&&i(t.length)&&!o(t)}var o=n(20),i=n(54);t.exports=r}),(function(t,e){function n(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}var r=9007199254740991;t.exports=n}),(function(t,e){function n(t){return!!t&&"object"==typeof t}t.exports=n}),(function(t,e){var n=Array.isArray;t.exports=n}),(function(t,e){function n(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=n}),(function(t,e,n){function r(t){if(!o(t))return i(t);var e=[];for(var n in Object(t))a.call(t,n)&&"constructor"!=n&&e.push(n);return e}var o=n(59),i=n(60),s=Object.prototype,a=s.hasOwnProperty;t.exports=r}),(function(t,e){function n(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}var r=Object.prototype;t.exports=n}),(function(t,e,n){var r=n(61),o=r(Object.keys,Object);t.exports=o}),(function(t,e){function n(t,e){return function(n){return t(e(n))}}t.exports=n}),(function(t,e){function n(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}t.exports=n}),(function(t,e){function n(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}t.exports=n}),(function(t,e,n){function r(t,e){return o(t,i(t),e)}var o=n(47),i=n(65);t.exports=r}),(function(t,e,n){var r=n(61),o=n(66),i=Object.getOwnPropertySymbols,s=i?r(i,Object):o;t.exports=s}),(function(t,e){function n(){return[]}t.exports=n}),(function(t,e,n){function r(t){return o(t,s,i)}var o=n(68),i=n(65),s=n(48);t.exports=r}),(function(t,e,n){function r(t,e,n){var r=e(t);return i(t)?r:o(r,n(t))}var o=n(69),i=n(56);t.exports=r}),(function(t,e){function n(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}t.exports=n}),(function(t,e,n){var r=n(71),o=n(17),i=n(72),s=n(73),a=n(74),u=n(75),c=n(27),l=Object.prototype,f=l.toString,p=c(r),h=c(o),d=c(i),v=c(s),y=c(a),_=u;(r&&"[object DataView]"!=_(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=_(new o)||i&&"[object Promise]"!=_(i.resolve())||s&&"[object Set]"!=_(new s)||a&&"[object WeakMap]"!=_(new a))&&(_=function(t){var e=f.call(t),n="[object Object]"==e?t.constructor:void 0,r=n?c(n):void 0;if(r)switch(r){case p:return"[object DataView]";case h:return"[object Map]";case d:return"[object Promise]";case v:return"[object Set]";case y:return"[object WeakMap]"}return e}),t.exports=_}),(function(t,e,n){var r=n(18),o=n(25),i=r(o,"DataView");t.exports=i}),(function(t,e,n){var r=n(18),o=n(25),i=r(o,"Promise");t.exports=i}),(function(t,e,n){var r=n(18),o=n(25),i=r(o,"Set");t.exports=i}),(function(t,e,n){var r=n(18),o=n(25),i=r(o,"WeakMap");t.exports=i}),(function(t,e){function n(t){return o.call(t)}var r=Object.prototype,o=r.toString;t.exports=n}),(function(t,e){function n(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&o.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var r=Object.prototype,o=r.hasOwnProperty;t.exports=n}),(function(t,e,n){function r(t,e,n,r){var k=t.constructor;switch(e){case m:return o(t);case f:case p:return new k(+t);case w:return i(t,r);case b:case x:case V:case M:case E:case T:case j:case S:case A:return l(t,r);case h:return s(t,r,n);case d:case _:return new k(t);case v:return a(t);case y:return u(t,r,n);case g:return c(t)}}var o=n(78),i=n(80),s=n(81),a=n(85),u=n(86),c=n(89),l=n(91),f="[object Boolean]",p="[object Date]",h="[object Map]",d="[object Number]",v="[object RegExp]",y="[object Set]",_="[object String]",g="[object Symbol]",m="[object ArrayBuffer]",w="[object DataView]",b="[object Float32Array]",x="[object Float64Array]",V="[object Int8Array]",M="[object Int16Array]",E="[object Int32Array]",T="[object Uint8Array]",j="[object Uint8ClampedArray]",S="[object Uint16Array]",A="[object Uint32Array]";t.exports=r}),(function(t,e,n){function r(t){var e=new t.constructor(t.byteLength);return new o(e).set(new o(t)),e}var o=n(79);t.exports=r}),(function(t,e,n){var r=n(25),o=r.Uint8Array;t.exports=o}),(function(t,e,n){function r(t,e){var n=e?o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var o=n(78);t.exports=r}),(function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return i(r,o,new t.constructor)}var o=n(82),i=n(83),s=n(84);t.exports=r}),(function(t,e){function n(t,e){return t.set(e[0],e[1]),t}t.exports=n}),(function(t,e){function n(t,e,n,r){var o=-1,i=t?t.length:0;for(r&&i&&(n=t[++o]);++o<i;)n=e(n,t[o],o,t);return n}t.exports=n}),(function(t,e){function n(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}t.exports=n}),(function(t,e){function n(t){var e=new t.constructor(t.source,r.exec(t));return e.lastIndex=t.lastIndex,e}var r=/\w*$/;t.exports=n}),(function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return i(r,o,new t.constructor)}var o=n(87),i=n(83),s=n(88);t.exports=r}),(function(t,e){function n(t,e){return t.add(e),t}t.exports=n}),(function(t,e){function n(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}t.exports=n}),(function(t,e,n){function r(t){return s?Object(s.call(t)):{}}var o=n(90),i=o?o.prototype:void 0,s=i?i.valueOf:void 0;t.exports=r}),(function(t,e,n){var r=n(25),o=r.Symbol;t.exports=o}),(function(t,e,n){function r(t,e){var n=e?o(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var o=n(78);t.exports=r}),(function(t,e,n){function r(t){return"function"!=typeof t.constructor||s(t)?{}:o(i(t))}var o=n(93),i=n(94),s=n(59);t.exports=r}),(function(t,e,n){function r(t){return o(t)?i(t):{}}var o=n(21),i=Object.create;t.exports=r}),(function(t,e,n){var r=n(61),o=r(Object.getPrototypeOf,Object);t.exports=o}),(function(t,e,n){(function(t){var r=n(25),o=n(97),i="object"==typeof e&&e&&!e.nodeType&&e,s=i&&"object"==typeof t&&t&&!t.nodeType&&t,a=s&&s.exports===i,u=a?r.Buffer:void 0,c=u?u.isBuffer:void 0,l=c||o;t.exports=l}).call(e,n(96)(t))}),(function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}),(function(t,e){function n(){return!1}t.exports=n}),(function(t,e,n){function r(){for(var t=arguments.length,e=Array(t?t-1:0),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return t?o(a(n)?s(n):[n],i(e,1)):[]}var o=n(69),i=n(99),s=n(63),a=n(56);t.exports=r}),(function(t,e,n){function r(t,e,n,s,a){var u=-1,c=t.length;for(n||(n=i),a||(a=[]);++u<c;){var l=t[u];e>0&&n(l)?e>1?r(l,e-1,n,s,a):o(a,l):s||(a[a.length]=l)}return a}var o=n(69),i=n(100);t.exports=r}),(function(t,e,n){function r(t){return s(t)||i(t)||!!(a&&t&&t[a])}var o=n(90),i=n(51),s=n(56),a=o?o.isConcatSpreadable:void 0;t.exports=r}),(function(t,e){function n(t){return t?o.call(t):t}var r=Array.prototype,o=r.reverse;t.exports=n}),(function(t,e,n){var r=n(103),o=n(104),i=n(105),s=n(107),a=s((function(t){return t.push(void 0,o),r(i,void 0,t)}));t.exports=a}),(function(t,e){function n(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}t.exports=n}),(function(t,e,n){function r(t,e,n,r){return void 0===t||o(t,i[n])&&!s.call(r,n)?e:t}var o=n(8),i=Object.prototype,s=i.hasOwnProperty;t.exports=r}),(function(t,e,n){var r=n(47),o=n(106),i=n(109),s=o((function(t,e,n,o){r(e,i(e),t,o)}));t.exports=s}),(function(t,e,n){function r(t){return o((function(e,n){var r=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(o--,s):void 0,a&&i(n[0],n[1],a)&&(s=o<3?void 0:s,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,s)}return e}))}var o=n(107),i=n(108);t.exports=r}),(function(t,e,n){function r(t,e){return e=i(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,s=i(n.length-e,0),a=Array(s);++r<s;)a[r]=n[e+r];r=-1;for(var u=Array(e+1);++r<e;)u[r]=n[r];return u[e]=a,o(t,this,u)}}var o=n(103),i=Math.max;t.exports=r}),(function(t,e,n){function r(t,e,n){if(!a(n))return!1;var r=typeof e;return!!("number"==r?i(n)&&s(e,n.length):"string"==r&&e in n)&&o(n[e],t)}var o=n(8),i=n(53),s=n(57),a=n(21);t.exports=r}),(function(t,e,n){function r(t){return s(t)?o(t,!0):i(t)}var o=n(49),i=n(110),s=n(53);t.exports=r}),(function(t,e,n){function r(t){if(!o(t))return s(t);var e=i(t),n=[];for(var r in t)("constructor"!=r||!e&&u.call(t,r))&&n.push(r);return n}var o=n(21),i=n(59),s=n(111),a=Object.prototype,u=a.hasOwnProperty;t.exports=r}),(function(t,e){function n(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}t.exports=n}),(function(t,e,n){function r(t,e,n){var r=null==t?void 0:o(t,e);return void 0===r?n:r}var o=n(113);t.exports=r}),(function(t,e,n){function r(t,e){e=i(e,t)?[e]:o(e);for(var n=0,r=e.length;null!=t&&n<r;)t=t[s(e[n++])];return n&&n==r?t:void 0}var o=n(114),i=n(120),s=n(121);t.exports=r}),(function(t,e,n){function r(t){return o(t)?t:i(t)}var o=n(56),i=n(115);t.exports=r}),(function(t,e,n){var r=n(116),o=n(117),i=/^\./,s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,u=r((function(t){t=o(t);var e=[];return i.test(t)&&e.push(""),t.replace(s,(function(t,n,r,o){e.push(r?o.replace(a,"$1"):n||t)})),e}));t.exports=u}),(function(t,e,n){function r(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=t.apply(this,r);return n.cache=i.set(o,s),s};return n.cache=new(r.Cache||o),n}var o=n(29),i="Expected a function";r.Cache=o,t.exports=r}),(function(t,e,n){function r(t){return null==t?"":o(t)}var o=n(118);t.exports=r}),(function(t,e,n){function r(t){if("string"==typeof t)return t;if(i(t))return u?u.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}var o=n(90),i=n(119),s=1/0,a=o?o.prototype:void 0,u=a?a.toString:void 0;t.exports=r}),(function(t,e,n){function r(t){return"symbol"==typeof t||o(t)&&a.call(t)==i}var o=n(55),i="[object Symbol]",s=Object.prototype,a=s.toString;t.exports=r}),(function(t,e,n){function r(t,e){if(o(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!i(t))||(a.test(t)||!s.test(t)||null!=e&&t in Object(e))}var o=n(56),i=n(119),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=r}),(function(t,e,n){function r(t){if("string"==typeof t||o(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}var o=n(119),i=1/0;t.exports=r}),(function(t,e,n){var r=n(123),o=n(107),i=o(r);t.exports=i}),(function(t,e,n){function r(t,e,n){s(e,t)||(e=i(e),t=u(t,e),e=a(e));var r=null==t?t:t[c(e)];return null==r?void 0:o(r,t,n)}var o=n(103),i=n(114),s=n(120),a=n(124),u=n(125),c=n(121);t.exports=r}),(function(t,e){function n(t){var e=t?t.length:0;return e?t[e-1]:void 0}t.exports=n}),(function(t,e,n){function r(t,e){return 1==e.length?t:o(t,i(e,0,-1))}var o=n(113),i=n(126);t.exports=r}),(function(t,e){function n(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),n=n>o?o:n,n<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}t.exports=n}),(function(t,e,n){function r(t){return"string"==typeof t||!o(t)&&i(t)&&u.call(t)==s}var o=n(56),i=n(55),s="[object String]",a=Object.prototype,u=a.toString;t.exports=r}),(function(t,e){function n(t){return void 0===t}t.exports=n}),(function(t,e,n){var r=n(130),o=n(106),i=o((function(t,e,n,o){r(t,e,n,o)}));t.exports=i}),(function(t,e,n){function r(t,e,n,p,h){if(t!==e){if(!c(e)&&!f(e))var d=a(e);i(d||e,(function(i,a){if(d&&(a=i,i=e[a]),l(i))h||(h=new o),u(t,e,a,n,r,p,h);else{var c=p?p(t[a],i,a+"",t,e,h):void 0;void 0===c&&(c=i),s(t,a,c)}}))}}var o=n(3),i=n(44),s=n(131),a=n(110),u=n(132),c=n(56),l=n(21),f=n(134);t.exports=r}),(function(t,e,n){function r(t,e,n){(void 0===n||o(t[e],n))&&("number"!=typeof e||void 0!==n||e in t)||(t[e]=n)}var o=n(8);t.exports=r}),(function(t,e,n){function r(t,e,n,r,v,y,_){var g=t[n],m=e[n],w=_.get(m);if(w)return void o(t,n,w);var b=y?y(g,m,n+"",t,e,_):void 0,x=void 0===b;x&&(b=m,u(m)||h(m)?u(g)?b=g:c(g)?b=s(g):(x=!1,b=i(m,!0)):p(m)||a(m)?a(g)?b=d(g):!f(g)||r&&l(g)?(x=!1,b=i(m,!0)):b=g:x=!1),x&&(_.set(m,b),v(b,m,r,y,_),_.delete(m)),o(t,n,b)}var o=n(131),i=n(2),s=n(63),a=n(51),u=n(56),c=n(52),l=n(20),f=n(21),p=n(133),h=n(134),d=n(138);t.exports=r}),(function(t,e,n){function r(t){if(!s(t)||h.call(t)!=a||i(t))return!1;var e=o(t);if(null===e)return!0;var n=f.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==p}var o=n(94),i=n(22),s=n(55),a="[object Object]",u=Function.prototype,c=Object.prototype,l=u.toString,f=c.hasOwnProperty,p=l.call(Object),h=c.toString;t.exports=r}),(function(t,e,n){var r=n(135),o=n(136),i=n(137),s=i&&i.isTypedArray,a=s?o(s):r;t.exports=a}),(function(t,e,n){function r(t){return i(t)&&o(t.length)&&!!s[u.call(t)]}var o=n(54),i=n(55),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1;var a=Object.prototype,u=a.toString;t.exports=r}),(function(t,e){function n(t){return function(e){return t(e)}}t.exports=n}),(function(t,e,n){(function(t){var r=n(26),o="object"==typeof e&&e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,s=i&&i.exports===o,a=s&&r.process,u=(function(){try{return a&&a.binding("util")}catch(t){}})();t.exports=u}).call(e,n(96)(t))}),(function(t,e,n){function r(t){return o(t,i(t))}var o=n(47),i=n(109);t.exports=r}),(function(t,e,n){var r=n(140),o=n(99),i=n(141),s=n(107),a=n(121),u=s((function(t,e){return null==t?{}:i(t,r(o(e,1),a))}));t.exports=u}),(function(t,e){function n(t,e){for(var n=-1,r=t?t.length:0,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}t.exports=n}),(function(t,e,n){function r(t,e){return t=Object(t),o(t,e,(function(e,n){return n in t}))}var o=n(142);t.exports=r}),(function(t,e){function n(t,e,n){for(var r=-1,o=e.length,i={};++r<o;){var s=e[r],a=t[s];n(a,s)&&(i[s]=a)}return i}t.exports=n}),(function(t,e,n){function r(t,e){if("function"!=typeof t)throw new TypeError(c);return e=void 0===e?0:l(u(e),0),s((function(n){var r=n[e],s=a(n,0,e);return r&&i(s,r),o(t,this,s)}))}var o=n(103),i=n(69),s=n(107),a=n(144),u=n(145),c="Expected a function",l=Math.max;t.exports=r}),(function(t,e,n){function r(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:o(t,e,n)}var o=n(126);t.exports=r}),(function(t,e,n){function r(t){var e=o(t),n=e%1;return e===e?n?e-n:e:0}var o=n(146);t.exports=r}),(function(t,e,n){function r(t){if(!t)return 0===t?t:0;if((t=o(t))===i||t===-i){return(t<0?-1:1)*s}return t===t?t:0}var o=n(147),i=1/0,s=1.7976931348623157e308;t.exports=r}),(function(t,e,n){function r(t){if("number"==typeof t)return t;if(i(t))return s;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=c.test(t);return n||l.test(t)?f(t.slice(2),n?2:8):u.test(t)?s:+t}var o=n(21),i=n(119),s=NaN,a=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,f=parseInt;t.exports=r}),(function(t,e,n){function r(t,e){return e=null==e?o:e,i(e,t)}var o=n(149),i=n(150);t.exports=r}),(function(t,e){function n(t){return t}t.exports=n}),(function(t,e,n){var r=n(107),o=n(151),i=n(184),s=n(186),a=r((function(t,e){var n=s(e,i(a));return o(t,32,void 0,e,n)}));a.placeholder={},t.exports=a}),(function(t,e,n){function r(t,e,n,r,x,V,M,E){var T=e&y;if(!T&&"function"!=typeof t)throw new TypeError(d);var j=r?r.length:0;if(j||(e&=~(m|w),r=x=void 0),M=void 0===M?M:b(h(M),0),E=void 0===E?E:h(E),j-=x?x.length:0,e&w){var S=r,A=x;r=x=void 0}var k=T?void 0:c(t),C=[t,e,n,r,x,S,A,V,M,E];if(k&&l(C,k),t=C[0],e=C[1],n=C[2],r=C[3],x=C[4],E=C[9]=null==C[9]?T?0:t.length:b(C[9]-j,0),!E&&e&(_|g)&&(e&=~(_|g)),e&&e!=v)U=e==_||e==g?s(t,e,E):e!=m&&e!=(v|m)||x.length?a.apply(void 0,C):u(t,e,n,r);else var U=i(t,e,n);return p((k?o:f)(U,C),t,e)}var o=n(152),i=n(154),s=n(156),a=n(157),u=n(187),c=n(165),l=n(188),f=n(172),p=n(174),h=n(145),d="Expected a function",v=1,y=2,_=8,g=16,m=32,w=64,b=Math.max;t.exports=r}),(function(t,e,n){var r=n(149),o=n(153),i=o?function(t,e){return o.set(t,e),t}:r;t.exports=i}),(function(t,e,n){var r=n(74),o=r&&new r;t.exports=o}),(function(t,e,n){function r(t,e,n){function r(){return(this&&this!==i&&this instanceof r?u:t).apply(a?n:this,arguments)}var a=e&s,u=o(t);return r}var o=n(155),i=n(25),s=1;t.exports=r}),(function(t,e,n){function r(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=o(t.prototype),r=t.apply(n,e);return i(r)?r:n}}var o=n(93),i=n(21);t.exports=r}),(function(t,e,n){function r(t,e,n){function r(){for(var i=arguments.length,p=Array(i),h=i,d=u(r);h--;)p[h]=arguments[h];var v=i<3&&p[0]!==d&&p[i-1]!==d?[]:c(p,d);return(i-=v.length)<n?a(t,e,s,r.placeholder,void 0,p,v,void 0,void 0,n-i):o(this&&this!==l&&this instanceof r?f:t,this,p)}var f=i(t);return r}var o=n(103),i=n(155),s=n(157),a=n(161),u=n(184),c=n(186),l=n(25);t.exports=r}),(function(t,e,n){function r(t,e,n,m,w,b,x,V,M,E){function T(){for(var h=arguments.length,d=Array(h),v=h;v--;)d[v]=arguments[v];if(k)var y=c(T),_=s(d,y);if(m&&(d=o(d,m,w,k)),b&&(d=i(d,b,x,k)),h-=_,k&&h<E){var g=f(d,y);return u(t,e,r,T.placeholder,n,d,g,V,M,E-h)}var O=S?n:this,R=A?O[t]:t;return h=d.length,V?d=l(d,V):C&&h>1&&d.reverse(),j&&M<h&&(d.length=M),this&&this!==p&&this instanceof T&&(R=U||a(R)),R.apply(O,d)}var j=e&_,S=e&h,A=e&d,k=e&(v|y),C=e&g,U=A?void 0:a(t);return T}var o=n(158),i=n(159),s=n(160),a=n(155),u=n(161),c=n(184),l=n(185),f=n(186),p=n(25),h=1,d=2,v=8,y=16,_=128,g=512;t.exports=r}),(function(t,e){function n(t,e,n,o){for(var i=-1,s=t.length,a=n.length,u=-1,c=e.length,l=r(s-a,0),f=Array(c+l),p=!o;++u<c;)f[u]=e[u];for(;++i<a;)(p||i<s)&&(f[n[i]]=t[i]);for(;l--;)f[u++]=t[i++];return f}var r=Math.max;t.exports=n}),(function(t,e){function n(t,e,n,o){for(var i=-1,s=t.length,a=-1,u=n.length,c=-1,l=e.length,f=r(s-u,0),p=Array(f+l),h=!o;++i<f;)p[i]=t[i];for(var d=i;++c<l;)p[d+c]=e[c];for(;++a<u;)(h||i<s)&&(p[d+n[a]]=t[i++]);return p}var r=Math.max;t.exports=n}),(function(t,e){function n(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&r++;return r}t.exports=n}),(function(t,e,n){function r(t,e,n,r,h,d,v,y,_,g){var m=e&l,w=m?v:void 0,b=m?void 0:v,x=m?d:void 0,V=m?void 0:d;e|=m?f:p,(e&=~(m?p:f))&c||(e&=~(a|u));var M=[t,e,h,x,w,V,b,y,_,g],E=n.apply(void 0,M);return o(t)&&i(E,M),E.placeholder=r,s(E,t,e)}var o=n(162),i=n(172),s=n(174),a=1,u=2,c=4,l=8,f=32,p=64;t.exports=r}),(function(t,e,n){function r(t){var e=s(t),n=a[e];if("function"!=typeof n||!(e in o.prototype))return!1;if(t===n)return!0;var r=i(n);return!!r&&t===r[0]}var o=n(163),i=n(165),s=n(167),a=n(169);t.exports=r}),(function(t,e,n){function r(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=s,this.__views__=[]}var o=n(93),i=n(164),s=4294967295;r.prototype=o(i.prototype),r.prototype.constructor=r,t.exports=r}),(function(t,e){function n(){}t.exports=n}),(function(t,e,n){var r=n(153),o=n(166),i=r?function(t){return r.get(t)}:o;t.exports=i}),(function(t,e){function n(){}t.exports=n}),(function(t,e,n){function r(t){for(var e=t.name+"",n=o[e],r=s.call(o,e)?n.length:0;r--;){var i=n[r],a=i.func;if(null==a||a==t)return i.name}return e}var o=n(168),i=Object.prototype,s=i.hasOwnProperty;t.exports=r}),(function(t,e){var n={};t.exports=n}),(function(t,e,n){function r(t){if(u(t)&&!a(t)&&!(t instanceof o)){if(t instanceof i)return t;if(f.call(t,"__wrapped__"))return c(t)}return new i(t)}var o=n(163),i=n(170),s=n(164),a=n(56),u=n(55),c=n(171),l=Object.prototype,f=l.hasOwnProperty;r.prototype=s.prototype,r.prototype.constructor=r,t.exports=r}),(function(t,e,n){function r(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}var o=n(93),i=n(164);r.prototype=o(i.prototype),r.prototype.constructor=r,t.exports=r}),(function(t,e,n){function r(t){if(t instanceof o)return t.clone();var e=new i(t.__wrapped__,t.__chain__);return e.__actions__=s(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var o=n(163),i=n(170),s=n(63);t.exports=r}),(function(t,e,n){var r=n(152),o=n(173),i=(function(){var t=0,e=0;return function(n,i){var s=o(),a=16-(s-e);if(e=s,a>0){if(++t>=150)return n}else t=0;return r(n,i)}})();t.exports=i}),(function(t,e,n){var r=n(25),o=function(){return r.Date.now()};t.exports=o}),(function(t,e,n){var r=n(175),o=n(176),i=n(177),s=n(149),a=n(178),u=n(179),c=o?function(t,e,n){var s=e+"";return o(t,"toString",{configurable:!0,enumerable:!1,value:r(a(s,u(i(s),n)))})}:s;t.exports=c}),(function(t,e){function n(t){return function(){return t}}t.exports=n}),(function(t,e,n){var r=n(18),o=(function(){var t=r(Object,"defineProperty"),e=r.name;return e&&e.length>2?t:void 0})();t.exports=o}),(function(t,e){function n(t){var e=t.match(r);return e?e[1].split(o):[]}var r=/\{\n\/\* \[wrapped with (.+)\] \*/,o=/,? & /;t.exports=n}),(function(t,e){function n(t,e){var n=e.length,o=n-1;return e[o]=(n>1?"& ":"")+e[o],e=e.join(n>2?", ":" "),t.replace(r,"{\n/* [wrapped with "+e+"] */\n")}var r=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;t.exports=n}),(function(t,e,n){function r(t,e){return o(s,(function(n){var r="_."+n[0];e&n[1]&&!i(t,r)&&t.push(r)})),t.sort()}var o=n(44),i=n(180),s=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];t.exports=r}),(function(t,e,n){function r(t,e){return!!(t?t.length:0)&&o(t,e,0)>-1}var o=n(181);t.exports=r}),(function(t,e,n){function r(t,e,n){if(e!==e)return o(t,i,n);for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;return-1}var o=n(182),i=n(183);t.exports=r}),(function(t,e){function n(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}t.exports=n}),(function(t,e){function n(t){return t!==t}t.exports=n}),(function(t,e){function n(t){return t.placeholder}t.exports=n}),(function(t,e,n){function r(t,e){for(var n=t.length,r=s(e.length,n),a=o(t);r--;){var u=e[r];t[r]=i(u,n)?a[u]:void 0}return t}var o=n(63),i=n(57),s=Math.min;t.exports=r}),(function(t,e){function n(t,e){for(var n=-1,o=t.length,i=0,s=[];++n<o;){var a=t[n];a!==e&&a!==r||(t[n]=r,s[i++]=n)}return s}var r="__lodash_placeholder__";t.exports=n}),(function(t,e,n){function r(t,e,n,r){function u(){for(var e=-1,i=arguments.length,a=-1,f=r.length,p=Array(f+i),h=this&&this!==s&&this instanceof u?l:t;++a<f;)p[a]=r[a];for(;i--;)p[a++]=arguments[++e];return o(h,c?n:this,p)}var c=e&a,l=i(t);return u}var o=n(103),i=n(155),s=n(25),a=1;t.exports=r}),(function(t,e,n){function r(t,e){var n=t[1],r=e[1],v=n|r,y=v<(u|c|p),_=r==p&&n==f||r==p&&n==h&&t[7].length<=e[8]||r==(p|h)&&e[7].length<=e[8]&&n==f;if(!y&&!_)return t;r&u&&(t[2]=e[2],v|=n&u?0:l);var g=e[3];if(g){var m=t[3];t[3]=m?o(m,g,e[4]):g,t[4]=m?s(t[3],a):e[4]}return g=e[5],g&&(m=t[5],t[5]=m?i(m,g,e[6]):g,t[6]=m?s(t[5],a):e[6]),g=e[7],g&&(t[7]=g),r&p&&(t[8]=null==t[8]?e[8]:d(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=v,t}var o=n(158),i=n(159),s=n(186),a="__lodash_placeholder__",u=1,c=2,l=4,f=8,p=128,h=256,d=Math.min;t.exports=r}),(function(t,e,n){function r(t,e){return(a(t)?o:s)(t,i(e,3))}var o=n(140),i=n(190),s=n(212),a=n(56);t.exports=r}),(function(t,e,n){function r(t){return"function"==typeof t?t:null==t?s:"object"==typeof t?a(t)?i(t[0],t[1]):o(t):u(t)}var o=n(191),i=n(205),s=n(149),a=n(56),u=n(209);t.exports=r}),(function(t,e,n){function r(t){var e=i(t);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(n){return n===t||o(n,t,e)}}var o=n(192),i=n(202),s=n(204);t.exports=r}),(function(t,e,n){function r(t,e,n,r){var u=n.length,c=u,l=!r;if(null==t)return!c;for(t=Object(t);u--;){var f=n[u];if(l&&f[2]?f[1]!==t[f[0]]:!(f[0]in t))return!1}for(;++u<c;){f=n[u];var p=f[0],h=t[p],d=f[1];if(l&&f[2]){if(void 0===h&&!(p in t))return!1}else{var v=new o;if(r)var y=r(h,d,p,t,e,v);if(!(void 0===y?i(d,h,r,s|a,v):y))return!1}}return!0}var o=n(3),i=n(193),s=1,a=2;t.exports=r}),(function(t,e,n){function r(t,e,n,a,u){return t===e||(null==t||null==e||!i(t)&&!s(e)?t!==t&&e!==e:o(t,e,r,n,a,u))}var o=n(194),i=n(21),s=n(55);t.exports=r}),(function(t,e,n){function r(t,e,n,r,y,g){var m=c(t),w=c(e),b=d,x=d;m||(b=u(t),b=b==h?v:b),w||(x=u(e),x=x==h?v:x);var V=b==v&&!l(t),M=x==v&&!l(e),E=b==x;if(E&&!V)return g||(g=new o),m||f(t)?i(t,e,n,r,y,g):s(t,e,b,n,r,y,g);if(!(y&p)){var T=V&&_.call(t,"__wrapped__"),j=M&&_.call(e,"__wrapped__");if(T||j){var S=T?t.value():t,A=j?e.value():e;return g||(g=new o),n(S,A,r,y,g)}}return!!E&&(g||(g=new o),a(t,e,n,r,y,g))}var o=n(3),i=n(195),s=n(200),a=n(201),u=n(70),c=n(56),l=n(22),f=n(134),p=2,h="[object Arguments]",d="[object Array]",v="[object Object]",y=Object.prototype,_=y.hasOwnProperty;t.exports=r}),(function(t,e,n){function r(t,e,n,r,u,c){var l=u&a,f=t.length,p=e.length;if(f!=p&&!(l&&p>f))return!1;var h=c.get(t);if(h&&c.get(e))return h==e;var d=-1,v=!0,y=u&s?new o:void 0;for(c.set(t,e),c.set(e,t);++d<f;){var _=t[d],g=e[d];if(r)var m=l?r(g,_,d,e,t,c):r(_,g,d,t,e,c);if(void 0!==m){if(m)continue;v=!1;break}if(y){if(!i(e,(function(t,e){if(!y.has(e)&&(_===t||n(_,t,r,u,c)))return y.add(e)}))){v=!1;break}}else if(_!==g&&!n(_,g,r,u,c)){v=!1;break}}return c.delete(t),c.delete(e),v}var o=n(196),i=n(199),s=1,a=2;t.exports=r}),(function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.__data__=new o;++e<n;)this.add(t[e])}var o=n(29),i=n(197),s=n(198);r.prototype.add=r.prototype.push=i,r.prototype.has=s,t.exports=r}),(function(t,e){function n(t){return this.__data__.set(t,r),this}var r="__lodash_hash_undefined__";t.exports=n}),(function(t,e){function n(t){return this.__data__.has(t)}t.exports=n}),(function(t,e){function n(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(e(t[n],n,t))return!0;return!1}t.exports=n}),(function(t,e,n){function r(t,e,n,r,o,V,E){switch(n){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b:return!(t.byteLength!=e.byteLength||!r(new i(t),new i(e)));case p:case h:case y:return s(+t,+e);case d:return t.name==e.name&&t.message==e.message;case _:case m:return t==e+"";case v:var T=u;case g:var j=V&f;if(T||(T=c),t.size!=e.size&&!j)return!1;var S=E.get(t);if(S)return S==e;V|=l,E.set(t,e);var A=a(T(t),T(e),r,o,V,E);return E.delete(t),A;case w:if(M)return M.call(t)==M.call(e)}return!1}var o=n(90),i=n(79),s=n(8),a=n(195),u=n(84),c=n(88),l=1,f=2,p="[object Boolean]",h="[object Date]",d="[object Error]",v="[object Map]",y="[object Number]",_="[object RegExp]",g="[object Set]",m="[object String]",w="[object Symbol]",b="[object ArrayBuffer]",x="[object DataView]",V=o?o.prototype:void 0,M=V?V.valueOf:void 0;t.exports=r}),(function(t,e,n){function r(t,e,n,r,s,u){var c=s&i,l=o(t),f=l.length;if(f!=o(e).length&&!c)return!1;for(var p=f;p--;){var h=l[p];if(!(c?h in e:a.call(e,h)))return!1}var d=u.get(t);if(d&&u.get(e))return d==e;var v=!0;u.set(t,e),u.set(e,t);for(var y=c;++p<f;){h=l[p];var _=t[h],g=e[h];if(r)var m=c?r(g,_,h,e,t,u):r(_,g,h,t,e,u);if(!(void 0===m?_===g||n(_,g,r,s,u):m)){v=!1;break}y||(y="constructor"==h)}if(v&&!y){var w=t.constructor,b=e.constructor;w!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof w&&w instanceof w&&"function"==typeof b&&b instanceof b)&&(v=!1)}return u.delete(t),u.delete(e),v}var o=n(48),i=2,s=Object.prototype,a=s.hasOwnProperty;t.exports=r}),(function(t,e,n){function r(t){for(var e=i(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,o(s)]}return e}var o=n(203),i=n(48);t.exports=r}),(function(t,e,n){function r(t){return t===t&&!o(t)}var o=n(21);t.exports=r}),(function(t,e){function n(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}t.exports=n}),(function(t,e,n){function r(t,e){return a(t)&&u(e)?c(l(t),e):function(n){var r=i(n,t);return void 0===r&&r===e?s(n,t):o(e,r,void 0,f|p)}}var o=n(193),i=n(112),s=n(206),a=n(120),u=n(203),c=n(204),l=n(121),f=1,p=2;t.exports=r}),(function(t,e,n){function r(t,e){return null!=t&&i(t,e,o)}var o=n(207),i=n(208);t.exports=r}),(function(t,e){function n(t,e){return null!=t&&e in Object(t)}t.exports=n}),(function(t,e,n){function r(t,e,n){e=u(e,t)?[e]:o(e);for(var r,f=-1,p=e.length;++f<p;){var h=l(e[f]);if(!(r=null!=t&&n(t,h)))break;t=t[h]}if(r)return r;var p=t?t.length:0;return!!p&&c(p)&&a(h,p)&&(s(t)||i(t))}var o=n(114),i=n(51),s=n(56),a=n(57),u=n(120),c=n(54),l=n(121);t.exports=r}),(function(t,e,n){function r(t){return s(t)?o(a(t)):i(t)}var o=n(210),i=n(211),s=n(120),a=n(121);t.exports=r}),(function(t,e){function n(t){return function(e){return null==e?void 0:e[t]}}t.exports=n}),(function(t,e,n){function r(t){return function(e){return o(e,t)}}var o=n(113);t.exports=r}),(function(t,e,n){function r(t,e){var n=-1,r=i(t)?Array(t.length):[];return o(t,(function(t,o,i){r[++n]=e(t,o,i)})),r}var o=n(213),i=n(53);t.exports=r}),(function(t,e,n){var r=n(214),o=n(217),i=o(r);t.exports=i}),(function(t,e,n){function r(t,e){return t&&o(t,e,i)}var o=n(215),i=n(48);t.exports=r}),(function(t,e,n){var r=n(216),o=r();t.exports=o}),(function(t,e){function n(t){return function(e,n,r){for(var o=-1,i=Object(e),s=r(e),a=s.length;a--;){var u=s[t?a:++o];if(!1===n(i[u],u,i))break}return e}}t.exports=n}),(function(t,e,n){function r(t,e){return function(n,r){if(null==n)return n;if(!o(n))return t(n,r);for(var i=n.length,s=e?i:-1,a=Object(n);(e?s--:++s<i)&&!1!==r(a[s],s,a););return n}}var o=n(53);t.exports=r}),(function(t,e){function n(t,e){return e(t)}t.exports=n}),(function(t,e){t.exports=ns})])},3173:function(t,e){ns.action.getParams=function(t){var e=t.getAttribute("data-params")||t.getAttribute("params"),n=t.getAttribute("href");if(e){if(!e||"{"!==e.charAt(0))return ns.parseQuery(e||"");try{return JSON.parse(e)}catch(t){}}else if(n)return(ns.router(n)||{}).params;return{}},ns.action.__process=ns.action._process,ns.action._process=function(t){return!t.isPropagationStopped()&&ns.action.__process(t)},ns.action.__run=ns.action.run,ns.action.run=function(t,e,n,r){if(e=e||{},e.counter){var o=e.counter.split(":");o&&o.length&&Jane.c(o[0],o[1])}return e.mcounter&&(Jane.c(e.mcounter.split(":")),e.mcounter=null),["archive","delete","forward","ignore","infolder","label","mark","move","sendon","stop-waitforreply","reply","reply-all","reply-tmpl","unlabel","unmark","unsubscribe"].indexOf(t)>-1&&!e.doNotCloseDropdown&&$(document).trigger("b-mail-dropdown-closeall"),ns.action.__run(t,e,n,r)},ns.action.__init=ns.action.init,ns.action.init=function(){var t=$("body");t.on("submit",".daria-form",(function(t){var e=t.currentTarget,n=!0,r=$(e),o=e.getAttribute("data-click-action");return o&&!r.prop("disabled")&&(n=ns.action.run(o,ns.action.getParams(e),e,t)),void 0!==n&&n})),t.on("click",".daria-action",(function(t){var e=t.currentTarget,n=!0,r=$(e),o=e.getAttribute("data-action")||e.getAttribute("action");return o&&!r.prop("disabled")&&(n=ns.action.run(o,ns.action.getParams(e),e,t)),void 0!==n&&n})),["error","load"].forEach((function(t){document.addEventListener(t,(function(e){var n=e.target,r=n&&n.classList;if(r&&-1!==Array.prototype.indexOf.call(r,"ns-action")){var o=n.getAttribute("data-"+t+"-action");o&&e.type===t&&ns.action.run(o,ns.action.getParams(n),n,e)}}),!0)})),ns.action.__init()}},3174:function(t,e){ns._ns_html2node=ns.html2node,ns.html2node=function(t){if(!t)return null;for(var e=ns._ns_html2node(t),n=e.getElementsByTagName("x-a"),r=n.length-1;r>=0;r--){var o=n[r],i=ns.renameNode(o,"a");o.parentNode.replaceChild(i,o)}return e},ns.renameNode=function(t,e){var n,r,o=document.createElement(e),i=t.attributes;for(n=0,r=i.length;n<r;n++){var s=i[n];o.setAttribute(s.name,s.value)}for(;t.firstChild;)o.appendChild(t.firstChild);return o}},3175:function(t,e){ns.http=function(t,e,n){n=no.extend({},ns.H.DEFAULTS,n),n.url=t,n.data=e,n.traditional=!0;var r=new Vow.Promise;return $.ajax(n).done((function(t){r.fulfill(t)})).fail((function(t,n,o){Jane.ErrorLog.send({errorType:"handlersjsx.httperror",status:t.status,headers:t.getAllResponseHeaders()},JSON.stringify(e));var i=o||n||"unknown error";r.reject({error:i,xhr:t})})),r}},3176:function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Function.prototype.bind&&window.console&&"object"===n(console.log)&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach((function(t){console[t]=this.bind(console[t],console)}),Function.prototype.call),ns.log.debug=function(){Daria.DEBUG&&console.log.apply(console,arguments)},ns.log.info=function(t,e,n){var r=n;if("ns.Update.restart"===t||"ns.Update.error-content"===t||"ns.View.error-content"===t){n=JSON.stringify(ns.Model.collectErrorData(n||[]))}else if(n&&"string"!=typeof n)try{n=JSON.stringify(n)}catch(t){n="JSON.stringify.error"}Daria.DEBUG&&window.console&&window.console.group&&(console.group("[qu.log.info]"),console.log(t),console.log(e),console.log(r),console.groupEnd("[qu.log.info]")),e=e||{},e.event=t,Jane.ErrorLog.send(e,n)},ns.log.exception=function(t,e,n){Jane.ErrorLog.sendException(t,e,n)}},3177:function(t,e){ns.Model.destroyAll=function(t){Array.isArray(t)||(t=[t]),t.forEach((function(t){ns.Model.isDefined(t)&&ns.Model.traverse(t,ns.Model.destroy)}))},ns.Model.invalidateAll=function(t){Array.isArray(t)||(t=[t]),t.forEach((function(t){ns.Model.isDefined(t)&&ns.Model.invalidate(t)}))},ns.Model.isDefined=function(t){var e=!1;try{ns.Model.infoLite(t)&&(e=!0)}catch(t){}return e},ns.Model.collectErrorData=function(t){var e={};return t.forEach((function(t,n){e["model."+n]=t.id,e["key."+n]=t.key,e["error."+n]=t.getError(),e["status."+n]=t.status})),e},ns.Model.prototype.setIfChanged=function(t,e,n){n=n||{};var r=this.get(t),o=!1;return _.isEqual(r,e)&&!n.force||(this.set.apply(this,arguments),o=!0),o},ns.Model.prototype.inNotInitedState=function(){return this.status===this.STATUS.NONE},ns.Model.prototype.set=function(t,e,n){var r=this.data;if(this.isValid()&&r){var o=_.clone(this.get(t));no.jpath.set(t,r,e),n=n||{},n.jpath=t,this.touch(n),n.silent||this.triggerChangedEvent(t,n.data,o)}},ns.Model.prototype.triggerChangedEvent=function(t,e,n){e=e||{};for(var r=t.split("."),o=r.length;o>1;){var i=r.slice(0,o).join(".");this.trigger("ns-model-changed"+i,i,t,e,n),o--}},ns.Model.prototype.isErrorCanBeFixed=function(t){return"account-information"!==this.id&&"ckey"===t},ns.Model.prototype.fixError=function(){return ns.forcedRequest(["account-information"])},ns.Model.prototype._lz_setError=ns.Model.prototype.setError,ns.Model.prototype.setError=function(t){if(this._lz_setError(t),this.status===this.STATUS.ERROR){var e={errorType:"HandlerError",name:this.id,key:this.key};Jane.ErrorLog.send(e,JSON.stringify(t))}}},3178:function(t,e){ns.ModelArmour=function(){},no.inherit(ns.ModelArmour,ns.Model),ns.ModelArmour.prototype._extractData=ns.Model.prototype.extractData,ns.ModelArmour.prototype.extractData=function(t){return this._extractData(t)||{}}},3179:function(t,e){ns.ModelStatic=function(){},no.inherit(ns.ModelStatic,ns.Model),ns.ModelStatic.prototype.canRequest=no.False,ns.ModelStatic.prototype.destroy=function(){ns.Model.prototype.destroy.apply(this),this._reinit()},ns.ModelStatic.prototype.invalidate=function(){this.destroy()}},3180:function(t,e){var n=/^#\s([^#]+)$/,r=/^([^\s>*!]+) > ([^\s>*!]+)$/;ns.ModelFsm=function(){},no.inherit(ns.ModelFsm,ns.Model),ns.ModelFsm.prototype._init=function(){this._transitionEvents={},this._inTransition=!1,this._isSwitchOn=!0,ns.Model.prototype._init.apply(this,arguments)},ns.ModelFsm.prototype.log=function(){var t=_.toArray(arguments);t=["[ns.ModelFsm] id:",this.id].concat(t),ns.log.debug.apply(ns.log,t)},ns.ModelFsm.prototype.request=function(){var t=this.start;return ns.assert(!_.isUndefined(t),"ns.ModelFsm.onInit","'start' state is required param of FSM"),_.isFunction(t)&&(t=this.start()),this.setInitialState(t),vow.Promise.resolve()},ns.ModelFsm.prototype.setInitialState=function(t){this.setData({state:t})},ns.ModelFsm.prototype.setState=function(t,e){var n=this.get(".state"),r=this._checkTransitionToState(t)?vow.resolve():vow.reject(),o={from:n,to:t,data:e};return r.then(function(){this.log("Transition from",n,"to",t,"is started"),this.trigger(n+" > "+t,o)}.bind(this),function(){this.log("Can't do transition from",n,"to",t),this.log("Current state is",n),Jane.ErrorLog.send({errorType:"fsm_transition_failed",fsmModel:this.id,fromState:n,toState:t,inTransition:this._inTransition,isSwitchOn:this._isSwitchOn})}.bind(this)),r},ns.ModelFsm.prototype._checkTransitionToState=function(t){var e=this.get(".state"),n=this.transitions["*"],r=this.transitions[e];return!(this._inTransition||!this._isSwitchOn)&&(t!==e&&(!(!n||!_.contains(n,t))||!(!_.contains(r,t)&&!_.contains(r,"*"))))},ns.ModelFsm.prototype.getState=function(){return this.get(".state")},ns.ModelFsm.prototype.isCurrentState=function(t){return t=$.makeArray(t),_.contains(t,this.get(".state"))},ns.ModelFsm.prototype._applyState=function(t,e){this.log("Apply state:",t," EventData:",e),this.set(".state",t),this.trigger("# "+t,e),this.trigger("# *",e)},ns.ModelFsm.prototype.transitionEventHandler=function(t,e){var n=this._transitionEvents[t],r=n.handlers;if("* > *"!==t){var o=this._transitionEvents["* > *"];o&&(r=r.concat(o.handlers))}var i=[];this._inTransition=!0,_.each(r,(function(n){i.push(n(t,e))})),this._transitionDeferred=new vow.Deferred,this._transitionDeferred.promise().then(this._transitionSuccess.bind(this,e),this._transitionError.bind(this,e)),vow.all(i).then(this._transitionDeferred.resolve.bind(this._transitionDeferred),this._transitionDeferred.reject.bind(this._transitionDeferred))},ns.ModelFsm.prototype._transitionSuccess=function(t){this._inTransition=!1,this.log("Transition from",t.from,"to",t.to,"is success"),this._applyState(t.to,t)},ns.ModelFsm.prototype._transitionError=function(t,e){this._inTransition=!1,t.error=e,this.log("Transition from",t.from,"to",t.to,"failed. Error:",e),this.log("Current state is",t.from),this.trigger(t.from+" !> "+t.to,t),this.trigger("* !> *",t)},ns.ModelFsm.prototype.on=function(t,e){if("transition"===this.getEventData(t).type){var n=this._transitionEvents[t];n||(n=this._transitionEvents[t]={name:t,handlers:[],callback:this.transitionEventHandler.bind(this)},ns.Model.prototype.on.call(this,t,n.callback)),n.handlers.push(e)}else ns.Model.prototype.on.call(this,t,e);return this},ns.ModelFsm.prototype.off=function(t,e){if("transition"===this.getEventData(t).type){var n=this._transitionEvents[t];n&&(n.handlers=_.reject(n.handlers,(function(t){return t===e})),n.handlers.length||(delete this._transitionEvents[t],ns.Model.prototype.off.call(this,t,n.callback)))}else ns.Model.prototype.off.call(this,t,e);return this},ns.ModelFsm.prototype.trigger=function(t,e){if(this._isSwitchOn)return r.test(t)&&!this._transitionEvents[t]?void this.trigger("* > *",e):"* > *"!==t||this._transitionEvents[t]?void ns.Model.prototype.trigger.apply(this,arguments):(this.log("Transition from",e.from,"to",e.to,"is success"),void this._applyState(e.to,e))},ns.ModelFsm.prototype.getEventData=function(t){var e={type:t,from:"",to:""},o=[t];if(n.test(t)&&(o=t.match(n),e.type="current",e.to=o[1]),"* > *"===t&&(e.type="transition",e.from="*",e.to="*"),r.test(t)){o=t.match(r);var i=o[1],s=o[2];e.type=i&&s?"transition":t,e.from=i,e.to=s}return e},ns.ModelFsm.prototype.inTransition=function(){return this._inTransition},ns.ModelFsm.prototype.abortTransition=function(){this._inTransition&&this._transitionDeferred.reject()},ns.ModelFsm.prototype.switchOff=function(){this.log("Model is switchOff"),this.abortTransition(),this._isSwitchOn=!1},ns.ModelFsm.prototype.switchOn=function(){this.log("Model is switchOn"),this._isSwitchOn=!0},ns.ModelFsm.prototype.destroy=function(){this.switchOn(),this.abortTransition(),ns.Model.prototype.destroy.apply(this),this._reinit()},ns.ModelFsm.prototype.invalidate=ns.ModelFsm.prototype.destroy},3181:function(t,e){ns.ModelCollectionStatic=function(){},no.inherit(ns.ModelCollectionStatic,ns.ModelCollection),ns.ModelCollectionStatic.prototype.canRequest=no.False,ns.ModelCollectionStatic.prototype.destroy=function(){ns.Model.prototype.destroy.apply(this),this._reinit()},ns.ModelCollectionStatic.prototype.invalidate=ns.ModelCollectionStatic.prototype.destroy},3182:function(t,e){ns.page.current={page:null,params:{}},ns.page.HOME_HASH="#inbox",ns.page.home=function(t){return ns.page.go(ns.page.HOME_HASH,t?"replace":"push")},ns.page.refresh=function(){return ns.page.go(ns.page.currentUrl),new vow.Promise(function(t){ns.events.once("ns-page-after-load",t)})},ns.page.followRoute=function(){var t=new Vow.Promise;return!Jane.Services.hasNewVersion()||Daria.Page.loadingHash===ns.page.currentUrl||/^#compose/.test(ns.page.currentUrl)||/^#done/.test(Daria.Page.loadingHash)?(Jane.Services.run(Daria.Page.loadingHash,(function(){t.fulfill()})),t):(ns.page.forceReload(Daria.Page.loadingHash),t)},ns.page.getCurrentUrl=function(){var t=window.location.href,e=t.indexOf("#");return-1!==e?t.substr(e):ns.page.HOME_HASH},ns.page.getDefaultUrl=function(){return ns.router.url(ns.page.HOME_HASH)},ns.page.replacePage=function(t,e){var n=ns.router.generateUrl(t,e);ns.page.hashReplace(n),ns.page._setCurrent({page:t,params:e},n)},ns.page.title=no.nop,ns.events.on("ns-page-before-load",(function(t,e,n){var r=ns.page.currentUrl;r&&n!==r&&ns.events.trigger("ns-page-before-changed",r,n),Daria.Page.loadingHash=n,Daria.Page.referrer=ns.page.current.page,Daria.Page.referrerUrl=r})),ns.page._go=ns.page.go,ns.page.go=function(t,e){return ns.log.debug("[ns.page.go]",t,e),t&&"#"!==t.charAt(0)?(!0===e||"replace"===e?window.location.replace(t):window.location=t,new Vow.Promise):"done"===ns.page.current.page?ns.page._go(t,!0):ns.page._go(t,e)}},3183:function(t,e){ns.page.block.clearByCondition=function(t){return ns.page.block._checkers=ns.page.block._checkers.filter((function(e){return!t(e)})),this}},3184:function(t,e){ns.page.history.getPreviousPageUrl=function(t){t=t||{};var e,n,r=-1,o=$.makeArray(t.match),i=$.makeArray(t.mismatch),s=(function(){var t=_.isEmpty(o)?function(){return!0}:function(t){return _.contains(o,t)},e=function(t){return!_.contains(i,t)};return function(n){return t(n)&&e(n)}})();do{(e=ns.page.history.getPrevious(++r))&&(n=ns.router(e).page)}while(e&&!s(n));return e},ns.page.history.getFirstValidPrevious=function(t){for(var e,n=ns.page.history._history.concat(ns.page.currentUrl),r=n.length;r--;)if(e=n[r],t(e))return e;return null}},3185:function(t,e){ns.request.addRequestParams=function(t){return Object.assign(t,Daria.commonRequestParams(t))},ns.request.canProcessResponse=function(t){var e=t.timestamp;return e&&(Daria._timestampDelta=Date.now()-e||0),Daria.parseLoginInfo(t)},Daria.parseLoginInfo=function(t){var e=jpath(t,'.models.error[.code == "AUTH_NO_AUTH"]')[0]||jpath(t,'.error[.code == "AUTH_NO_AUTH"]')[0];if(e)return Jane.doLogin("parseLoginInfo",e),ns.request._reset(),!1;var n=t.uid;return n&&n!==Daria.uid?(Jane.locate("/"),!1):(t.cookieRenew&&!Jane.cookieRenewFrameTimer&&(document.cookie="Cookie_check=1; domain=."+Daria.Config["yandex-domain"]+"; path=/",$('<iframe id="jane-cookie-renew" src="//'+Daria.Config["passport-host"]+'/auth/update/" class="g-invisible"/>').appendTo("body"),Jane.cookieRenewFrameTimer=window.setTimeout((function(){delete Jane.cookieRenewFrameTimer,$("#jane-cookie-renew").remove()}),6e4)),!0)};var n=ns.request.extractModel;ns.request.extractModel=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var o=n.apply(ns.request,e),i=e[0],s=e[1];return i&&s&&s.xRequestId&&(i.xRequestId=s.xRequestId),o}},3186:function(t,e){ns.router._ns_generateUrl=ns.router.generateUrl,ns.router.generateUrl=function(t,e){return e=e||{},delete e.threaded,delete e["_actions-dropdown-type"],(e.attachments||e.unread)&&(delete e.extra_cond,delete e.goto),ns.router._ns_generateUrl(t,e)},ns.router.buildFoldersUrls=function(){var t=ns.Model.get("folders"),e=t.symbols();for(var n in e)ns.router.routes.rewriteUrl["#"+n]="#folder/"+e[n]}},3187:function(t,e){ns.Update.calcPerformanceTimings=function(t){var e={allTime:0,allSumTime:0,requestTime:0,selfTime:0};for(var n in t)if("_"!==n.charAt(0)){var r=t[n];r.toString().length>10&&(r=Date.now()-r),"full"===n?e.allTime=r:0===n.indexOf("requestModels")?e.requestTime+=r:e.allSumTime+=r,e[n]=r}return e.selfTime=e.allTime-e.requestTime,e},ns.Update.handleError=function(t,e){if(_.method("outputError",t,e)(e.view))return!0;if(t.expired)return!1;var n,r=!1,o=[];return t.invalidModels&&(n=ns.Model.collectErrorData(t.invalidModels),t.invalidModels.forEach((function(t){"message"!==t.id&&"message-body"!==t.id||t.exists()||(r=!0,o.push(_.get(t,"params.ids")))}))),r?(Jane.ErrorLog.send({errorType:"no_such_message",pageType:ns.page.current.page||"",pageReferrer:Daria.Page.referrer||"",pagePrevious:ns.page.history.getPrevious()||"",params:ns.params2query(ns.page.current.params),noSuchMessageIds:o.join(",")}),e._reject({error:"NO_MESSAGE"}),e.promise.then(null,(function(){var t=ns.page.current.params.ids||ns.page.current.params.thread_id;t&&_.contains(o,t)&&ns.page.go("#no-message")}))):(Jane.ErrorLog.send({errorType:"RunFailed",type:t.error},JSON.stringify(n)),e.EXEC_FLAG===ns.U.EXEC.GLOBAL&&(e.promise.then(null,(function(){ns.page.hashReplace(ns.page.history.getPrevious())})),Daria.Statusline.show({name:"cant_load_data"}))),!1},ns.Update.prototype.applyTemplate=function(t){return ns.renderString(t,null,"common")},ns.Update.prototype.perf=function(t){try{this._logPerfTimings(t)}catch(t){Jane.ErrorLog.sendException("LongRunError",t)}},ns.Update.prototype._logPerfTimings=function(t){var e=ns.Update.calcPerformanceTimings(t);ns.DEBUG&&this.log("perf",t,e),e.selfTime>1e3&&this._sendLongRun("LongRun",e,t),e.allTime>2e3&&this._sendLongRun("LongRun2",e,t)},ns.Update.prototype._sendLongRun=function(t,e,n){var r={event:t,block:this.view.id,theme:Daria.themeId,allTime:e.allTime,requestTime:e.requestTime,selfTime:e.selfTime};for(var o in n)r["perf."+o]=n[o];Jane.ErrorLog.send(r)}},3188:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(83),o=n.n(r);ns.View.prototype.logTimings=function(t,e){var n=ns.Update.calcPerformanceTimings(t),r={allTime:0,requestTime:0,selfTime:0};t.__parent&&(r=ns.Update.calcPerformanceTimings(t.__parent));var i={blockname:this.id,request:n.requestTime+r.requestTime,event:"BlockTimings",visibilityState:document.visibilityState,show:n.allTime+r.allTime,browser:Daria.UA.BrowserName};if(i=_.extend(n,i),Jane.ErrorLog.send(i),Jane.watcher.get("pageVisible")){e=[o.a.ru,o.a.mail,o.a.desktop,o.a.block].concat(e);var s=Ya.Rum.makeSubPage(e.join("."));Ya.Rum.sendDelta(o.a.request,i.request,s),Ya.Rum.sendDelta(o.a.render,i.selfTime,s),Ya.Rum.sendDelta(o.a.show,i.show,s)}},ns.View.prototype.updateByLayout=function(t,e,n){var r=ns.layout.page(t,e);if(n=n||{},n.execFlag=n.execFlag||ns.U.EXEC.ASYNC,this.layout){var o=this.layout[this.id].views;for(var i in o)delete o[i];no.extend(o,r[this.id].views)}else this.layout=r;return new ns.Update(this,this.layout,e,n).render()},ns.View.prototype.getBlockByName=function(t){return this.views[t]},ns.View.prototype.forceUpdate=function(){this.info&&!this.info.isCollection&&this.invalidate(),this.lazyUpdate()},ns.View.prototype.lazyUpdate=function(){this.isVisible()&&ns.page.lazyRefresh()},ns.View.isDefined=function(t){var e=!1;try{ns.View.infoLite(t)&&(e=!0)}catch(t){}return e};var i=Math.floor(100*Math.random());ns.View.prototype.__setUniqueId=function(){this.__uniqueId||(this.__uniqueId="ns-view-id-"+ ++i)}},3189:function(t,e){ns.ViewCollection.prototype.forEachValidItem=function(t){this.forEachItem((function(e){e.isValid()&&t(e)}))}},3190:function(t,e){ns.Box.prototype.__setUniqueId=ns.View.prototype.__setUniqueId}});