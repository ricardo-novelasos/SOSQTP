webpackJsonp([17],{208:function(e,t,n){"use strict";Jane.module("timeline.js",(function(){n(3388),n(3389),n(3393)}))},3388:function(e,t){ns.layout.define("layout-timeline",{"timeline-box@":{"timeline-ng":{"timeline-date":{},"timeline-back":{},"timeline-forward":{},"timeline-newevent":{},"timeline-toggle":{},"timeline-list&":{}}}}),ns.layout.define("layout-timeline-collapsed",{"timeline-box@":{"timeline-collapsed":{"timeline-newevent":{},"timeline-toggle":{}}}}),ns.layout.define("layout-timeline-empty",{"timeline-box@":{}}),ns.layout.define("layout-timeline-item",{"timeline-list-item":{"timeline-events&":{}}})},3389:function(e,t,n){n(3390),n(3391),n(3392)},3390:function(e,t){ns.Model.define("timeline-state",{events:{"ns-model-init":"_onInit","ns-model-changed.startDate":"_onChangedStartDate","ns-model-changed.startOffset":"_onChangedStartOffsetDebounce","ns-model-changed.currentDate":"_onChangedCurrentDate"},ctor:function(){this._onXivaCalendarChangedDebounce=_.debounce(this._onXivaCalendarChanged.bind(this),2*Jane.Date.MINUTE,{maxWait:5*Jane.Date.MINUTE,leading:!0,trailing:!0}),this.currentDateTick=this.currentDateTick.bind(this),this._onChangedStartOffsetDebounce=_.debounce(this._onChangedStartOffset.bind(this),500),this._lockStartDateSet=!1,this._lockStartDateAutoSet=!1},methods:{TIMELINE_START_HOUR_OFFSET:2,TIMELINE_HOUR_PIXEL_STEP:48,MAX_LAG_START_DATE:6*Jane.Date.HOUR,SLEEP_TIME:5*Jane.Date.MINUTE,CALENDAR_SID:31,SHOW_EMPTY:0,SHOW_COLLAPSED:1,SHOW_TIMELINE:3,_onInit:function(){var e=Math.floor(window.screen.width/this.TIMELINE_HOUR_PIXEL_STEP),t=this._getCurrentDate(),n=Jane.Date.clone(t);n=this._adjustHours(n,-this.TIMELINE_START_HOUR_OFFSET),this.setData({calendarSpeed:Number($.url(window.location.href).getParam("calendar_speed")||0),timerTick:0,height:0,currentDate:{get:_.constant(t)},startDate:n,startOffset:{get:_.constant(0)},showedHours:e,countOfDays:Math.ceil(e/24)}),ns.events.on("xiva.calendar.user-events-changed",this._onXivaCalendarChangedDebounce)},_onChangedStartDate:function(){this._lockStartDateSet=!0},_onChangedStartOffset:function(){this._lockStartDateSet=!1},_onChangedCurrentDate:function(e,t,n,i,o){var s=o.get().getTime(),a=this.getCurrentDate().getTime(),r=!1;if(Math.abs(a-s)>this.SLEEP_TIME&&(this._lockStartDateAutoSet=!1,ns.Model.invalidate("get-user-events",no.True),r=!0),!this._lockStartDateAutoSet){var l=this.get(".startDate").getTime();Math.abs(a-l)>this.MAX_LAG_START_DATE&&this.shiftCurrentStartDate()}if(r){var h=Daria.Transport.getInstance(!1);!h||h.onLine()?this.atrigger("daria:mTimelineState:update"):h.once("online",this.atrigger.bind(this,"daria:mTimelineState:update"))}},set:function(e){if(".startDate"!==e||!this._lockStartDateSet)return this.super_.set.apply(this,arguments)},recalcShowedHours:function(e){var t=Math.floor(e/this.TIMELINE_HOUR_PIXEL_STEP);this.setIfChanged(".showedHours",t),this.setIfChanged(".countOfDays",Math.ceil(t/24))},shiftForwardStartDate:function(){var e=Jane.Date.clone(this.get(".startDate"));e=this._adjustHours(e,this.get(".showedHours")),e=this._adjustHours(e,-this.TIMELINE_START_HOUR_OFFSET),this._lockStartDateAutoSet=!0,this.setIfChanged(".startDate",e)},shiftBackStartDate:function(){var e=Jane.Date.clone(this.get(".startDate"));e=this._adjustHours(e,-this.get(".showedHours")),e=this._adjustHours(e,this.TIMELINE_START_HOUR_OFFSET),this._lockStartDateAutoSet=!0,this.setIfChanged(".startDate",e)},shiftCurrentStartDate:function(){var e=Jane.Date.clone(this.getCurrentDate());e=this._adjustHours(e,-this.TIMELINE_START_HOUR_OFFSET),this._lockStartDateAutoSet=!1,this.setIfChanged(".startDate",e)},getCurrentDate:function(){return this.get(".currentDate.get")()},setStartOffset:function(e){this.set(".startOffset",{get:e})},checkShow:function(){return!this.checkUnavailable()&&ns.Model.get("settings").checkTimelineEnable()},checkShowCollapsed:function(){return!!this.checkShow()&&!this.checkSettingTimelineIsOpen()},checkUnavailable:function(){var e=ns.page.current.page;return Boolean(Daria.Config.NO_SETTINGS||"not-found"===e||"no-message"===e||!Daria.Config["is-timeline"])},checkSettingTimelineIsOpen:function(){var e=ns.Model.get("settings");return Daria.Config.pddDomain||Daria.Config.workspace?e.isSet("timeline-is-open"):!e.hasSetting("timeline-is-open")||e.isSet("timeline-is-open")},subscribeCalendar:function(){return Daria.checkTimelineAvailable()?Vow.resolve():ns.Model.get("settings").isSet("timeline_enable")?ns.Model.get("account-information").hasSid(this.CALENDAR_SID)?Vow.resolve():ns.forcedRequest("do-admsubscribe-calendar").then(this._checkSubscribeResponse,this).then(this._onSuccessSubscribeCalendar,this).fail(this._onErrorSubscribeCalendar,this):Vow.resolve()},metrika:function(){var e=Array.prototype.slice.call(arguments);e.unshift("Календарный таймлайн"),Jane.c.apply(Jane,e)},currentDateTick:function(){this._updateCurrentDate(),this.set(".timerTick",setTimeout(this.currentDateTick,this._getTickTime()),{silent:!0})},currentDateTickStop:function(){clearTimeout(this.get(".timerTick"))},_updateCurrentDate:function(){var e=this._getCurrentDate();this._isCustomCalendarSpeed()&&e.setMinutes(e.getMinutes()+1),this.set(".currentDate",{get:_.constant(e)})},_getTickTime:function(){var e=Jane.Date.MINUTE-Daria.now()%Jane.Date.MINUTE+1;return this._isCustomCalendarSpeed()&&(e=this.get(".calendarSpeed")),e},_checkSubscribeResponse:function(e){return"ok"===e[0].getData().status?Vow.resolve():Vow.reject()},_onSuccessSubscribeCalendar:function(){var e=ns.Model.get("account-information"),t=e.get(".sids")||[];return t.push(String(this.CALENDAR_SID)),e.set(".sids",t),Vow.resolve()},_onErrorSubscribeCalendar:function(){return new vow.Promise(function(e,t){ns.Model.get("settings").setSettingOff("timeline_enable",t)})},_getCurrentDate:function(){var e;if(this._isCustomCalendarSpeed())e=Jane.Date.clone(this.getCurrentDate());else{var t=ns.Model.get("account-information").getTimezoneInHours();e=Daria.now(!0),e=Jane.Date.dateWithCustomTimeZone(e.getTime(),t),e=Jane.Date.LocalDate.convertDate(e),e.setSeconds(0,0)}return e},_adjustHours:function(e,t){return t=Math.floor(t||0),e.setHours(e.getHours()+t),e},_roundAwayFromZero:function(e){return e<0?Math.floor(e):Math.ceil(e)},_isCustomCalendarSpeed:function(){return this.get(".calendarSpeed")>0},_onXivaCalendarChanged:function(){ns.Model.invalidate("get-user-events",no.True),this.atrigger("daria:mTimelineState:update")}}},ns.ModelStatic)},3391:function(e,t){ns.Model.define("timeline-list",{events:{"ns-model-destroyed":"_onDestroyed"},params:{},split:{items:".items",params:{df:".df",dt:".dt"},model_id:"timeline-list-item"},ctor:function(){this._mapDaysToModelsIterator=this._mapDaysToModelsIterator.bind(this),this._filterRemovedIterator=this._filterRemovedIterator.bind(this),this._sortRangesByDateFrom=this._sortRangesByDateFrom.bind(this),this._mapModelsToDateIterator=this._mapModelsToDateIterator.bind(this),this._onChangedStartDateDebounce=_.debounce(this._onChangedStartDate.bind(this),50)},methods:{PRELOADED_VISIBLE_RANGES:3,request:function(){return ns.request("timeline-state").then(this._initFromModels,this)},loadMore:function(){var e=_.last(this.models),t=_.method(".get",".dateTo")(e);if(t||(t=this.mTimelineState.get(".startDate")),!t)return Vow.reject();var n=_.range(1,this._getVisibleDaysCount()).map(this._mapDaysIterator.bind(this,t)).map(this._mapDaysToModelsIterator);return this.setData({items:this._listModification(n)}),Vow.resolve()},_initFromModels:function(e){this.mTimelineState=_.find(e,"id","timeline-state"),this.mTimelineState.on("ns-model-changed.startDate",this._onChangedStartDateDebounce),this.setData({items:this._getStartingDays()})},_onDestroyed:function(){this._onChangedStartDateDebounce.cancel(),this.mTimelineState.off("ns-model-changed.startDate",this._onChangedStartDateDebounce),this.mTimelineState=null},_onChangedStartDate:function(){this._reinitialize()},_mapDaysIterator:function(e,t){var n=Jane.Date.clone(e);n.setDate(n.getDate()+t),n.setHours(0,0,0,0);var i=Jane.Date.clone(n);return i.setHours(23,59,0,0),{df:Jane.Date.format("%Date_iso",n),dt:Jane.Date.format("%Date_iso",i),dateFrom:n,dateTo:i}},_getStartingDays:function(){var e=this.mTimelineState.get(".startDate"),t=this._getVisibleDaysCount();return _.range(t).map(this._mapDaysIterator.bind(this,e))},_reinitialize:function(){var e=this._getStartingDays().map(this._mapDaysToModelsIterator),t=this.models.filter(this._filterRemovedIterator);this.setData({items:this._listModification(e,t)})},_listModification:function(e,t){return _(this.models).chain().difference(t).concat(e).uniq().sortBy(this._sortRangesByDateFrom).map(this._mapModelsToDateIterator).value()},_filterRemovedIterator:function(e){var t=this.mTimelineState.get(".startDate"),n=e.getOffsetRange(t),i=Jane.Date.DAY*this._getVisibleDaysCount();return n>i||n<-i},_getVisibleDaysCount:function(){return this.mTimelineState.get(".countOfDays")*this.PRELOADED_VISIBLE_RANGES},_mapDaysToModelsIterator:function(e){return ns.Model.get("timeline-list-item",e).setData(e)},_mapModelsToDateIterator:function(e){return e.getData()},_sortRangesByDateFrom:function(e){return e.get(".dateFrom").getTime()}}})},3392:function(e,t){ns.Model.define("timeline-list-item",{events:{"ns-model-init":"_onInit"},params:{df:null,dt:null},methods:{_onInit:function(){this.setData({})},checkDateInRange:function(e){return(e=e.getTime())>=this.get(".dateFrom").getTime()&&e<=this.get(".dateTo").getTime()},checkDateGtRange:function(e){return e.getTime()>this.get(".dateTo").getTime()},checkDateLtRange:function(e){return e.getTime()<this.get(".dateFrom").getTime()},getOffsetRange:function(e){e=e.getTime();var t=this.get(".dateFrom").getTime(),n=this.get(".dateTo").getTime();return e>n?e-n:e<t?e-t:0}}},ns.ModelStatic)},3393:function(e,t,n){n(3394),n(3395),n(3396),n(3397),n(3398),n(3399),n(3400),n(3401),n(3402),n(3403),n(3404),n(3405)},3394:function(e,t){ns.View.define("timeline-wrap",{events:{"ns-view-show":"onShow","ns-page-before-load@show":"onPageBeforeLoad","ns-page-after-load@show":"onPageAfterLoad"},models:{"timeline-state":!1,settings:{"ns-model-changed":!1,"ns-model-changed.timeline_enable":"onChangedTimelineEnableDebounce","ns-model-changed.timeline-is-open":"updateTimeline"}},yateModule:"timeline",ctor:function(){this.onChangedTimelineEnableDebounce=_.debounce(this.onChangedTimelineEnable.bind(this),100)},methods:{patchLayout:function(){var e=this.getModel("timeline-state"),t=e.checkShowCollapsed(),n=e.checkShow();return ns.Model.get("app-state").updatePageClasses({"mail-Page_with_Timeline_collapsed":t,"mail-Page_with_Timeline":n&&!t}),t?"layout-timeline-collapsed":n?"layout-timeline":"layout-timeline-empty"},onShow:function(){var e=this.getModel("timeline-state");this.prevCheckShow=_.constant(e.checkShow())},onPageBeforeLoad:function(){var e=this.getModel("timeline-state");this.prevCheckShow=_.constant(e.checkShow())},onPageAfterLoad:function(){var e=this.getModel("timeline-state"),t=e.checkShow();this.prevCheckShow()!==t&&this.updateTimeline()},updateTimeline:function(){this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},onChangedTimelineEnable:function(){this.getModel("timeline-state").subscribeCalendar().fail(this.onErrorSubscribeCalendar,this).always(this.updateTimeline,this)},onErrorSubscribeCalendar:function(){Daria.Statusline.show({name:"timeline_loading_failed",params:{url:Daria.Config["timeline-yandex-host"]}})}}})},3395:function(e,t){ns.View.define("timeline-common",{yateModule:"timeline",methods:{_commonInit:function(){ns.Model.get("app-state").setIfChanged(".timelineHeight",this.$node.height())},_commonDestroy:function(){ns.Model.get("app-state").setIfChanged(".timelineHeight",0)}}})},3396:function(e,t){ns.View.edefine("timeline-ng",{models:{"app-state":!1,"timeline-state":{"ns-model-changed":!1,"daria:mTimelineState:update":"onTimelineStateUpdate"}},events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},yateModule:"timeline",ctor:function(){this.super_.constructor.call(this),this.showMetrikaOnce=_.once(this.showMetrika.bind(this))},methods:{onShow:function(){this._commonInit(),this.getModel("timeline-state").currentDateTick(),this.showMetrikaOnce()},onHide:function(){this._commonDestroy(),this.getModel("timeline-state").currentDateTickStop()},onTimelineStateUpdate:function(){this.isVisible()&&ns.page.lazyRefresh()},showMetrika:function(){this.getModel("timeline-state").metrika("Показ","полоска")}}},"timeline-common")},3397:function(e,t){ns.View.define("timeline-collapsed",{yateModule:"timeline",methods:{}})},3398:function(e,t){ns.View.define("timeline-date",{models:{"timeline-state":{"ns-model-changed":!1,"ns-model-changed.currentDate":"onChangedCurrentDate"}},events:{"click@show":"onClick"},yateModule:"timeline",methods:{onClick:function(){var e=this.getModel("timeline-state");e.metrika("Действия","клик на текущую дату"),e.shiftCurrentStartDate()},onChangedCurrentDate:function(){this.isVisible()&&this.$node.text(this.getLabel())},getLabel:function(){return Jane.Date.format("%Date_dm__dot",this.getModel("timeline-state").getCurrentDate())}}})},3399:function(e,t){ns.View.define("timeline-back",{models:{"timeline-state":!1},events:{"click@show":"onClick"},yateModule:"timeline",methods:{onClick:function(){this.getModel("timeline-state").shiftBackStartDate()}}})},3400:function(e,t){ns.View.define("timeline-toggle",{models:{"timeline-state":!1,settings:{"ns-model-changed":!1,"ns-model-changed.timeline-is-open":"invalidate"}},events:{"click@show":"onClick"},yateModule:"timeline",ctor:function(){this.onSuccessToggleSetting=this.onSuccessToggleSetting.bind(this)},methods:{onClick:function(){var e=this.getModel("timeline-state").checkSettingTimelineIsOpen();this.getModel("settings").setSettings({"timeline-is-open":!e},this.onSuccessToggleSetting)},onSuccessToggleSetting:function(){var e=this.getModel("timeline-state");this.getModel("settings").isSet("timeline-is-open")?e.metrika("Действия","развернули полоску"):e.metrika("Действия","свернули полоску")}}})},3401:function(e,t){ns.View.define("timeline-forward",{models:{"timeline-state":!1},events:{"click@show":"onClick"},yateModule:"timeline",methods:{onClick:function(){this.getModel("timeline-state").shiftForwardStartDate()}}})},3402:function(e,t){ns.View.define("timeline-newevent",{models:{"timeline-state":!1},events:{"click@show":"onClick"},yateModule:"timeline",methods:{onClick:function(){this.getModel("timeline-state").metrika("Действия","клик на создать событие")}}})},3403:function(e,t){ns.ViewCollection.define("timeline-list",{models:{"timeline-list":{"ns-model-changed":"forceUpdate","ns-model-remove":"onRemoveTimelineList","ns-model-insert":"keepValid"},"timeline-state":{"ns-model-changed":!1,"ns-model-changed.startOffset":"onChangedStartOffset"}},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-touch":"onTouch","daria:vApp:changeLeftColumWidth@show":"onResizeDebounce"},split:{byModel:"timeline-list",intoLayouts:_.constant("layout-timeline-item")},yateModule:"timeline",ctor:function(){this.offsetCorrection=this.offsetCorrection.bind(this),this.offsetCorrectionOnce=_.once(this.offsetCorrection),this.onResizeDebounce=_.debounce(this.onResize.bind(this),50),this.toLoadMoreDebounce=_.debounce(this.toLoadMore.bind(this),50),this.onChangedStartOffsetDebounce=_.debounce(this.onChangedStartOffset.bind(this),50)},methods:{onHtmlInit:function(){this.$content=this.$node.find(".js-content"),this.$scroller=this.$node.find(".js-scroller")},onShow:function(){this.updateDisplayedTimeInterval(),this.offsetCorrectionOnce()},onHide:function(){this.onResizeDebounce.cancel(),this.toLoadMoreDebounce.cancel(),this.onChangedStartOffsetDebounce.cancel()},onTouch:function(){this.offsetCorrectionOnce()},onResize:function(){this.updateDisplayedTimeInterval()},onRemoveTimelineList:function(e,t){this.keepValid();var n=this.getModel("timeline-state").get(".startDate");_.some(t,(function(e){return e.checkDateGtRange(n)}))&&(this.offsetCorrectionOnce=_.once(this.offsetCorrection))},onChangedStartOffset:function(e,t,n,i,o){this.scrollOffset(!0,null,o).then(this.toLoadMore,this)},scrollOffset:function(e,t,n){t=t||this.getModel("timeline-state").get(".startOffset");var i=this.$content,o=this.getContentOffset(t.get());return n&&(n=this.getContentOffset(n.get()),i.stop(!0,!0).css({textIndent:-n,transform:"translate(-"+n+"em, 0)"})),new vow.Promise(function(t,n){e?i.stop(!0,!0).animate({textIndent:-o},{step:function(e){$(this).css("transform","translate("+e+"em, 0)")},complete:t,fail:n}):i.promise().always((function(){i.css({textIndent:-o,transform:"translate(-"+o+"em, 0)"}),t()}))}).catch(_.noop)},offsetCorrection:function(){this.scrollOffset().then(this.toLoadMore,this)},getContentOffset:function(e){var t=this.getModel("timeline-state"),n=this.$scroller.offset().left,i=parseFloat(this.$content.css("text-indent")||0);return Math.floor((e-n)/t.TIMELINE_HOUR_PIXEL_STEP-i)},updateDisplayedTimeInterval:function(){var e=this.$scroller.width();this.getModel("timeline-state").recalcShowedHours(e)},checkToLoadMore:function(){if(this._lockLoadMore||!this.isVisible())return!1;var e=this.$content[0].getBoundingClientRect(),t=this.$scroller[0].getBoundingClientRect();if(!e||!t)return!1;var n=this.getModel("timeline-list").PRELOADED_VISIBLE_RANGES,i=t.right+t.width*n;return e.right<i},toLoadMore:function(){this.checkToLoadMore()&&(this._lockLoadMore=!0,this.getModel("timeline-list").loadMore().always((function(){this._lockLoadMore=!1}),this))}}})},3404:function(e,t){ns.View.define("timeline-list-item",{models:{"timeline-list-item":!1,"timeline-state":{"ns-model-changed":!1,"ns-model-changed.startDate":"onChangedStartDate","ns-model-changed.currentDate":"onChangedCurrentDate"}},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-htmldestroy":"onHtmlDestroy","ns-view-show":"onShow","click@show .js-item-hour":"onClickItemHour"},yateModule:"timeline",ctor:function(){this.mapHourIterate=this.mapHourIterate.bind(this)},methods:{patchTree:function(){var e=this.super_.patchTree.call(this);return e.startDay=Jane.Date.format("%F",this.getModel("timeline-list-item").get(".dateFrom")),e},onHtmlInit:function(){this.$hours=this.$node.find(".js-item-hour"),this.$current=this.$node.find(".js-current")},onHtmlDestroy:function(){delete this.$hours,delete this.$current},onShow:function(){this.updateStartOffset(),this.updateShowCurrentDate()},onClickItemHour:function(){this.getModel("timeline-state").metrika("Действия","клик на слот")},onChangedStartDate:function(){this.isVisible()&&this.updateStartOffset()},onChangedCurrentDate:function(){this.isVisible()&&this.updateShowCurrentDate()},updateStartOffset:function(){var e=this.getModel("timeline-state"),t=this.getModel("timeline-list-item"),n=e.get(".startDate");t.checkDateInRange(n)&&e.setStartOffset(this.getOffset.bind(this,n.getHours()))},updateShowCurrentDate:function(){var e=this.getModel("timeline-state"),t=this.getModel("timeline-list-item"),n=e.getCurrentDate();if(this.$hours.removeClass("is-current"),this.$current.css("display","none"),t.checkDateInRange(n)){var i=n.getHours(),o=n.getMinutes();this.$hours.eq(i).addClass("is-current"),this.$current.css({display:"block",left:i+o/60+"em"})}},getOffset:function(e){return this.$hours?this.$hours.eq(e).offset().left:0},getHours:function(){return _.range(24).map(this.mapHourIterate)},mapHourIterate:function(e){var t="";return t=0===e?Jane.Date.format("%Date_dm__dot",this.getModel("timeline-list-item").get(".dateFrom")):_.padLeft(e,2,"0")+":00",{hour:e,label:t}}}})},3405:function(e,t){!(function(){var e=null,t=_.debounce((function(){e&&e.close()}),500),n=_.debounce((function(){var e,t=function(e){return Boolean(e%2)},n=function(e){return!t(e)},i=0;$(".js-timeline-event").each((function(o){var s=$(this);s.hasClass("is-notstarted")&&i++,e=i%2?n:t,s.toggleClass("is-grey",e(o))}))}),50);ns.View.define("timeline-events",{models:{"timeline-state":!1,"timeline-list-item":!1,"get-user-events":{"ns-model-changed":"forceUpdate","daria:mGetUserEvents:update":"lazyUpdate"}},events:{"ns-view-show":"onShow","mouseenter@show .js-timeline-event":"showTooltip","mouseleave@show .js-timeline-event":"hideTooltip","click@show .js-timeline-event":"onClickEvent"},yateModule:"timeline",paramsRewrite:function(e){return{from:e.df.split("T")[0],to:e.dt.split("T")[0]}},ctor:function(){this.onDestroyedTooltip=this.onDestroyedTooltip.bind(this),this.onClosedTooltip=this.onClosedTooltip.bind(this),this.onOpenedTooltip=this.onOpenedTooltip.bind(this),this.onClickEventEdit=this.onClickEventEdit.bind(this),this.onScroll=this.onScroll.bind(this)},methods:{onShow:function(){n()},showTooltip:function(n){t.cancel(),e&&(e.destroy(),e=null);var i=$(n.currentTarget),o=Number(i.attr("data-event-index")),s=this.getModel("get-user-events").select(".ranges["+o+"]")[0];if(s){e=nb.block(ns.renderNode(s,"js-timeline-events-tooltip","timeline")),e.on("nb-destroyed",this.onDestroyedTooltip),e.on("nb-opened",this.onOpenedTooltip),e.on("nb-closed",this.onClosedTooltip),e.$node.on("mouseenter",t.cancel).on("mouseleave",t).on("click",".js-timeline-event-edit",this.onClickEventEdit);var a=i.offset().top-n.pageY;a=String(a>=0?"+"+a:a),e.open({withoutTail:!1,autofocus:!1,how:{my:"center bottom"+a,at:"center top",collision:"fit none"},where:n})}},hideTooltip:function(){t()},onClickEvent:function(){this.getModel("timeline-state").metrika("Действия","клик на слот")},onDestroyedTooltip:function(){ns.events.off("daria:vScrollerMessages:scroll",this.onScroll),ns.events.off("daria:layout-changed",this.onScroll),e=null},onOpenedTooltip:function(){ns.events.on("daria:vScrollerMessages:scroll",this.onScroll),ns.events.on("daria:layout-changed",this.onScroll),this.getModel("timeline-state").metrika("Показ","превьюшка встречи")},onClickEventEdit:function(){this.getModel("timeline-state").metrika("Действия",'клик на "редактировать" в попапе')},onClosedTooltip:function(e,t){t.destroy()},onScroll:function(){if(e){var t=_.get(e,"node.widget");t&&t._position()}}}})})()}});